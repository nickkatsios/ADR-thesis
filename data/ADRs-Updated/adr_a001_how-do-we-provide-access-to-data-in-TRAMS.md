# Short title
How do we provide access to data sources in TRAMS for external consumers and developers who want to work with TRAMS?

# Status
CLOSED

# Context
The Trust, Record and Management System (TRAMS) is a core system that manages the data and business logic that is central to managing the Academies and Free Schools category of services for the Department for Education. 
At present the access to the TRAMS central data store is controlled via a set of Dynamics hosted OData generated endpoints used to enable integration of external services or applications with schemas managed by Dynamics 365 (see [Current contextual architecture view PNG](diagrams/adr_a001_as-is_contextual_trams.png). Dynamics 365 is a proprietary licensed system from Microsoft that is modular in design (see [supporting info](#supporting-info)) 
OData as a standard is optimised for focusing on business logic when building RESTful APIs over focusing on adhering to REST. There is room within OData to deviate from REST principles if there is a compelling business reason to do so. This deviation from REST is prevalent within our current OData API and its tight coupling to Dynamics requires business knowledge for external consumers to obtain data from TRAMS.
The endpoints are tied closely to the underlying Dynamics data schema. This schema is optimised for the use of Dynamics over optimised for external consumers. For example its data model is non-relational and requires knowledge of Dynamics in order to traverse.  
We need a solution that supports our objectives for creating a sustainable development capability within SDD, aligns to our desired technical strategy where we would like to decouple from Dynamics where possible by building loosely coupled and extensible services within TRAMS that are easier to develop against.

# Options
1. Do nothing and developers continue to use OData endpoints generated by Dynamics.
2. Allow developers to integrate directly with the relational data store.
3. Develop a bespoke interface for developers to integrate with as an abstraction from the relational data store.
4. Utilise a new Dynamics integration option such as a Custom Service (see [supporting info](#supporting-info)) as part of Dynamics in order to replace OData interface.

# Decision
Option 3

# Rationale
- Allows us to utilise commonly known open standards when designing our API that is not coupled tightly to business logic within Dynamics. 
- Provides us with greater flexibility to implement the access controls we need for external consumers such as rate limiting. 
- Allows us to provide access to data in a standardised format and schema that is abstracted from the Dynamics schemas (see [to-be contextual architecture view PNG](diagrams/adr_a001_to-be_contextual_trams.png))
- We leverage the O in SOLID by being open to extension, closed for modification supporting the technical strategy. Currently data is open for modification and is not governed appropriately within Dynamics which is then exposed to consumers directly via the OData endpoints.
- Allows us to ensure technology selection is maintainable and supportable by the department's digital teams and targeted capability areas. We are able to leverage our existing developer team skills to the maximum.
- Avoids vendor lock-in by not adding or increasing the dependency on Dynamics 365. 
- Long term departmental goal is to gain the capability to run a full live-service support team - this decision enables this goal to be achieved by a shorter distance. By us deciding to build it we will have inherent low level knowledge of how to run it and support it without being reliant on additional support contracts.
- Provides greater architectural options in the future by applying a strangler and appropriately abstracted interface pattern giving us greater flexibility to evolve this offering.
- This decision has the lowest impact on all other existing and planned development and business initiatives within the SDD TRAMS domain.
- Adding a bespoke interface that interacts directly with the central data store, rather than via Dynamics, provides greater control on how data flows and propagates to all other data stores such as Dynamics or KIM. This gives us greater control over how we manage/update our data within TRAMS.
- Continuing to use the OData interface is considered to be inefficient (XML) requiring multiple calls for data traversal and retrieval. We will not be able to implement access controls for external consumers such as rate limiting.
- Makes it easy for developers to reuse their developed integration patterns against our bespoke interface as we can establish a standard pattern for all APIs in any other areas of SDD.
- It is not considered to be best practice to provide external developers direct access to our data store for performance, governance and security reasons to name a few.

# Dependencies
- High investment decision requiring time, skills and personnel to achieve this decision. 
- Incremental migration needs to occur for teams that are already utilising the underlying data that they access via the current OData interface.
- Introduces a new dependency on non TRAMS SDD development teams who have committed to using the underlying data but need to develop a new integration with this to-be developed interface. 
- Wide range of department, team and user needs on the data which requires prioritisation on API development approach. This requires a series of prioritised vertical slices of data interface use cases to drive the development approach.

# Impact
- We will need to agree the appropriate security approach for securing access to this new interface. 
- Data in transit will need to be secured for external consumption.
- To mitigate we will develop the API contract ahead of implementation to allow other teams to develop to the contract in parallel.
- Implement controls to maintain data consistency in the source data store as well as any downstream stores that need updating (such as KIM). 
- An additional ADR is required in order to decide on what technology (inc. languages and frameworks) to develop a bespoke TRAMS data interface.
- An additional ADR is required in order to decide what platform or infrastructure will be used to host and manage the TRAMS data interface.

# Contributors
- Steven Leighton
- Dan Burnley
- Rob Marshall
- Miranda Hawkes
- Nathan Ouriach
- Andrew Emley
- Chris Oram

# Supporting Info
OData standard - https://www.odata.org/documentation/ \
REST overview -- https://en.wikipedia.org/wiki/Representational_state_transfer \
Dynamics implementation of OData Protocol - https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/data-entities/odata \
Dynamics 365 overview - https://dynamics.microsoft.com/en-gb/what-is-dynamics365/ \
Dynamics integration options overview - https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/data-entities/integration-overview \
[As-is contextual architecture view](diagrams/adr_a001_as-is_contextual_trams.png) \
[To-be contextual architecture view](diagrams/adr_a001_to-be_contextual_trams.png) 




