# 6. Custom Domain properties JSON-LD rendering

Date: 2021-06-14

## Status

Accepted

## Context

This ADR serves to document how Custom Domain Properties are rendered in JSON-LD.

Custom Domain Properties represent dynamic parts of the model. The original domain is extended with annotations which 
may or may not include their own semantic information (when used with semantic extensions).

Given that there is a problem, the AMF Web API model is mostly static. We have static `*Model.scala` objects with each 
model.

## Decision

We will introduce a hack when rendering Custom Domain properties in JSON-LD that will make the graph look like it was 
generated by a dynamic model while still representing the model statically. 

Concretely, the `DomainElementModel` has a `CustomDomainProperties` field which is an `Array(DomainExtensionModel)`. 
Each `DomainExtensionModel` has a `DefinedBy: CustomDomainPropertyModel` and `Extension: DataNode` fields that 
represent the definition and value of the domain extension. 

This in the "traditional & static" parts of the model would be rendered like this (summary):

```json
{
  "@id": "myDomainElement",
  "customDomainProperties": [
    {
      "@id": "myDomainExtension",
      "definedBy": {
        "@id": "myCustomDomainProperty"
      },
      "extension": {
        "@id": "myDataNode"
      }
    }
  ]
}
```
Instead a "dynamic" model is simulated
```json
{
  "@id": "myDomainElement",
  "myCustomDomainProperty": {
    "@id": "myDataNode"
  },
  "customDomainProperties": [
    {
      "@id": "myCustomDomainProperty"
    }
  ]
}
```

As you can see a new property was generated using the `@id` of the `CustomDomainProperty` from the original `definedBy`
field which does not exist in the static model. The `customDomainProperties` property now points to an array of custom 
domain property nodes rather than an array of domain extension nodes. The new `customDomainProperties` value indicates
which properties of the serialized node "are dynamic". 


## Consequences
1. This introduces a difference between the in-memory static model and the serialized JSON-LD model
2. This hack should be dealt with when parsing JSON-LD to retrieve the original static model
3. There is a slight difference when compacting property IRIs and ID IRIs:
    * IRIs from `@id` are relative to the `@base` entry
    * IRIs from properties are relative to the `@vocab` entry or namespace prefix
    
    This means that the strings from the `@id` entries in the `customDomainProperties` array values might not be 
    strictly equal to the strings from the dynamically generated properties' IRIs (APIMF-3160)
