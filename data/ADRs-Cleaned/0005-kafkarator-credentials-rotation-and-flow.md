kafkarator credential rotation flow credential available file environment variable credential made available cluster secret expected name naiserator deploys application requested credential property environment variable file mounted volume property credential made available environment variable name make invalid environment variable property credential available file mounted volume credential rotation triggered manual topic edit schedule kafkarator process topic based event kubernetes api server event added modified deleted addition request full list topic kubernetes api server every hour event typically happen developer make change topic kubernetes resource instance adding application topic acls changing topic configuration removing application topic acls credential expire faulty schedule kafkarator process topic generate necessary service user acls credential making rotating credential record expiration timestamp credential statusfield topic kubernetes resource thus processing topic kafkarator check expiration timestamp recorded topic kubernetes resource timestamp past rotate credential accessing topic processed current implementation application credential access multiple topic thus risk multiple independent expiration timestamps one per topic triggering rotation credential implementation detail brings consequence frequent rotation credential intended also trigger rotation credential unforeseenunexpected time application attached topic credential rotated time due implementation detail discussed expiration timestamp recorded topic passed application access topic credential rotated resulted massive credential purge subsequent restarts application access topic many producer consumer kafkarator purge service user processing topic topic updated synchronization loop kafkarator kick part loop service user recreated rotating credential team legacy system cant make autorotated credential team legacy system able run nais platform cluster time make difficult make aiven kafka since application get automated access rotated credential current flow kafkarator two mode operation primary follower follower responsible maintaining secret nongcp cluster response event sent primary primary take care managing topic service user acls credential primary main loop step roughly create update topic create andor delete acls recreate service user generate secret produce encrypted secret send follower write back sync hash deterministic name name service user secret deterministically generated possible recreate name namespace owning application limit number service user aiven project aiven limit number service user allowed current limit service user navdev navprod project maximum applied far customer rotation security feature one way solve problem would drop rotation entirely instead could rely manual rotation discover security perspective something consider good enough nais operator dealing credential nais operates number operator deal credential common pattern justintime provisioning credential model credential generatedrotated deploy would remove much problem today new synchronization flow split loop two part existing main loop perform step create update topic create andor delete acls wildcards match set service user write back sync hash naiserator deploys application request kafka access naiserator create deployment reference new secret time create aivenapplication resource naming secret new loop possibly entirely new operator respond aivenapplication resource perform step create service user aiven create secret cluster write back sync hash delete obsolete secret cluster delete obsolete service user aiven solves problem topic expiration timestamp triggering rotation provides place store additional information application information aivenapplication name secret aiven service starting kafka pool kafka cluster aiven application overlapping valid credential every deploy application service user created ensures fresh credential every deploy existing service user touched unless longer deterministic name service user service user fixed prefix generated application name acls written match wildcards monitor number service user since service user limited resource aivenio ensure monitor number approach limit must take step handle like requesting aivenio increase limit consequence number service user generated kafka increase likely limit increased complexity kafkarator increase additional resource manage might mitigated separating handling credentialsusers separate operator rotation credential happen deploy application legacy application manually create aivenapplication resource get credential credential rotated updating aivenapplication resource manually longer propagate secret primaryfollower kafka credential generated application life primaryfollower concept longer needed