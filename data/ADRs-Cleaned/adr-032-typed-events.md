adr typed event changelog sept initial draft author anil kumar anilcse jack zampolin jackzampolin adam bozanich boz proposed abstract currently cosmos sdk event defined handler message well beginblock endblock module doesnt type defined event implemented mapstringstring else make event difficult consume requires great deal raw string matching parsing proposal focus updating event typed event defined module emitting subscribing event much easier workflow come experience akash network team currently cosmos sdk event defined handler message meaning module doesnt canonical set type event else make event difficult consume requires great deal raw string matching parsing proposal focus updating event typed event defined module emitting subscribing event much easier workflow come experience akash network team platform requires number programmatic chain interaction provider datacenter bid new order listen lease created user application developer send app manifest provider side addition akash team maintaining ibc relayer another event driven process working core piece infrastructure integrating lesson learned kubernetes development team developed standard method defining consuming typed event cosmos sdk module found extremely useful building type event driven application cosmos sdk get extensively apps like peggy peg zone ibc defi etc exploding demand event driven application support new feature desired user propose upstreaming finding cosmos sdk enable cosmos sdk application quickly easily build event driven apps aid core application wallet exchange explorer defi protocol stand benefit work proposal user able build event driven cosmos sdk apps writing eventhandlers specific event type passing eventemitters defined cosmos sdk end proposal contains detailed example consume event refactor proposal specifically consume event client blockchain intermodule communication step implement additional functionality type package emittypedevent parsetypedevent function typeseventsgo emittypedevent take typed event emits converting sdkevent func eventmanager emittypedeventevent protomessage error evttype protomessagenameevent evtjson err codecprotomarshaljsonevent err nil return err var attrmap mapstringjsonrawmessage err jsonunmarshalevtjson attrmap err nil return err var attrs abcieventattribute range attrmap attrs appendattrs abcieventattribute key bytek value ememiteventevent type evttype attribute attrs return nil parsetypedevent convert abcievent back typed event func parsetypedeventevent abcievent protomessage error concretegotype protomessagetypeeventtype concretegotype nil return nil fmterrorffailed retrieve message type eventtype var value reflectvalue concretegotypekind reflectptr value reflectnewconcretegotypeelem else value reflectzeroconcretegotype protomsg valueinterfaceprotomessage return nil fmterrorfq implement protomessage eventtype attrmap makemapstringjsonrawmessage attr range eventattributes attrmapstringattrkey attrvalue attrbytes err jsonmarshalattrmap err nil return nil err err jsonpbunmarshalstringsnewreaderstringattrbytes protomsg err nil return nil err return protomsg nil emittypedevent method eventmanager take typed event input apply json serialization map json keyvalue pair eventattributes emits form sdkevent eventtype type url proto message subscribe emitted event cometbft websocket emitted form abcievent parsetypedevent par event back original proto message step add proto definition typed event msg module example let take msgsubmitproposal gov module implement event type protobuf protocosmosgovvbetagovproto add typed event definition package cosmosgovvbeta message eventsubmitproposal string fromaddress uint proposalid textproposal proposal step refactor event emission typed event created emit sdkemittypedevent xgovhandlergo func handlemsgsubmitproposalctx sdkcontext keeper keeperkeeper msg typesmsgsubmitproposali sdkresult error typescontexteventmanageremittypedevent eventsubmitproposal fromaddress fromaddress proposalid proposal proposal subscribe typed event client note full code example user able subscribe clientcontextclientsubscribe consume event emitted eventhandlers akash network built simple pubsub subscribe abcievents publish typed event please see code sample detail flow look client consequence positive improves consistency implementation event currently cosmos sdk provides much ergonomic way handle event facilitates writing event driven application implementation support middleware ecosystem eventhandlers negative detailed code example publishing event adr also proposes adding affordances emit consume event way developer write eventhandlers define action desire take eventemitter type describes event emitter function defined intypeseventsgo type eventemitter funccontextcontext clientcontext eventhandler error eventhandler type function handle event coming event bus defined typeseventsgo type eventhandler funcprotomessage error sample function func main ctx cancel contextwithcancelcontextbackground err txemitterctx clientcontextwithnodeuritcplocalhost submitproposaleventhandler err nil cancel panicerr return submitproposaleventhandler example event handler print proposal detail eventsubmitproposal emitted func submitproposaleventhandlerev protomessage err error switch event evtype handle governance proposal event creation event case govtypeseventsubmitproposal user define business logic fmtprintlnevfromaddress evproposalid evproposal return nil default return nil txemitter example event emitter emits transaction event implemented somewhere cosmos sdk cosmos sdk include eventemitters tmeventtx andor tmeventnewblock new block event may contain typed event func txemitterctx contextcontext clictx clientcontext ehs eventhandler err error instantiate start cometbft rpc client client err clictxgetnode err nil return err err clientstart err nil return err start pubsub bus bus pubsubnewbus defer busclose initialize new error group ctx errgroupwithcontextctx publish chain event pubsub bus eggofunc error return publishchaintxeventsctx client bus simappmodulebasics subscribe bus event subscriber err bussubscribe err nil return err handle event coming bus eggofunc error var err error select case ctxdone return nil case subscriberdone return nil case subscriberevents range ehs err ehev err nil break return nil return groupwait publishchaintxevents event cmtclient wait shutdown signal exit func publishchaintxeventsctx contextcontext client cmtclienteventsclient bus pubsubbus err error subscribe transaction event txch err clientsubscribectx txevents tmeventtx err nil return err unsubscribe transaction event function exit defer func err clientunsubscribeallctx txevents errgroup manage concurrency ctx errgroupwithcontextctx publish transaction event goroutine ggofunc error var err error select case ctxdone break case switch evt eddatatype case cmttypeseventdatatx evtresultisok continue range event parse send pubsub bus abciev range event typedevent err sdkparsetypedeventabciev err nil return err err buspublishtypedevent err nil busclose return continue return err exit error cancellation return gwait reference publish custom event via bus consuming event client