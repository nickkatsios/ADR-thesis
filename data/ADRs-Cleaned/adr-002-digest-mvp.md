record mvp implementation digest introduction january started one latest major piece functionality would required meet mvp minimal viable product allow launch notify powered iteration email alert api document serf outline architecture planned explain purpose individual component specific product change architecture determined product differed previous understanding digest function explored adr biggest influenced change intention send user single digest email contained topic consistent govdelivery previously intended launch change subscription separate email change govdelivery store delivery preference immediate daily weekly subscription level rather user level mean user signed receive email list immediately dailyweekly digest others diagram component digestinitiatorservice two class represent respective digest period dailydigestinitiatorservice weeklydigestinitiatorservice responsibility start process create digest ensure multiple digest started concurrently initially class named digestschedulerservice however felt ill fitting class actual responsibility shall interfaced scheduling service run set time appropriate period create digestrun model ensure multiple digest period run concurrently interface digestrunsubscriberquery determine subscriber due receive email digest configurable time digest run digestrun model represents distinct run period digest daily weekly responsibility persist data related full digest run subscriber initially named digest however transpired already module ruby standard library named digest shall store information digest run period digest start time digest period end time digest period store timestamp email created digest act indicator complete may unique index digest period however would limit ability rerun digest case problem digestrunsubscriberquery responsible taking digestrun instance determine subscriber receive email digest period shall digestrun determine subscriber receive email digest period determine subscriber due notified least one content change return list referencing subscriber may return activerecord scope allow caller deal returning unlimited output digestrunsubscriber model associate digestrun subscriber instance mostly persisted piece data log subscriber receive email due digest unlikely needed long term shall store association digestrun association subscriber store timestamp completed therefore work digestrun complete digestgenerationworker worker entity accepts argument digestrunsubscriber responsibility create email entity associated subscriber shall pas digestrunsubscriber subscriptioncontentchangequery retrieve collection subscriptioncontentchangequeryresult instance represents subscription contentchanges associated subscription interface digestemailbuilder build email entity create subscriptioncontent instance contentchange per subscripption mark digestrunsubscriber completed mark digestrun completed digestrunsubscriber complete digestrun subscriptioncontentchangequery given digestrunsubscriber determine contentchanges associated subscription digest period class began analogue subscriptionmatcher find subscription associated contentchange decided however would require additional class interface digestrunsubscriber decided longer inverse also decided name suffixed query rather matcher rename subscriptionmatcher suffix shall return array containing subscriptioncontentchangequeryresult instance subscriptioncontentchangequeryresult instance contain detail subscription contentchange instance subscription allow rendering email contentchanges subscription may return necessary field limit memory usageexecution time digestemailbuilder digestemailbuilder take argument digestrunsubscriber collection subscriptioncontentchangequeryresult object take data create email instance formally type class suffixed renderer emailrenderer however felt class responsibility include persisting email instance therefore creation pattern shall create email instance create unsubscribe link distinct email builder create immediate email responsible deciding duplicate contentchange entry supplementary change order implement change number existing area identified email emailrenderer changed intend rename emailrenderer class reflect immediate contentchanges renamed immediateemailbuilder also intend invert responsibility email calling instance emailrenderer instead instance immediateemailbuilder create instance email iterating subscriptioncontent subscripioncontent model intended associate contentchange entity subscription email absence email model indication required processing immediate email however becomes problematic introduce subscriptioncontent instance digest processed immediate email decided way resolve introduce additional field subscriptioncontent foreign key digestrunsubscriber null entry column would indicate email intended immediate processing