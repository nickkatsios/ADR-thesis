title refund handling area checkout tag payment refund capture shopware offer way unified refund handling result every payment extension either implementing want implement following structure offer unified refund handling extension type new refund data structure payment extension persist actual capture refund handling capture bound specific ordertransaction capture amount allows saving external reference ordertransactioncapture capture directly associated transaction relation ordertransactioncaptures ordertransaction database table type field name reference binary binary transactionid ordertransactionid binary stateid statemachinestateid varchar null externalreference longtext amount longtext null customfields entity type property name string string transactionid string stateid stringnull externalreference float totalamount calculatedprice amount arraynull customfields ordertransactionentitynull transaction statemachinestateentitynull statemachinestate ordertransactionrefundcollectionnull refund ordertransactioncapturerefund refund directly associated capture relation ordertransactioncapturerefunds ordertransactioncapture database table type field name reference binary binary captureid ordertransactioncaptureid binary stateid statemachinestateid varchar null reason longtext amount longtext null customfields varchar null externalreference entity type property name string string captureid string stateid stringnull externalreference stringnull reason float totalamount calculatedprice amount arraynull customfields statemachinestateentitynull statemachinestate ordertransactioncaptureentitynull transactioncapture ordertransactioncapturerefundpositioncollectionnull position ordertransactioncapturerefundposition refund position optional refund positionspecific relate ordertransactioncapturerefundpositions ordertransactioncapturerefund database table type field name reference binary binary refundid ordertransactioncapturerefundid binary lineitemid orderlineitemid int quantity varchar null reason longtext refundamount longtext null customfields entity type property name string string refundid string lineitemid stringnull reason int quantity float refundprice calculatedprice refundamount arraynull customfields orderlineitementitynull lineitem ordertransactioncapturerefundentitynull ordertransactioncapturerefund change existing entity paymentmethod add refundhandlingenabled computed field payment method handler implement refundhandlerinterface ordertransaction add onetomanyassociation ordertransactioncapturecollection capture orderlineitem add onetomanyassociation ordertransactioncapturerefundpositioncollectionnull refundpositions state machine add new state machine ordertransactioncapture ordertransactioncapturerefund ordertransactioncapture want add following state new ordertransactioncapturestate state machine pending completed failed ordertransactioncapturerefund want add following state new ordertransactioncapturerefundstate state machine open inprogress cancelled failed completed paymentrefundhandlerinterface add interface outlined php public function refundstring orderrefundid void paymentrefundprocessor paymentrefundprocessor get triggered via corresponding adminapi action contains method processrefund outlined php public function processrefundstring refundid response apps whole refund handling available apps plugins following change required allow apps handle refund shopwarecoreframeworkappmanifestxmlpaymentmethod add refundurl manifest paymentmethod also change xsd accordingly apprefundhandler add apprefundhandler assembles payload talk app refund endpoint capture apps capture written adminapi endpoint