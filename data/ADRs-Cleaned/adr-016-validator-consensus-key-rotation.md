adr validator consensus key rotation changelog oct initial draft nov add key rotation fee validator consensus key rotation feature discussed requested long time sake safer validator key management policy httpsgithubcomtenderminttendermintissues suggest one simplest form validator consensus key rotation implementation mostly onto cosmos sdk dont make update consensus logic tendermint tendermint mapping information consensus key validator operator key meaning tendermint point view consensus key rotation validator simply replacement consensus key another also noted adr includes simplest form consensus key rotation without considering multiple consensus key concept multiple consensus key concept shall remain long term goal tendermint cosmos sdk pseudo procedure consensus key rotation create new random consensus key create broadcast transaction msgrotateconspubkey state new consensus key coupled validator operator signature validators operator key old consensus key becomes unable participate consensus immediately update key mapping state onchain start validating new consensus key validators hsm update consensus key hsm new rotated key height msgrotateconspubkey committed blockchain consideration consensus key mapping information management strategy store history key mapping change kvstore state machine search corresponding consensus key paired given validator operator arbitrary height recent unbonding period state machine historical mapping information past unbonding period key rotation cost related lcd ibc lcd ibc trafficcomputation burden exists frequent power change current tendermint design consensus key rotation seen power change lcd ibc perspective therefore minimize unnecessary frequent key rotation behavior limited maximum number rotation recent unbonding period also applied exponentially increasing rotation fee limit rotation limited time unbonding window future rewrite staking module could made happen time parameter decided governance stored genesis file key rotation fee validator pay keyrotationfee rotate consensus key calculated keyrotationfee maxvotingpowerpercentage initialkeyrotationfee number rotation conspubkeyrotationhistory recent unbonding period evidence module evidence module search corresponding consensus key height slashing keeper decide consensus key supposed given height abcivalidatorupdate tendermint already ability change consensus key abci communicationvalidatorupdate validator consensus key update done via creating new delete old change power zero therefore expect even change tendermint codebase implement feature new genesis parameter staking module maxconspubkeyrotations maximum number rotation executed validator recent unbonding period default value suggestedth key rotation rejected initialkeyrotationfee initial key rotation fee key rotation happened recent unbonding period default value atom suggestedatom fee first key rotation recent unbonding period workflow validator generates new consensus keypair validator generates sign msgrotateconspubkey operator key new conspubkey type msgrotateconspubkey struct validatoraddress sdkvaladdress newpubkey cryptopubkey handlemsgrotateconspubkey get msgrotateconspubkey call rotateconspubkey emits event rotateconspubkey check newpubkey duplicated validatorsbyconsaddr check validator exceed parameter maxconspubkeyrotations iterating conspubkeyrotationhistory check signing account enough balance pay keyrotationfee pay keyrotationfee community fund overwrites newpubkey validatorconspubkey deletes old validatorbyconsaddr setvalidatorbyconsaddr newpubkey add conspubkeyrotationhistory tracking rotation type conspubkeyrotationhistory struct operatoraddress sdkvaladdress oldconspubkey cryptopubkey newconspubkey cryptopubkey rotatedheight int applyandreturnvalidatorsetupdates check conspubkeyrotationhistory conspubkeyrotationhistoryrotatedheight ctxblockheight generates validatorupdate one remove validator one create new validator abcivalidatorupdate pubkey cmttypestmpbpubkeyoldconspubkey power abcivalidatorupdate pubkey cmttypestmpbpubkeynewconspubkey power vconsensuspower previousvotes iteration logic allocatetokens previousvote oldconspubkey match conspubkeyrotationhistory replace validator token allocation migrate validatorsigninginfo validatormissedblockbitarray oldconspubkey newconspubkey note feature shall implemented staking module proposed consequence positive validators immediately periodically rotate consensus key better security policy improved security longrange attack httpsnearorgbloglongrangeattacksandanewforkchoicerule given validator throw away old consensus key negative slash module computation lookup corresponding consensus key validators height frequent key rotation make light client bisection efficient neutral reference tendermint repo httpsgithubcomtenderminttendermintissues cosmossdk repo httpsgithubcomcosmoscosmossdkissues multiple consensus key httpsgithubcomtenderminttendermintissuesissuecomment