cassandra mailbox deletion cleanup lazy consensus implemented cassandra within distributed james product hold message mailbox metadata cassandra hold following table mailboxpathv mailbox allowing retrieve mailbox information acl usermailboxacl hold denormalized information messageidtable imapuidtable allow retrieve mailbox information messagev table hold message metadata attachmentv hold attachment message reference attachment contained within attachmentowner attachmentmessageid table currently deletion deletes first level metadata lower level metadata stay unreachable data look deleted reference actually still present concretely upon mailbox deletion mailboxpathv mailbox content deleted messageidtable imapuidtable messagev attachmentv attachmentmessageid metadata left undeleted upon mailbox deletion acl usermailboxacl deleted upon message deletion messageidtable imapuidtable content deleted messagev attachmentv attachmentmessageid metadata left undeleted jeopardize effort regain disk space privacy example blobstore garbage collection cleanup cassandra metadata retrieved dandling metadata delete operation conducted delete lower level first upon failure undeleted metadata still reached cleanup needed strict correctness mailboxmanager point view thus could carried asynchronously via mailbox listener retried consequence mailbox listener failure lead eventbus retrying execution ensure result deletion idempotent reference jira