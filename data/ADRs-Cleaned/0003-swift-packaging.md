distributing swift package deciders rfkelly problem statement consumer currently obtain applicationservices precompiled framework bundle distributed via carthage current setup compatible building new apple silicon machine number problem part broader effort modernize build process application mozilla asked reevaluate applicationservices component dsitributed see problem current setup detail driver easeofuse consumer compatibility apple silicon machine consistency component developed mozilla ability nimbus swift binding easily depend glean ease maintainability applicationservices developer considered nothing keep current build distribution setup asis carthage build xcframework bundle make minimal change carthage setup build newer xcframework format support apple silicon distribute single precompiled swift package convert allinone mozillaappservices carthage build similar allinone swift package distributed binary artifact distribute multiple sourcebased swift package target precompiled rust code split allinone mozillaappservices carthage build separate swift package target component shared dependency precompiled rust code binary artiact outcome chosen distribute multiple sourcebased swift package precompiled rust code provide best longterm consumer experience developer potential simplify maintenance applicationservices developer initial investment effort positive consequence swift package convenient consume newer version xcode different apps choose import different subset available component potentiallying helping keep application size avoids issue mismatched swift version applicationservices build consumer since swift file distributed source form encourages better conceptual separation swift code different component make possible two swift component define item name without conflict reduces xcode part applicationservices build process favour commandline tool negative consequence upfront work move new setup may likely notice build setup break within xcode exercising code path may harder concurrently publish carthage framework current consumer arent able move swift package likely amount api breakage existing consumer replace single import mozillaappservices independent import component implementation sketch maintain existing carthage build infrastructure applicationservices repo continue publishing prebuilt carthage framework support firefoxios migrate swift package add additional build task applicationservices repo build rust code xcframework bundle initial prototype show achieved relatively straightforward shell script rather requiring second xcode project published zip artifact release way current carthage framework rust code built static library linking process consuming application pull subset rust code needed component consumes initially include nimbus dependency xcframework bundle eventually expand include rust component including glean continue included applicationservices repo git submodule create new repository rustcomponentsswift serve root new swift package distribution import applicationservices repository git submodule let iterate quickly swift packaging setup without impacting existing consumer initially include nimbus dependency new repository nimbus swift code depend glean via external gleanswift package future publish applicationservices component swift interface repository well glean future rust component thats repository given deliberately generic name rustcomponentsswift repo contain packageswift file defines single binary target reference prebuilt xcframework bundle rust code one swift target component reference swift code git submodule depends prebuilt rust code add automation rustcomponentsswift repo automatically track release made applicationservices repo creates corresponding git tag swift package future consumer migrated swift package remove carthage build setup applicationservices repo future consider whether move packageswift definition applicationservices repo whether better keep separate attempting move applicationservices involve nontrivial change release process checksum released xcframework bundle included release tagged version packageswift file pro con nothing would make change build publishing process good least amount work neutral doesnt change maintainability system appservices developer neutral doesnt change amount separation swift code various component neutral doesnt address swift version incompatibility issue around binary artifact bad frustrate consumer want develop apple silicon bad may prevent consumer migrating modern build setup bad would prevent consumer consuming glean swift package would require glean bundled build isnt really tractable included completeness carthage build xcframework bundle would try change build publishing process little possible carthage recent support building platformindependent xcframeworks order support consumer running apple silicon good size change small good support development newer apple machine neutral doesnt change maintainability system appservices developer neutral doesnt change amount separation swift code various component neutral doesnt address swift version incompatibility issue around binary artifact bad consumer expressed preference moving away carthage bad project mozilla moving swift package making inconsistent perceived best practice bad would prevent consumer consuming glean swift package would require glean bundled build bad consumer dont get choose component want without building whole new megazord component want overall current circumstance feel like good opportunity invest little time order set better longterm maintainability happier consumer main benefit quicker attractive circumstance distribute single precompiled swift package would compile rust code swift code component single xcframework bundle distribute binary artifact via swift package similar approach currently taken glean ref bug except single component good swift package preferred distribution format new consumer good support development newer apple machine good aligns component developer mozilla neutral doesnt change maintainability system appservices developer wed keep current xcode project broadly intact neutral doesnt change amount separation swift code various component neutral doesnt address swift version incompatibility issue around binary artifact neutral would prevent consumer consuming glean separate swift package theyd get part allinone swift package bad larger change learn new package manager bad consumer dont get choose component want without building whole new megazord component want overall would marked improvement quo leaf potential improvement much work make neutral bad point good point distribute multiple sourcebased swift package precompiled rust code would compile rust code component single xcframework bundle distribute binary artifact via swift package would declare separate swift source target swift wrapper component depending compiled rust code appearing separate item swift package definition good swift package preferred distribution format new consumer good support development newer apple machine good aligns component developer mozilla good potentially simplify maintenance system appservices developer removing xcode favour commandline script good introduces strict separation swift code component instead compiling together single shared namespace good nimbus swift package could cleanly depend glean swift package good consumer choose component want include good avoids issue swift version incompatibility binary artifact bad larger change learn new package manager downside appears amount work involved initial prototype given confidence change tractable may lead system easier maintain time thus preferred appendix reading bug good historical work move glean swift package material swift package managing dependency swift package manager useful overview understanding swift package dependency declaration give bit deeper dive multiple target different name single package output initial prototype prototype nimbus glean prebuilt xcframework swift package prototype rust code xcframework plus multiproduct swift package depends video demo resulting consumer experience problem current setup doesnt build apple silicon machine possible support arm device build arm simulator build single binary framework carthage dispreferred current consumer dont much experience setup current application service team many detail underdocumented changing build setup requires xcode baseline knowledge component built single swift module meaning see others internal symbol may accidentally conflict naming thing example cant currently two component define structure name consumer prebuilt binary artifact version xcode applicationservices build able swift buildlibraryfordistribution flag overcome dependency support flag specifically swift protobuf lib