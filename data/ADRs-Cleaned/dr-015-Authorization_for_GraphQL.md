invalid authorization graphql created damian pacierpnik damianpacierpnikatsap invalidated remove component proxying request kubernetes api server graphql facade cache resource forward every request api server user token validated rbac consequence authenticated user perform operation supported graphql facade vulnerability patch vulnerability kyma developer additional authorization layer graphql facade possible solution istio rbac support one possible solution istio rbac support istio version istio ingres expose graphql developer define appropriate authorization rule current release istio rbac engine implemented mixer adapter request sent istio rbac engine provided instance authorization template information defined authorization template fetched istio attribute given istio deployment fixed vocabulary attribute understands set service role defines authorization service istio service role specification includes list access rule access rule define authorization group service path method andor constraint property available request authorize request graphql query must known istio rbac engine authorization depends information fetched query query available request sent engine unfortunately graphql query sent request body body available istio attribute currently request cannot send enable implementation envoy filter necessary would provide additional istio attribute required authorization process worth mentioning stable easy solution provide custom envoy filter istio although istio manages filter dynamically trying adjust envoy cause issue side effect support envoy lua http filter istio feature request httpsgithubcomistioistioissues example httpsgithubcommandarjogistioluawebhook authorization graphql implemented rbac role istio make possible appropriate envoy lua filter implemented invalidated consequence graphql must exposed via istio must sidecar injected istio least version totally broken actually least kyma developer implement maintain envoy filter written lua also implement deploy application serf lua filter registered webhook istio pilot next kyma developer register webhook istio pilot customization istio helm chart required developer modify istio pilot discovery container configuration authorization access graphql restricted attribute extracted envoy filter envoy filter executed application kyma injected sidecar however skip parsing request body request graphql lua script broken application webhook accessible istio pilot startup attribute extracted error occurs filter applied mean call blocked rbac engine default behavior lua script refresh automatically istio pilot pod must restarted fetch configuration envoy filter modifying script requires recreating configmap script restarting webhook app pod restarting istio pilot pod expose new resource graphql query required create appropriate service role resource must listed alphabetical order list must enclosed curly bracket solution errorprone result difficult maintain service role example access following query bash curl httpminikubeippost host httpbinlocal query somequery group name service service role yaml apiversion configistioiovalpha kind servicerole metadata name httpbinpostresgroupsservices namespace default spec rule service httpbindefaultsvcclusterlocal path post method constraint key kymagraphqlresources value groupsservices