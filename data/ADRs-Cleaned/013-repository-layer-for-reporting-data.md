repository layer reporting data generate many report simple dashboard mobile app retrieving data report consistent performant manner challenge aggregate filter large amount data across multiple report important user confidence number reported regardless report current report retrieve data variety way region report grab regionservice grab large amount data via controlrateservice result object cohort report grab data cohortservice progress tab mobile app grab data mix activityservice controlrateservice legacy object introduce repository layer responsible returning reporting data provide consistent interface caller provide one many region one many period retrieve whatever value want repository intersection region period repository responsible grabbing value whatever query calculation data source necessary also handle required caching make sure thing performant technique like fetchmulti retrieve set multiple value one round trip cache caching query implementation entirely handled repository plus related object helping opaque caller word caller able ask thing like control rate patient count without caring underlying query actually done proposed partially implemented region report consequence current report migrated time new repository layer storing fine grained value cache redis performance win many reporting metric across set region period memory cache though consider construct query calculation lay repository particular handle calculation dependent many query calculation like missed visit aware certain input impact wide range query ensure passed repository part respective cache key one example withexclusions flag introduced filter patient common denominator sort approach make easier change data source example introduce proper etl based table determining control count subsitute underlying controlratequery repository caller care change