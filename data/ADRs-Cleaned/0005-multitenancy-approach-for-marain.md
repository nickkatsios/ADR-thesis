multitenancy approach marain tenancy always first class citizen marain service however enough make system truly multitenanted order determine tenant created managed within marain world would like deploying marain either managed service hosted licenced user paas offering client deploy private instance cloud subscription also want give client managed service data stored storage account database still run compute aspect platform behalf also extends client marain implement multitenanted service client also able isolate client storage addition able differentiate marain service available client directly one dependency service example workflow service make operation service result client licenced workflow service operation service indirectly despite fact may licenced directly define tenancy model support scenario implemented maraintenancy service support made following every client marain instance marain tenant created remainder document referred client tenant every marain service also marain tenant created remainder document referred service tenant make tenant hierarchy group client tenant service tenant toplevel parent mean toplevel tenant called client tenant parent client tenant equivalent one called service tenant parent service tenant shown diagram client access marain service licenced tenant whilst marain service expect supplied part endpoint path nothing prevent api gateway azure api management put front custom url mapped tenant tenant passed header marain service depends another one part operation pas tenant subtenant service tenant subtenant specific client making original call example workflow service dependency operation control service two client tenant workflow service corresponding subtenant workflow service tenant make call operation service approach allows dependedupon service behalf client without making available direct usage tenant client service clientspecific subtenants service tenant hold configuration appropriate expected case normally required storage configuration service plus subtenants created service could also include thing example suppose two customer contoso litware customer able marain must create contoso litware tenant also two marain service available workflow operation also tenant created following diagram service tenant shown cap client tenant normal sentence case servicespecific client subtenants mix indicate relate root tenant client tenant contoso litware service tenant workflow operation contoso licenced workflow litware licenced workflow operation mean contoso tenant contain storage configuration workflow service configuration onboarding process default standard marain storage data siloed tenant shared storage account single cosmos database containing collection per tenant however client supply storage configuration required litware tenant contain storage configuration workflow operation service directly addition client licenced workflow subtenant workflow service tenant containing storage configuration operation service operation service subtenants dependency marain service root tenant client tenant contoso workflow storage configuration workflowcontoso subtenant workflow service litware workflow storage configuration workflowlitware subtenant workflow service operation storage configuration service tenant workflow workflowcontoso operation storage configuration workflowlitware operation storage configuration operation seen tenant hold appropriate configuration service directly case client tenant also hold subtenant workflow service calling operation service behalf necessary avoid costly search correct subtenant notice litware end two set configuration operation storage employed operation service directly calling workflow service thus operation service indirectly give client maximum flexibility controlling data stored let look slightly complex example imagine scenario third service well call foobar service workflow operation service dependent addition contoso licenced directly dependency graph look like workflow contoso operation litware foobar order support start additional service tenant foobar tenant root tenant client tenant contoso litware service tenant workflow operation foobar enroll contoso workflow service cause chain enrollment whereby subtenant created workflowcontoso enrolled operation service creating subtenant operation operationsworkflowcontoso enrolled foobar service since foobar dependency create sub tenant workflow service also directly dependent foobar workflowcontoso also enrolled foobar resulting storage configuration foobar added leaf tenant hierarchy looking like root tenant client tenant contoso workflow storage configuration workflowcontoso subtenant workflow service litware service tenant workflow workflowcontoso operation storage configuration operationsworkflowcontoso subtenant operation service foobar storage configuration operation operationsworkflowcontoso foobar storage configuration foobar enroll contoso foobar service since additional dependency result subtenants created add storage configuration foobar contoso tenant first example contoso two set storage configuration foobar service one direct one indirect root tenant client tenant contoso workflow storage configuration workflowcontoso subtenant workflow service foobar storage configuration litware service tenant workflow workflowcontoso operation storage configuration operationsworkflowcontoso subtenant operation service foobar storage configuration operation operationsworkflowcontoso foobar storage configuration foobar repeat process enrolling litware workflow service root tenant client tenant contoso workflow storage configuration workflowcontoso subtenant workflow service foobar storage configuration litware workflow storage configuration workflowlitware subtenant workflow service service tenant workflow workflowcontoso operation storage configuration operationsworkflowcontoso subtenant operation service foobar storage configuration workflowlitware operation storage configuration operationsworkflowlitware subtenant operation service foobar storage configuration operation operationsworkflowcontoso foobar storage configuration operationsworkflowlitware foobar storage configuration foobar since litware licenced foobar litware client tenant hold configuration service finally enroll litware operation service example operation depends foobar create another subtenant operation call foobar litware operation directly enroll new subtenant foobar leaf following root tenant client tenant contoso workflow storage configuration workflowcontoso subtenant workflow service foobar storage configuration litware workflow storage configuration workflowlitware subtenant workflow service operation storage configuration operationslitware subtenant operation service service tenant workflow workflowcontoso operation storage configuration operationsworkflowcontoso subtenant operation service foobar storage configuration workflowlitware operation storage configuration operationsworkflowlitware subtenant operation service foobar storage configuration operation operationsworkflowcontoso foobar storage configuration operationsworkflowlitware foobar storage configuration operationslitware foobar storage configuration foobar consequence expected subtenants created configured part process enrolling tenant specific service licenced mean expected happen covered adr without appropriate tooling managing necessary tenant configuration would complex errorprone minimum necessary script basic process assist setting process also necessary ensure appropriate level logging place code read configuration order allow setup problem quickly diagnosed moving lot service configuration tenant mean also produce tooling set service tenant default configuration part deployment process take place existing deployment process arm template add configuration directly host function application