pulsar mailqueue lazy consensus implemented provides adr distributed mailqueue rabbitmq cassandra mail queue mailqueue central component smtp infrastructure allowing asynchronous mail processing enables short smtp reply time despite potentially longer mail processing time also work buffer smtp peak workload overload server furthermore mail exchange server ability add delay observed dequeing element allows among others delaying retries upon delivery failure remote site throttling could helpful considered spammer mailqueue also enables advanced administration operation like traffic review discarding email resetting wait delay purging queue etc existing distributed mailqueue distributed james currently ship distributed mailqueue composing following software following responsibility rabbitmq messaging rabbitmq consumer trigger dequeue operation time series projection queue content order time list mail metadata maintained cassandra time series avoid aforementioned tombstone antipattern polling performed projection objectstorage swift hold large byte content avoids overwhelming software scale well term inputoutput operation per second implementation suffers following pitfall rabbitmq hard reliably operate cluster cluster queue added release line consistency guaranty exchange unclear rabbitmq java driver boiler plate error prone thing like retries exponential backoffs deadlettering come box publish confirms tricky blocking call often performed driver cluster aware would operate connected single host driver reliability questionable experienced crashed consumer never restarted throughput scalability rabbitmq questionable current implementation support priority delay current implementation known complex hard maintain nonobvious tradeoff word apache pulsar apache pulsar cloudnative distributed messaging streaming platform horizontally scalable low latency durability persistent multitenant geo replicated count topic reach several million making suitable queuing usage existing james including one event bus adr adr pulsar support advanced feature like delayed message priority instance making suitable mailqueue implementation helm chart ease deployment available pulsar however complex deploy relies following component stateless broker bookie bookkeeper maintaining persistent log message zookeeper quorum clusterlevel configuration coordination would make suitable large verylarge deployment paas pulsar sdk handy handle natively reactive call retries dead lettering making implementation boiler plate provide distributed mail queue implemented top pulsar email metadata blobstore store email content package mail queue simple artifact dedicated distributed mail processing consequence expect easier way operate cheaper reliable mailqueue expect delay supported well complementary work pulsar technology would benefit broader adoption james eventually becoming defacto standard solution backing apache james messaging capability reach following work undertaken event bus described adr would benefit pulsar implementation replacing existing rabbitmq one described adr see jira critical task manager implementation would needed well replace rabbitmq one described adr adr adr adr adr adr adr eventually allowing drop rabbitmq technology alltogether could create new artifact relying solely pulsar deprecate rabbitmq based artifact broader adoption pulsar would benefit performance insight work could continued instance form google summer code nice complementary work pulsar mailqueue work top deduplicated blob store able list blob referenced pulsar mailqueue see jira support deduplicated blob queue short lived benefit term storage space yet enables single blob creation accross full message lifecycle message body priority yet supported current implementation see jiraxxxx technical detail section requires deep review akka actor system single node mode processing framework mailqueue relies following topology topic contains mail ready dequeued scheduled topic email delayed first enqueued filter topic deletion name sender recipient prior given sequence synchronized node topic filter scheduled topic deletion scheduled topic applied moving item scheduled topic topic consumer topic scheduled topic subscription name shared consumer filter topic consumer unique subscription name therefore receive copy every message topic ensures full distribution filter state node cluster upon enqueue blob first saved pulsar message payload generated published relevant topic scheduled scheduled message deliveredat property set desired value delay expired message consumed thus moved topic flush simply copy content scheduled topic topic reset offset scheduled queue atomically expired filter removed note current version pulsar scheduled job handle scheduled message accuracy scheduling limited frequency job run size mail queue simply computed scheduled topic upon deletes condition deletion well sequence applies synchronized across node inmemory datastructures wrapped actor instance unique subscription thus maintain set deletion ever performed mechanism repeated scheduled topic respective sequence value set filter upon dequeues message scheduled topic filtered inmemory data structure exposed reactive publisher upon browsing scheduled topic read consumption offset filtering applied upon clear topic deleted miscellaneous remark design implementation doesnt try offer absolute consistency guarantee tend lean side eventual consistency instance message moved scheduled topic might temporarily browsed double deletes might apply instantly pulsar admin client list existing queue move current offset scheduled message subscription upon flush priority yet supported metadata transit pulsar general purpose james blobstore backed compatible api store underlying email content please note mail queue tradeoff behind blob store choice different long term storage cheaper storage cost would preferable higher latency especially writes done asynchronously whereas mailqueue would benefit expensive low latency storage email stay long low write latency user facing smtp might benefit future support usage distinct blob store solution back queue reference apache pulsar material regarding adr adr mailing list discussion jira james contributing original pulsar mailqueue