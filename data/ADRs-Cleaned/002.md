adr inserting dynamic proposed deciders redeboer spflueger problem statement physic model usually include assumption simplify structure model example splitting model product independent part every part contains certain responsibility case partial wave amplitude model make separation spin part dynamical part spin part control probability wrt angular kinematic variable dynamic control probability variable like invariant mass state generally dynamic part simply function defined complex space consists mathematical expression sympyexpr set parameter expression tweaked optimized set kinematic variable expression applies technical story see refadrissues existing setup way supply custom dynamic least modtensorwaves understand custom dynamic adr parameter variable expressed sympysymbols dynamic specified mapping sympyfunction sympyexpr way supply sympyexprs expected sympysymbols parameter variable issue existing setup clear way apply dynamic function specific decaying particle specific edge statetransitiongraphs stg currently work mapping particle dynamic expression feasible identical particle edge set variable dynamic expression applies determined position within stg applied instance relativistic breitwigner applied resonance isobar decay described stg final state edge intermediate edge would work invariant mass edge msq like variable parameter identifiable position within stg take relativistic breitwigner form factor would require breakup momentum parameter also require suggested starting value expected pole position starting value usually taken edge node property within stg driver following point nice influence essential part user responsibility parameter dynamic function requires registered automatically linked together kinematic variable dynamic function also linked appropriately easy define custom dynamic boilerplate code solution requirement easy apply dynamic specific component stgs note important dynamic applied resonance selected graph generally graph resonance appears possible suggested initial parameter value provided well possible inspect dynamic expression independently expertsystem follow openclosed principle probably important driver solution flexible enough handle possible scenario without change interface defined requirement considered solution group expression builder satisfy requirement propose following syntax python model modelinfo graph statetransitiongraph modelsetdynamicsgraph edgeid expressionbuilder toggle another style would modelinfo contain reference list statetransitiongraphs user way express edge apply dynamic function python modelsetdynamics filterlambda pnamestartswithf edgeid expressionbuilder expressionbuilder function method create dynamic expression also class contains implementation expression static method build statetransitiongraph dynamic expression formulated way satisfies rest requirement following illustrate three different way formulating dynamic expression taking relativistic breitwigner relativistic breitwigner form factor example toctree maxdepth composition function expr group expressiononly second branch solution would propose following interface python model modelinfo graph statetransitiongraph modelsetdynamicsgraph edgeid expression key difference usage general sympy expression sympyexpr argument instead constructing builder object solution evaluation expression builder solution drawback arising choice interface expressionbuilder enforces logic correctly coupling variable parameter builder extremely hard get right since code able handle arbitrarily complex model always knowing user would like impossible therefore much better already built expression assumed correctly built see solution group solution group also following additional drawback however related correct building dynamic expression implicit assumption signature expression first argument assumed kinematic variable remaining argument parameter addition argument cannot keywords positional number variable parameter verified runtime static typing check element sympysymbol composition cleanest design tune design modsympy docfunction docexpr follow modsympy implementation result obscure inheritance hierarchy implicit convention result nasty bug instance one call method either sympyfunction sympyexpr implementation pro con specific implementation listed doccomposition positive implementation expression transparent negative refadrcompositionalternative signature way see relativisticbreitwignerfromgraph builder relativisticbreitwigner name make implementing custom dynamic inconvenient errorprone signature builder checked classtypingprotocol see refadrcompositiontype checking docfunction positive dynamicsfunction behaves classsympycorefunctionfunction implementation builder kept together implementation expression negative possible identify variable parameter docexpr positive docrecursing amplitude model sympytutorialmanipulation still possible identify instance dynamicsexpr doit called additional property method added carried around class negative boilerplate code required implementing custom dynamic refadrexprissue lambdify expressiononly positive choice interface follows principle solid solution group handing complete expression dynamic setter sole responsibility insert expression correct place full model expression negative direct negative aspect solution split responsibility construction expression correct linking parameter initial value etc performed code code subject issue mentioned individual solution group outcome composition based solution group important definition interface following solution group ensures openclosed keep responsibility separated expertsystem favor composition inheritance intend inheritance define interface insert behavior design expertsystem fundamentally different sympy thats another reason favor composition interface determined dependency instead remain doccontained within dynamic class composition decide keep responsibility separated possible mean responsibility setdynamics method attribute expression sympyexpr correct symbol within complete amplitude model position specified statetransitiongraph edge syntax may improved later see python def setdynamics self graph statetransitiongraph edgeid int expression spexpr none dynamicssymbol graph edgeid selfdynamicsdynamicssymbol expression pas assumed expression correct user responsibility formulating expression correct symbol aid user construction expression building code handle common task variablepool facilitate finding correct symbol name avoid typo python mass variablepoolgetinvariantmassgraph edgeid dynamic module provides description common lineshapes well helper function example would python invmass mass gamma buildrelativisticbreitwignergraph edgeid particle relbw sympyexpr relativisticbreitwignerinvmass mass gamma modelsetdynamicsgraph edge relbw sympymodel responsibility defining full model term expression keeping track variable parameter instance python attrskwonlytrue class sympymodel top spexpr attrib intensity dictspsymbol spexpr attribdefault amplitude dictspsymbol spexpr attribdefault dynamic dictspsymbol spexpr attribdefault parameter setspsymbol variable setspsymbol variablepool def fullexpressionself spexpr