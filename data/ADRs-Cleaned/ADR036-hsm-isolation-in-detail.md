adr cloudhsm isolation amended adr gsp cluster provide cloudhsm instance important ensure authorised application cloudhsm different choice available technical control prevent unauthorised access adr post hoc document document existing practice writes already agreed didnt capture adr network isolation network isolation ensures authorised application permitted open connection cloudhsm traditional aws world could achieved security group app would security group hsm security group would allow connection authorised apps kubernetes pod share subnet set mean hsm security group cannot distinguish traffic coming different apps kubernetes provides network policy place control pod allowed connect pod network policy similar security group think layer stateful firewall also deployed istio advanced networking tool provides many feature adr main thing provides network control higher level broadly layer provider implementing kubernetes network policy calico extends kubernetes api flexible resource allowing finer grained control routing rule calico resource overlap native kubernetes network policy istios powerful higherlevel traffic management feature authentication credential management order cloudhsm connect also authenticate cloudhsm support multiple user user different username password authorised eidas apps username password provided secret apps namespaces access secret therefore required username password authenticate cloudhsm prevent unauthorised network access cloudhsm setting globalnetworkpolicy denies access cloudhsms address unless pod carry label talkstohsmtrue allows egress traffic setting tenant namespace istios sidecar injection service mesh mesh enabling istios mesh route traffic destination service registry requiring istio serviceentry explicitly created order allow egress traffic mesh prevent unauthorised apps cloudhsm credential deploying credential secret namespace authorised apps consequence user create pod verify cluster namespace eidas namespace provided set correct label able establish tcp connection cloudhsm eidas run subset command cloudhsm require require authentication currently appears following command gethsminfo getkeyinfo info listusers quit user somehow bypass istioinjected sidecar able establish tcpudp connection endpoint cloudhsm unless done pod correct label