adr devnet celestia node author renaynay wondertan liamsi changelog initial draft legend celestia core tendermint consensus node life celestiacore repository celestia node celestia full light node live repository adr describes basic predevnet design celestia node decided august kyiv offsite ideally completed early november tested first devnet goal design get basic structure celestia node interoperating celestia core consensus node november devnet basic interoperability devnet effort merge consensus functionality celestia node design modulor service added top basic function celestia node celestia node distinctly different celestia core node initial implementation devnet plan merge consensus core functionality general design celestia node added additional consensusservice node devnet require two mode celestia node light full light node performs data availability sampling full node process store serf new block either celestia core consensus node required devnet celestia full node optional devnet devnet light celestia node must able following propagate relevant block information form extendedheaders badencodingfraudproofs celestia node peer verify extendedheaders perform serve sampling sharesbynamespace request note light node serve share theyve already requested stored default result way bitswap work bitswap node something another node want serve request state get accountbalance order submit transaction devnet full celestia node must able everything light celestia node addition following receive raw unerasure coded block celestia core node subscribing newblockevents block rpc endpoint celestia core node erasure code block verify erasure coding create extendedheader raw block header generated dataavailabilityheader dah well validatorset serve extendedheader celestia network request raw block full celestia node network optional devnet detailed design celestia node central node data structure around service focused service kind data retrievalsharingstorage process started stopped core node example everything related retrieving block erasure coding verifying storing contained blockservice configured registered started node user able initialise celestia node either full light node upon start node get created configured also configure service register node based node type light full full node encompasses functionality light node along additional service allow interact celestia core node light node provide following service extendedheaderservice service registered node startedstopped contains every process related retrieving extendedheaders actively passively well storing extendedheaderexchange requestresponse extendedheadersub broadcast extendedheaderstore fraudproofservice optional devnet service registered node startedstopped contains every process related retrieving badencodingfraudproofs statefraudproofs fraudproofsub broadcast fraudproofstore shareservice service registered node startedstopped contains every process related retrieving share randomly sampling namespace network well storage share shareexchange requestresponse sharestore stateservice optional devnet service registered node startedstopped contains every process related retrieving state given block height account stateexchange requestresponse transactionservice dependent stateservice implementation optional devnet simple server registered node started stopped handle endpoint like submittx submittx requestresponse full node provide following service extendedheaderservice service registered node startedstopped contains every process related generating propagatingretrieving extendedheaders actively passively well storing extendedheaderexchange requestresponse extendedheaderverification full node extendedheadersub broadcast extendedheaderstore fraudproofservice optional devnet service registered node startedstopped contains every process related generating broadcasting storing badencodingfraudproofs statefraudproofs fraudproofgeneration fraudproofsub broadcast fraudproofstore shareservice service registered node startedstopped contains every process related requesting providing share note full node separate sharestore store full block shareexchange requestresponse blockservice blockerasurecoding newblockeventsubscription full node celestia core node request blockexchange optional devnet full node full node requestresponse blockstore stateservice optional devnet stateexchange full node celestia core requestresponse transactionservice dependent stateservice implementation optional devnet submittx devnet possible celestia full node receive information directly celestia core node consideration state fraud proof celestia node able propagate statefraudproofs must modify celestia core store block invalid state serve celestia node celestia app celestia app must able generate serve statefraudproofs via rpc celestia node feature necessarily required devnet state execution functionality celestia full node stubbed would nice devnet likely allow celestia full node speak celestia full node instead running trusted celestia core node simultaneously relying information roadmap implementation could look like following celestia full node would adhere abci interface order communicate celestia app similar way optimint celestia full node would send state request celestia app order celestia app replay transaction block verify state alternatively celestia full node would also able replay transaction order verify state generate state fraud proof devnet okay stub state verification functionality example celestia full node would download reserve transaction replay fraud proof validators celestia core able sign block erasure code block data commit data root erasure coded block stored header validators store erasure coded block raw block data root header celestia node fetch raw block celestia core via block endpoint erasure code block checking data root header store erasure coded block devnet celestia node able generate state fraud proof state execution environment rely celestia core produce state fraud proof retrieve proof via statefraud endpoint celestia node also require state fraudulent block celestia core make block available via block endpoint light node serving share sample moment bitswap retrieve sample share network way bitswap work requires node requested data serve necessarily ideal light node supporting serving samplesshares would expand resource requirement light node negative bitswap include somewhat couple storage networking difficult compute inner proof node demand instead storing default requires multiple roundtrips could single least fewer roundtrips wrote protocol particularly relevant case celestia node run download whole block via network celestia node instead tendermint via rpc current implementation bitswap ipfs quite inefficient compared protocol bitswap sharelevel code directly control dependency future consider moving away bitswap either graphsync custom protocol consequence design ideal get devnet quickly allow iterate rather try design implement perfect celestia node start positive iterative process allow test nonpprelated functionality much sooner allow incrementally approach debugging rather trying get designimplementation perfect one negative end throwing lot implementation work since eventual goal merge consensus functionality concept celestia node current design requires erasure coding done twice store data twice raw block celestia core erasure coded block celestia node redundant consolidated future open question celestia core node also generate serve fraud proof serve invalid block celestia full node proposed