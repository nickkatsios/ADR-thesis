adr forward compatibility persistable enums server response restful apis tend return enumerated value represent property fixed number welldefined value usually represented enum class client new business case introduced could addition value value consumed fly persisted client could simply treated special case unknown ignored together simple offlinefirst application value persisted database hence enumerated value cannot represented kotlin enum class offlinefirst mean unique constraint deal apps older app version able handle new enum value added type even though dont know interpret new value could solved adding unknown fallback value server add well except record shared different user thus different app version newer app version understands new enum value could create record new value upload older app version know new value overwrite unknown value overwrite actual value server well syncs app older version could degraded fallback experience enum value understand soon update app able interpret new value synced afresh maintain forwardcompatibility enum value roll infrastructure accommodate sealed class represent enumerated value could save value database value newer version app send enum value back server sync even though current version app cannot interpret value runtime order achieve require class sealed class hierarchy represent enumerated value also includes unknownval actualvalue string data class capture handle newly introduced value implementation safeenumtypeadapter class roomtypeconverter safely store retrieve newly added enum value moshitypeadapter serialize deserialize newly added enum value interesting part safeenumtypadapter class definition kotlin open class safeenumtypeadaptert val knownmappings mapt string private val unknownenumtostringconverter string private val unknownstringtoenumconverter string knownmappings field take map convert enumeration current version application understands unknownenumtostringconverter convert unknown enum value actual string representation usually pushing data server unknownstringtoenumconverter wrap newly introduced value unknown sealed data class defined earlier consequence enumerated value conform forward compatibility spec represented fashion enums served apis saved database convention way developer gain awareness read adr tribal knowledge ideally lint check throw error enum class involved retrofit room interface reference kotlin sealed class appointmenttype object manual appointmenttype subclass represents enumerated value object automatic appointmenttype data class unknownval actual string appointmenttype defined deal forwardcompatibility object typeadapter safeenumtypeadapter knownmappings mapof know mapping notice snakecase lowercase underscore manual manual automatic automatic unknownstringtoenumconverter unknownit convert unknown enum value forwardcompatibility unknownenumtostringconverter unknownactual sync send actual value back server class roomtypeconverter room type converter typeconverter fun toenumvalue string typeadaptertoenumvalue typeconverter fun fromenumenum appointmenttype typeadapterfromenumenum class moshitypeadapter moshi type adapter fromjson fun toenumvalue string typeadaptertoenumvalue tojson fun fromenumenum appointmenttype typeadapterfromenumenum companion object visiblefortesting fun random appointmenttypetypeadapterknownmappingskeysshuffledfirst roomtypeconverter registered appdatabase class moshitypeadapter registered networkmodule