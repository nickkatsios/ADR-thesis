adr transport agnostic peer abstraction changelog drafted revised opportunity design implement peertopeer stack scratch tendermint implementation rust lot learning shortcoming original implementation prevent certain mistake namely two leakage physical concern core domain flexibility adopt different wire protocol transport message first set newly introduced concept attempt generic transport connect converse peer given strongly tailored abstract interface concrete implementation easy spin plug machinery lift byte wire core domain transport message rest system transport wrapping design transport modelled property physical network endpoint mind bound stopped strongly correspond acquisition lifecycle management network resource system rust pub trait transport type connection connection type endpoint endpointconnection type incoming streamconnection send sync async bindself bindinfo bindinfo resultselfendpoint selfincoming successful bind caller hold endpoint well stream incoming connection standardised way connect new peer react newly connected one respectively rust pub trait endpoint send sync type connection async connectself info connectinfo resultselfconnection listenaddrsself vecsocketaddr centerpiece whole shebang connection represents connected peer provides primitive get data send data peer designed outlook support stream based transport road open enable feature parity current production installation based tendermintgos mconn rust pub trait streamsend send sync async send result pub trait connection send sync type error stderrorerror send sync static type streamread stream send type streamsend streamsend advertisedaddrsself vecsocketaddr async closeself result localaddrself socketaddr async openbidirectional self streamid streamid resultselfstreamread selfstreamsend selferror publickeyself publickey remoteaddrself socketaddr peer given correct implementation transport connection newly established one wrapped peer charge setting correct stream connection multiplex message incoming outgoing alike efficiently also attempt enforce correctbyconstruction constraint state machine peer avoid misuse unexpected transition way construct existing connection give caller connected peer invoking run one fully function peer returned therefore state look like connected running stopped rust impl peer conn connection pub async runself streamids vec result async stopself resultpeerstopped impl peer conn connection pub async sendself message messagesend result pub async stopself resultpeerstopped sending message done method running peer getting hold incoming message achieved draining receiver part running state supervisor supervisor main entry point package giving higherlevel component access unified stream peer event message well ability control peer lifecycle connect disconnect etc rust pub enum command accept connectsocketaddr disconnectnodeid msgnodeid messagesend pub enum event connectednodeid direction disconnectednodeid report messagenodeid messagereceive upgradednodeid upgradefailednodeid report struct commandhandle impl commandhandle instructcommand command result impl supervisor pub newtransport self transporttransport send static pub handleself commandhandle pub subscribeself receiverevent pub async runtself result consequence positive unified way bootstrap integrate transport potential connecting different wire transport process rest domain simply concerned nodeids identity negative significant set abstraction satisfied new transport implementation nonstream based transport fitted model neutral open question reference rfc add stream proposal refactor support multiple transport