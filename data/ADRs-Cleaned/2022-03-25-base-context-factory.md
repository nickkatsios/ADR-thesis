title base factory area core tag core saleschannel performance cache within store api request storefront sale channel must built building sale channel resource consuming task database since many dal object included sale channel therefore cache corresponding service shopwarecoresystemsaleschannelcontextsaleschannelcontextfactory already implemented past shopwarecoresystemsaleschannelcontextcachedsaleschannelcontextfactory however since also contains customer selected shipping address well billing address cannot cached customer logged php namespace shopwarecoresystemsaleschannelcontext class cachedsaleschannelcontextfactory extends abstractsaleschannelcontextfactory public function createstring token string saleschannelid array saleschannelcontext thisiscacheableoptions return thisgetdecoratedcreatetoken saleschannelid private function iscacheablearray bool return issetoptionssaleschannelcontextservicecustomerid issetoptionssaleschannelcontextservicebillingaddressid issetoptionssaleschannelcontextserviceshippingaddressid however since also data independent customer data possible cache resourcecosting data across customer even customer logged selected different payment method shipping method address implemented shopwarecoresystemsaleschannelcontextbasecontextfactory responsible creating shopwarecoresystemsaleschannelbasecontext data belongs sale channel independent customer account loaded basecontext php namespace shopwarecoresystemsaleschannel class basecontext protected customergroupentity currentcustomergroup protected customergroupentity fallbackcustomergroup protected currencyentity currency protected saleschannelentity saleschannel protected taxcollection taxrules protected paymentmethodentity paymentmethod protected shippingmethodentity shippingmethod protected shippinglocation shippinglocation protected private cashroundingconfig itemrounding private cashroundingconfig totalrounding basecontextfactory well basecontext marked internal intended extension intervention loading basecontext quickly lead cache miss therefore supported addition corresponding saleschannelid current session parameter passed service contains list changed parameter basecontextfactory take account following parameter also effect corresponding cache permutation service shippingmethodid contains selected shipping method paymentmethodid contains selected payment method countryid contains selected shipping country countrystateid contains selected shipping state currencyid contains selected currency languageid contains selected language addition shopwarecoresystemsaleschannelcontextbasecontextfactory shopwarecoresystemsaleschannelcontextcachedsaleschannelcontextfactory implemented responsible caching base assembles cache key based parameter listed load base cache already loaded php namespace shopwarecoresystemsaleschannelcontext class cachedbasecontextfactory extends abstractbasecontextfactory public function createstring saleschannelid array basecontext ksortoptions key arrayintersectkeyoptions saleschannelcontextservicecurrencyid true saleschannelcontextservicelanguageid true saleschannelcontextservicedomainid true saleschannelcontextservicepaymentmethodid true saleschannelcontextserviceshippingmethodid true saleschannelcontextserviceversionid true saleschannelcontextservicecountryid true saleschannelcontextservicecountrystateid true key implode name mdjsonencodekeys jsonthrowonerror caching sale channel handled two level cachedsaleschannelcontextfactory responsible global caching provides fast hit rate load time customer logged cachedbasecontextfactory responsible caching generic object relate customer account customer created another payment shipping method shared loggedin user