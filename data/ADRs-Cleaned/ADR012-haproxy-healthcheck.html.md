title adr haproxy healthcheck adr haproxy healthcheck story investigating avoid downtime deployed application made change platform discovered short outage occurred gorouter taken service gorouter drain functionality allow upstream load balancer gracefully take instance gorouter service request start fail usr signal sent instruct gorouter start draining healthchecking request identified header useragent httpmonitor start failing http user request allowed continue two thing prevented drain mode elb configured tcp healthchecks http elb sends http healthcheck request useragent elbhealthchecker mean recognised healthcheck request gorouter returned http elb take draining gorouter service result small amount downtime deployed apps received request short window second decided submit change upstream allow gorouter recognise elb healthchecks implement healhchecking port haproxy introduced adr appends useragent httpmonitor gorouter expects enable http healthchecks elb consequence downtime deployed application deploy additional reason keep intermediate haproxy introduced temporary measure