cassandra mailbox counter inconsistency lazy consensus implemented cassandra maintains per mailbox projection message count unseen message count projection sync leading inconsistent result returned client acceptable table organisation mailbox list mailbox messageidtable hold mailbox flag message lookup mailbox uid imapuidtable hold mailbox flag message lookup message serf source truth mailboxcounters hold message count unseen message count mailbox failure denormalization process lead inconsistency count content imapuidtable lead following user experience invalid message count reported mail user agent imap jmap invalid message unseen count reported mail user agent imap jmap implement webadmin exposed task recompute mailbox counter endpoint list existing mailbox list message messageidtable check source truth imapuidtable compute mailbox counter value reset value counter needed mailboxcounters consequence endpoint subject data race face concurrent operation concurrent increment decrement ignored single mailbox processing however source truth unaffected hence upon rerunning task result eventually correct noted cassandra counter cant reset atomic manner anyway rely listing message mailbox projection recheck missing entry ignored given projection healed currently unsupported furthermore piggy back partial check message denormalization described adr upon counter recomputation partial cannot detect missing entry list message mailbox denormalization table reference plan fixing cassandra acl inconsistency general mailing list discussion inconsistency james related jira pull request james corrective task fixing mailbox counter