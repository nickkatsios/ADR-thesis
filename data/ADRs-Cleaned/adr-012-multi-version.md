adr support multiple version cometbft core changelog first draft new release cometbft come tendermintrs viable way support version protocol cosmos community hermes present particular challenge needing support multiple different version protocol within single software agent performs ibc relaying across chain necessarily cometbft version previously feasible tendermintrs support single version cometbft protocol expect chain relayer operator upgrade software sync number established chain cometbft production new chain future version protocol expected deployed shared cosmos ecosystem relaying possible old new chain approach protocol evolution versioning cometbft rigorous result release number breaking change rpc protocol format though change seem beneficial long term adhoc way discover version node select appropriate encoding appears late development process introduce significant change mitigate release timeframe requirement specify protocol version chain configuration would complicate deployment experience chain relayer operator avoided another motivation multiversion support versioning tendermintrs previously semver compatibility tendermintrs release tied corresponding cometbft version sequence none obvious way desirable decouple tendermintrs versioning cometbft making solely matter rust crate api evolution long term single version tendermintrs library able support version cometbft protocol relevant community developer cometbft protocol take versioning practice future revision support backward compatibility source code level tendermintrs library api modified provide support multiple version cometbft apis moment tendermintproto generated rust file providing binding tendermint protobuf definition emitted two sidebyside module tendermintv tendermintv name latter module also reexported tendermint module providing lowchange migration path code base previous version crate default import path application target latest version tendermint domain type largely unchanged except additional field needed support version new type added required new version conversion protobuf type defined tendermintproto provided tendermintv tendermintv generated type except type new tendermintrpc compatibility mode parameter introduced http websocket client following type rust pub enum compatmode version protocol version protocol mode parameter dynamically select encoding client default client latest protocol designated associated const function compatmodelatest possible specify compatibility mode construction newly introduced configuration api http client also possible switch mode client already connected useful dynamic version discovery endpoint client trait extended support method new cometbft emulated older protocol endpoint compatibility mode selected deprecate method data type public client api domain type tendermint difference encoding confined crate internals protocol version discovery implemented library way would invisible api user discover tendermint version client make request process version data response format response divergent supported protocol version succeed regardless compatibility mode initially selected rpc client api represents individual endpoint request would wrong implementation perform hidden rpc roundtrip discover version needed client exhibit interior mutability otherwise needed future formalized way discover protocol version provided adhoc approach expected eventually deprecated example connecting websocket endpoint specified compatibility mode rust tendermintrpcclientcompatmode websocketclient let client websocketclientbuilderrpcurl compatmodecompatmodev build await discovery rpc compatibility mode preserving http connection rust tendermintrpcclientclient compatmode httpclient httpclienturl tendermintrpcerrorerror async rpcclientwithversiondiscoveryurl result tryinto let mut rpcclient httpclientnewurl let rpcclientstatusawait let compatmode compatmodefromversionstatusnodeinfoversion rpcclientsetcompatmodecompatmode okrpcclient tendermintabci crate actively supported make minimal effort update version abci backward compatibility multiversion support implemented consumer steered towards towerabci proposed consequence positive rpc interoperability node possible single built executable single runtime process without much extra coding effort consumer tendermintrs crate get support version protobuf message able either negative consumer tendermintrpc wishing remain interoperable node configure compatibility mode add version discovery migrating release crate introduces change conversion protobuf message type tendermintproto domain type tendermint longer unambiguously resolved type inference type sometimes explicitly annotated existing consumer tendermintabci wish remain effectively stranded previous semver break release crate writing reference implementation