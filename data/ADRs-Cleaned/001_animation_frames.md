run animation frame step elm runtime requestanimationframe keep view updated order run faster spec elmspec simonfaketimers fake requestanimationframe function along timer provides elmspec control run function thus update view however thing little complicated might seem turn elm runtime also requestanimationframe command involve dom particular like browserdomgetelement browserdom module mean sometimes step might actually multiple animation frame complete update view expected get complicated program browsereventsonanimationframe subscription sends update message animation frame previously elmspec would run next animation frame step observer touched dom view updated step attempt continue run animation frame task none remained end step little weird try run newly added task spec would infinite loop since task update view task listens animation frame add new request next animation frame run one major problem approach sometimes program might run next animation frame even step doesnt touch dom example browserdomgetelement called port message received spec want see size element retrieved sent another port something step observer involves port animation frame run command complete also exists spectimenextanimationframe manually running next animation frame however case described something would happen even wouldnt trigger expected behavior case would actually continue run animation frame added process execiting command probably called runanimationframesuntilcomplete something elmspec run animation frame try end spec step matter including step run initial command run one animation frame extra animation frame task detected one remaining animation frame task view animator scenario rejected message explaining one step trigger extra animation frame order prevent scenario rejected one add spectimeallowextraanimationframes setup section scenario point really let people know something funny could going one spectimenextanimationframe run single animation frame one trigger behavior one want seems work much better first many common scenario work expected example one trigger browserdomgetelement command based step simulates receiving port message work expected since animation frame run end step update view also run getelement command second case complicated scenario involving dom command trigger dom command browsereventsonanimationframe spec writer alerted fact thing complicated full control many animation frame execute consequence standard scenario one involve extra animation frame task seem affected change one downside certain case implementation detail elm runtime leak scenario script especially involving dom command might extra animation frame run however case probably rare update problem showed scenario final step needed wait one animation frame example step sends command get element update view based running one animation frame would kick command view would never updated message would sent continue next step case last step would start observation animation frame would never run plus would warning spec writer since one animation task remaining running frame fix problem check count animation frame task running frame delta greater know task occurred confident update function called resulting another program command ultimately result another animation frame delta greater zero nothing delta zero send message continue next step one caveat turn certain case elm runtime actually add animator task next animation frame appears happen certain input event occur like htmleventsoninput case number task actually zero run frame step case explicitly send message next step interestingly scenario cause input event trigger task wait animation frame thing work fine since task seems add animator back task anyway say thing get complicated animation frame hope weve covered case may still discover problem