limit visit migrated place history firefox deciders teshaq mhammond lougeniac dnarcese problem statement applicationservices team removed legacy implementation history firefoxios replaced maintained implementation powering firefox android significant part project migrating user history old database new one measure risk ran dryrun migration dryrun migration run background thread user application attempt migrate fake database dryrun implemented purely collect telemetry migration evaluate risk result found following looker dashboard list observation observation dryrun experiment following list observation experiment migration end mean user application terminated migration ended real migration would mean user lose history unless attempt migration multiple time migration failed mentioned user history visit migration end migration successful mean experiencing many error migration beyond time take average visit migrated around visit median visit migrated around visit difference average median suggests many user large number visit migration end following percentile long took millisecond would like emphasize following includes migration end percentile percentile percentile percentile second percentile second percentile second percentile second percentile second problem statement given observation dryrun experiment rest document examines approach answer question increase rate migration end simultaneously keep user database size reasonable size user implication keeping rate ended migration high user keep history interact normally url bar search history searching history history panel navigating site visited past user implication keeping reasonable database size database likely lock long query meaning reduce performance issue user search bar history panel navigating site finally important note power user daily active user likely large history thus power user likely fail migration power user likely performance issue history search bar saw version favicons earlier incident user coming across significant number database lock crashing app isnt say incident directly related however large history could contribute state saw incident would take longer run query driver must lose user recent history considered recent concretely defined prior art however firefox sync android syncs visit firefox desktop android impose limit size database mib android importing history chrome firefox migrate latest visit chrome keep user history day user experience history must regress ideally improve user experience tightly coupled size database larger database longer query take longer query take longer would take user observe searched history history panel considered keep migration asis mean limit attempt migrate history user introduce datebased limit visit migration mean migrate visit occurred past daysweeksmonths etc introduce visit numberbased limit migration mean migrate latest visit outcome chosen introduce visit numberbased limit migration chosen given driver must lose user recent history established result dryrun majority failed migration user large number visit setting reasonable limit increase likelihood migration succeeds set limit encompass recent history choosing limit success rate user experience history must regress ideally improve established driver user experience history coupled database size setting reasonable limit keep size history database controlled also worth noting switch new implementation history also introducing target size database mean maintenance logic would compact database prune grows beyond target size positive consequence migration run shorter time mean higher chance migration succeeding thus keeping user recent history without loss user selected limit still get history suggested limit section keep size history database low way user limit keep recent history additionally delete user history old database size data app keep decrease dramatically keeping database size low mean lower chance user performance issue database negative consequence biggest negative consequence user visit limit lose visit since would keep latest visit user user visit would lose visit assuming greater effect mitigated observation recent history important user older history unfortunately telemetry demonstrate claim assumption based existing limit history imposed android desktop mentioned driver section pro con keep migration asis good migration succeeds user keep history bad likely migration succeed bad even migration succeeds cause size database large user lot history large database cause regression performance user lot history two large database old new one since wont delete data old database right away support downgrade bad take long time migration finish bad migration user experience app without history introduce datebased limit visit good match user usage app user app keep history good likely migration end set limit bad hard predict large user database particularly important sync user firefoxios syncs history meaning user many visit limit across multiple platform large number visit migrated bad user havent app since limit lose history example limit month user last app month ago suddenly lose history suggested limit section describes suggested limit visit although backed telemetry specific number discussion also important note statistical significance part analysis migration run user although may statistically significant representation population good enough input make educated suggestion first start observing distribution visit count tell many user visit etc identify user visit observe dryrun migration ended rate based bucket observe user visit high chance migration success finally based analysis prior art well suggest visit user history distribution look httpsmozillacloudlookercomlooks demonstrates distribution user based number history visit note chart based release population observation firefoxios user visit long tail distribution user visit dryrun ending rate visit look httpsmozillacloudlookercomlooks chart demonstrates rate migration end number visit bucket user bucket visit observation observe user visit success rate observe user visit success rate drop user success rate example user visit success rate success rate bucket beyond visit drop suggestion based suggesting limit visit visit encompass full history user migration visit success rate user visit still keep latest visit choice reasonable considering sync retrieves latest visit android migrating chrome firefox migrates visit desktop link epic moving history implementation applicationservices place dryrun migration experiment overall dryrun migration looker dashboard firefox user distribution history migration ended rate user history firefox sync android syncs site firefox desktop limit import chrome visit firefox android limit size placesdb mib chrome keep day history performance incident firefox