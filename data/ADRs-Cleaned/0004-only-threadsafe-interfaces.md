remove support nonsendsync interface deciders mhammond rfkelly travis jhugman dmose discussion approval technical story issue problem statement adr introduced support threadsafe interface possibly leading impression thing nonthreadsafe interface confusion exactly attribute mean however entire concept nonthreadsafe interface misconception rust compiler insists everything wrapped uniffi threadsafe question manages threadsafety interface marked threadsafe cause uniffi wrap interface mutex hidden generated code therefore obvious casual reader threadsafe marker act way component author opt overhead blocking behaviour mutex cost opting managing locking internally adr proposes uniffi force component author explicitly manage locking case put rust term structs supported uniffi must already sendsync note adr henceforth term sendsync instead threadsafe accurately describes actual intent avoids misunderstanding might caused somewhat broad generic threadsafe driver supporting nonsendsync structs mean uniffi must add hidden locking make sendsync consider footgun may lead accidentally method call unexpectedly block long period fenix bug detail available jira ticket supporting structs hinder uniffi growing direction weve found desired practice allowing structs method receiver pas interface reference ffi considered continue supporting nonsendsync interface also working enhancement listed exclude nonsendsync interface enhancement immediately deprecate remove entirely support nonsendsync interface outcome chosen immediately deprecate remove entirely support nonsendsync interface taken real world experience tell nonsendsync interface useful toy example application nimbus autofill project didnt get far needing capability extra ongoing work supporting interface cannot justified positive consequence locking uniffi supported component easily discoverable handwritten rust code hidden inside generated code benefit developer uniffi supported component rather consumer considering feature help communicate lock semantics consumer beyond scope adr open door enhancement would impossible nonsendsync interface simpler implement sendsync interface support nonsendsync interface exist simpler implementation documentation negative consequence consumer inside mozilla external change interface sendsync example entail see commit convert todolist example simple toy application may difficult wrap consumer able defer sendsync support instead implement simple locking demonstrated commit existing application yet consider make implementation sendsync cannot wrapped example arent currently marked threadsafe attribute become complex implement explain achieve sendsync perception difficult wrap interface lead adoption tool pro con good dont break anyone bad believe nonsendsync interface arent useful realworld would pay maintenance cost though bad locking remains hidden leaf door open gun already shot foot good make implementation desired feature easier good remove footgun make locking explicit visible developer uniffiwrapped component bad break existing external consumer also break couple internal consumer example fxaclient believe fixing easy low cost implication know external consumer know break therefore commit following action communicating consumer work around soon possible noisily deprecate nonsendsync interface least release existing consumer likely see warning link documentation upgrade upgrade internal mozilla consumer soon possible issue deprecation warning example entail see convert todolist example sendsync perform actual removal late possible support non sendsync interface actually inhibits ability add new feature concretely actual removal involves making threadsafe default attribute immediately removed would break existing sendsync component although mark deprecated remove aggressive timeline attribute may confusing given sendsync would default remove support generating sendsync support generated rust cause rust object dont support send sync fail compile link logical extension adr