compiling loading elmspec harness right order run elmspec program thing definite order point compile elm code compiler elmspeccore wrap compiled code part program interact outside world easily faked get program running first create elmcontext object creates fake object window object compiled elm code attempt reference second evaluate compiled elm code doesnt matter compile elm code course evaluated browser environment created new elmcontext environment little wild guess simply instantiating elmcontext modifies window object part come fact compiled elm code wrapped iffe there reason actually weve able deal problem far thing process elmspecrunner karmaelmspecframework harness asking test writer follow process well reason simplify source error change flow dont create elmcontext evaluate compiled elm code particular order first wrap compiled elm code function take elmcontext evaluating code still attach elm object window since providing proxy object normal function control elm object loaded elmcontext store reference fake inside there real store window object thing store window function load elm compiled elm code provides function dont think reference way data compiler actually tried like file tried compile path store window available soon compiled code evaluated may better way function loading file function accessible window anyway since thats playwright jsdom allow register function executed node turn test writer doesnt create elmcontext harnesscontroller prepareharness called fact dont even bundle anything extra included bundle test get executed browser could also change suiterunner create elmcontext well necessary