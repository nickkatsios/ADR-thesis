retry endpoint design round motivation endpoint current requirement batchbulk able retry job either errored terminated allows retry either single job multiple job save cancel resubmit job individually currently implemented anyway motivation code spike retry endpoint follow design adr mentioned product owner find ability deliver functionality pretty awful invested much effort refactoring killed timeline started late july almost may functioning bulk uploader first deliverable going refactor able timely fashion kill schedule want see estimate quick dirty solution implement proposed retry endpoint deployed asap api contract established functional mvp done begin cleanup backend code note business usual usual way nasty mvp get deployed dont back much later get api working doesnt block dependency immediately start refactoring refactor broken smallish chunk day estimated work merge maintain functionality incrementally improve codebase task take couple day likely far estimate mitigate risk poor estimation high level behavior retry endpoint current implementation retry run job retryjob retryjobs endpoint endpoint take job list job attempt resubmit queue exact set parameter version app current behavior spec file located httpsgithubcomkbaseexecutionengineblobbaabeacfbbefdaabeedexecutionenginespecll job provided sufficient permission call proceed error unless asadmin flag provided admin retry continue job retried statusterminatedvalue statuserrorvalue job point job already retried attempt retry job retryparent instead job never retried becomes retryparent look method version parameter submits job retried incrementing retrycount job retried newly launched job gain field called retryparent contains job job original request job submitted upon successful submission child job add field retryparent notifies parentjobid new childjob added appending parentjobchildjobs field way specify resourcerequirements retry moment even job previously submitted administrator specfified resourcerequirements retry resource requirement catalog config batch behavior job attribute batchjobtrue retry fail since method rerun bug doesnt fail gracefully gracefully handling job child mean wont throw error method rerun instead throw error say cannot retry batch job parent must retry individual job job attribute batchjobtrue actually child job parent notified new retried job multiple inflight retries allowed add childjobid parentjobidchildjobids retryjob behavior blocking single submit htcondor fine return relatively quickly retryjobs behavior submitting multiple job retry serially call code path running single job block job submitted condor queue cause issue network drop make narrative aware state retry submitting job currently take second lot time thing wrong follow hopefully making narrative aware state retry mitigated narrative backend block call anyway default service timeout think something wacky like half hour long user doesnt kill kernel time well course looked frozen couple minute probably restart multiple inflight retries allowed desired behavior general prevent multiple inflight retries prevent user wasting resource queue resource non blocking job submission submitting multiple job possibly via runjobbatch requires refactor runjobbatch one single submission htcondor instead multiple job submission ability gracefully handle batch container job child throw proper error see batch behavior ability handle database consistency retry failure see make preflight job start check fail job submission handle differently appear job submission data inconsistency new retryids field show list job retried parent retrycount returned calculated field based retryids retrytoggle field allow seperate process check possibly correct job didnt finish entire retry lifecycle launch child job notify batch parent child notify retry parent child update retrytoggle field wont add retrynumber field new priority mvp create retryjobs field expose list api completeness toggle add failure condition run method fail creating record mvp non blocking job submission possibly htcondor submit add threadreaper perform action based toggle question answered number retries job limited maxretries field parent job wait see whether people attempt rerun job already failed nine zillion time make ticket add backlog prevent job identical parameter rerun within retryjobs request decided allow multiple job params rerun retryjobs request find recent retry job client api would figure retryparent job creation field unless added field help ensure app version correctly run time submitting narrative would change narrative submit git commit hash instead version tag handle consistency retry failure look like implement integrity check twophase commits making relationship job retryparent batch container accept info may incomplete write workarounds client upgrade mongo better transaction support decided retrytoggle order mark entire transaction occurred retry job set monitor fix job didnt finish retry lifecycle want support resourcerequirements probably short term prevent incorrect parentchild relationship created client allowed specify parent currently possible add new child parent job child new job rather existing job set params rerun necessarily relevant endpoint runjobbatch endpoint question currently retryparent parentjobid looked record retry specified endpoint shorter track retry count done user see retry count visible api tbd retried job saved sort data structure linking possibly indirectly parent job orphaned yes retryparent former retry relationship linear tree happens two simultaneous call retry job tree simultaneous job run least theoretically possible see list retried job order possible sorting creation maximum retry count warning retries likely help unknown tbd job state failed canceled retried user required cancel job retried job must errorcancel state work estimation mvp priority descending address data inconsistency via retrycount retryids retrytoggle estimate day httpskbasejiraatlassiannetbrowsedataup preflight check estimate day httpskbasejiraatlassiannetbrowsedataup requires retry able force app gitcommit version jobrequirements record httpskbasejiraatlassiannetbrowsedataup create created job queued job reaper cancel created job older hour cancel queued job day old estimate day httpskbasejiraatlassiannetbrowsedataup work estimation post mvp hookup retries refactored code non blocking job submission submitting multiple job possibly via runjobmultiple requires refactor retry gracefully handle job child notifying batch container retry batch retry job batch batch want correct batch parent notified switching starting retried job one time starting batch mode require refactoring batch retry parent updated estimate day httpskbasejiraatlassiannetbrowsedataup mvp one single submission htcondor instead multiple job submission estimate day httpskbasejiraatlassiannetbrowsedataup mvp prevent multiple inflight retries prevent user wasting resource queue resource estimate day httpskbasejiraatlassiannetbrowsedataup