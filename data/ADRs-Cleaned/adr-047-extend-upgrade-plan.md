adr extend upgrade plan changelog nov initial draft may proposal abandoned prerun postrun necessary anymore adding artifact brings minor benefit abandoned abstract adr expands existing xupgrade plan proto message include new field defining prerun postrun process within upgrade tooling also defines structure providing downloadable artifact involved upgrade upgrade module conjunction cosmovisor designed facilitate automate blockchains transition one version another user submit software upgrade governance proposal containing upgrade plan plan currently contains following field name short string identifying new version height chain height upgrade performed info string containing information upgrade info string anything however cosmovisor try info field automatically download new version blockchain executable autodownload work cosmovisor expects either stringified json object specific structure defined documentation url return json json object identifies url download new blockchain executable different platform architecture linuxamd url either return executable file directly return archive containing executable possibly asset url return archive decompressed daemonhomecosmovisorupgrade name daemonhomecosmovisorupgrade namebindaemonname exist daemonhomecosmovisorupgrade namedaemonname latter copied former url return something archive downloaded daemonhomecosmovisorupgrade namebindaemonname upgrade height reached new version executable version isnt available cosmovisor stop running daemonhome daemonname environment variable configure cosmovisor currently mechanism make cosmovisor run command upgraded chain restarted current upgrade process timeline upgrade governance proposal submitted approved upgrade height reached xupgrade module writes upgradeinfojson file chain halt cosmovisor back data directory set cosmovisor downloads new executable already place cosmovisor executes daemonname preupgrade cosmovisor restarts app new version args originally provided protobuf update update xupgradeplan message providing upgrade instruction upgrade instruction contain list artifact available platform allows definition prerun postrun command command consensus guaranteed executed cosmosvisor upgrade handling protobuf message plan existing field upgradeinstructions instruction new upgradeinstructions instruction field must optional protobuf message upgradeinstructions string prerun string postrun repeated artifact artifact string description field upgradeinstructions optional prerun command run prior upgraded chain restarting defined executed halting downloading new artifact restarting upgraded chain working directory command run must daemonhomecosmovisorupgrade name command must behave current preupgrade command take commandline argument expected terminate following exit code exit code handled cosmosvisor assumes preupgrade command executed successfully continues upgrade default exit code preupgrade command implemented preupgrade command executed failed fails entire upgrade preupgrade command executed failed command retried exit code returned defined app supervisor cosmovisor must run app prerun postrun command run upgraded chain started defined command must executed upgrading node output exit code logged affect running upgraded chain working directory command run must daemonhomecosmovisorupgrade name artifact define item downloaded one entry per platform description contains humanreadable information upgrade might contain reference external resource structured processing information protobuf message artifact string platform string url string checksum string checksumalgo platform required string format oscpu linuxamd string also allowed artifact platform fallback specific oscpu entry found artifact exists platform match system cpu otherwise artifact exists platform otherwise artifact downloaded url required url string must conform rfc uniform resource locator request url must return either executable file archive containing either bindaemonname daemonname url contain checksum specified checksum attribute checksum checksum expected result request url required recommended provided must hex encoded checksum string tool utilizing upgradeinstructions must fail checksum provided different checksum result returned url checksumalgo string identify algorithm generate checksum recommended algorithm sha sha algorithm also supported recommended sha checksum provided checksumalgo must also provided url required contain checksum query parameter url contain checksum query parameter checksum checksumalgo field must also populated value must match value query parameter example url httpsexamplecomchecksummdddcdfbeecfe checksum field must ddcdfbeecfe checksumalgo field must upgrade module update upgrade plan new upgradeinstructions field existing functionality maintained parsing info field either url binary json deprecated validation info field warning issued error update creation upgradeinfojson file include upgradeinstructions update optional validation available via cli account new plan structure add following validation upgradeinstructions provided must least one entry artifact artifact must unique platform artifact url contains checksum query parameter checksum query parameter value must format checksumalgochecksum checksum query parameter must equal checksum provided artifact checksumalgo query parameter must equal checksumalgo provided artifact following validation currently done info field apply similar validation upgradeinstructions artifact platform must format oscpu url field must empty url field must proper url checksum must provided either checksum field query parameter url checksum field value url also checksum query parameter two value must equal url must return either file archive containing either bindaemonname daemonname checksum provided field query param checksum result url must equal provided checksum downloading artifact happen way url info currently downloaded cosmovisor update upgradeinfojson file contain upgradeinstructions existing functionality maintained update cosmovisor look handle new upgradeinstructions upgradeinfojson upgradeinstructions provided following info field ignored artifact field identify artifact download based platform cosmovisor running checksum provided either field query param url downloaded artifact different checksum upgrade process interrupted cosmovisor exit error prerun command defined executed point process app preupgrade command would executed executed environment command run cosmovisor postrun command defined executed executing command restarts chain executed background process environment command output generated command logged complete exit code logged deprecate info field anything human readable information warning logged info field define asset either url json new upgrade timeline similar current one change bold upgrade governance proposal submitted approved upgrade height reached xupgrade module writes upgradeinfojson file possibly upgradeinstructions chain halt cosmovisor back data directory set cosmovisor downloads new executable already place cosmovisor executes prerun command provided else daemonname preupgrade command cosmovisor restarts app new version args originally provided cosmovisor immediately run postrun command detached process consequence backwards compatibility since change existing definition addition instruction field plan message field optional backwards incompatibility respect proto message additionally current behavior maintained upgradeinstructions provided backwards incompatibility respect either upgrade module cosmovisor forward compatibility order utilize upgradeinstructions part software upgrade following must true chain must already sufficiently advanced version cosmos sdk chain node must sufficiently advanced version cosmovisor positive structure defining artifact clearer since defined proto instead documentation availability prerun command becomes obvious postrun command becomes possible negative plan message becomes larger negligible xupgrades module store one upgrade plan upgrade rare enough increased gas cost isnt concern providing url return upgradeinstructions way provide multiple asset executables file platform archive platform artifact neutral existing functionality info field maintained upgradeinstructions arent provided discussion draft comment consider different name upgradeinstructions instruction either message type field name draft comment consider putting string platform field inside upgradeinstructions make upgradeinstructions repeated field plan consider oneof field plan could either upgradeinstructions else url return upgradeinstructions consider allowing info either json serialized version upgradeinstructions else url return draft comment consider including upgradeinstructionsdescription field info field purpose instead draft comment consider allowing multiple artifact downloaded given platform adding name field artifact message comment allow new upgradeinstructions provided via url comment allow definition signer asset checksum reference current upgradeproto upgrade module readme cosmovisor readme preupgrade readme draftpoc rfc uniform resource locator