deduplicated blob garbage collection bloom filter lazy consensus implemented proposes simple way implement alternative distributed blob garbage collector change edited mention cuckoo filter alternative body header attachment mail stored blob blob store order save space store blob deduplicated hash content attain current blob store read content blob saving generate based hash content way two blob content share thus saved make safe deletion one blob nontrivial problem cant delete one blob without ensuring reference deleted example two message share blob delete one message time way tell blob still referenced another message solve propose simple two step algorithm provide background deduplication job first step consists building bloom filter entity referencing blob second step iterate blob check bloom filter predict referenced bloom filter probabilistic data structure reference prediction produce false positive might skip non referenced blob garbage collected however associated probability tuned adding salt ensure subsequent run different set false positive thus blob eventually garbage collected avoid concurrency issue could garbage collect blob time new reference appear reference generation notion added deduplicating blob constructed hash content include reference generation avoid synchronization issue generation time based blob belonging reference generation eligible garbage collection avoid concurrency issue allow clock skew finally wish offer opportunity configure reconfigure generation duration order introduce generation family part blobid incremented administrator configuration change generation duration allows avoiding conflict generation getting number change blobids different family considered belonging distinct generation ready garbage collected allows arbitrary change generation duration consequence able list blobids blob within blobstore operation supported blobstore prevent deduplication issue introduce new api blobreferencesource listing blobids currently referenced entity implement entity attachment message mail queue mail repository garbage collection heavyweight task whose complexity proportional dataset size regarding garbage collection generation duration tradeoff longer longer take effectively delete blob however longer efficient deduplication deduplication course scoped single generation generation duration impact overall process speed please note design require additional responsibility blobstore user thus fully transparent alternative iterative approach distributed blob garbage collector proposes alternative could implemented future attempt reduce duration iteration however present following flaw generation switch synchronous keep track deletion keep track reference overall consistency face cassandra failure store studied carefully track reference implies algorithm transparent blob store user requires either blobstore api modification user actively track reference likely transparent blob store user also proof concept yield full data generation memory thus could impact scalability believe simpler approach could implemented timely yield benefit alternative implemented later limit bloom filter approach better known two algorithm mutually exclusive could well coexist codebase alternative bloom filter cuckoo filter probability data structure tends better space efficiency low falsepositive rate might proposed alternative bloom filter implementation bloom filter approach apache spark way solving potential scaling issue would run bloom filter algorithm spark cluster apache spark would take care scheduling job distributed fashion allowing scale count worker node requiring minimal applicative knowledge would good candidate tooling reference jira adr thread serverdev mailing list