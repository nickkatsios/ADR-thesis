adr add support wasm based light client changelog initial draft update client refactor reimplementation strangelove update upstreaming module ibcgo applied wasm abstract cosmos sdk light client currently hardcoded make upgrading existing ibc light client adding support new light client multi step process involving onchain governance timeconsuming remedy proposing wasm host light client bytecode allows easier upgrading existing ibc light client well adding support new ibc light client without requiring code release corresponding hardfork event currently ibcgo light client defined part codebase implemented module moduleslightclients adding support new light client updating existing light client event security issue consensus update multistep process timeconsuming errorprone order enable new ibc light client implementation necessary modify codebase ibcgo light client part codebase rebuild chain binary pas governance proposal validators upgrade node another problem stemming process chain want upgrade consensus convince every chain hub connected upgrade light client order stay connected due time consuming process required upgrade light client chain lot connection disconnected quite time upgrading consensus expensive term time effort proposing simplifying workflow integrating wasm light client module make adding support new light client simple governancegated transaction light client bytecode written wasmcompilable rust run inside wasm wasm light client submodule expose proxy light client interface route incoming message appropriate handler function inside wasm execution wasm light client module anybody add new ibc light client form wasm bytecode provided able submit governance proposal transaction pass well instantiate client created client type allows chain update light client chain without going step outlined decided implement wasm light client module light client proxy interface actual light client uploaded wasm bytecode enable usage wasm light client module user add list allowed client updating allowedclients parameter client submodule core ibc params clientkeepergetparamsctx paramsallowedclients appendparamsallowedclients exportedwasm clientkeepersetparamsctx params adding new light client contract governancegated upload new light client user submit governance proposal contains sdkmsg storing wasm contract bytecode required message msgstorecode bytecode provided field wasmbytecode proto msgstorecode defines request type storecode rpc message msgstorecode signer address string signer wasm byte code light client contract raw gzip compressed byte wasmbytecode rpc handler processing msgstorecode make sure signer message match address authority allowed submit message normally address governance module storecode defines rpc handler method msgstorecode func keeper storecodegoctx contextcontext msg typesmsgstorecode typesmsgstorecoderesponse error kgetauthority msgsigner return nil errorsmodwrapfibcerrorserrunauthorized expected got kgetauthority msgsigner ctx sdkunwrapsdkcontextgoctx checksum err kstorewasmcodectx msgwasmbytecode ibcwasmgetvmstorecode err nil return nil errorsmodwraperr failed store wasm bytecode emitstorewasmcodeeventctx checksum return typesmsgstorecoderesponse checksum checksum nil contract bytecode stored state actually unnecessary wasteful store since wasm already store queried back needed checksum simply hash bytecode contract stored state entry key checksum contains checksum bytecodes stored light client proxy work light client proxy behind scene call cosmwasm smart contract instance incoming argument serialized json format appropriate environment information data returned smart contract deserialized returned caller consider example verifyclientmessage function clientstate interface incoming argument packaged inside payload object json serialized passed querycontract executes wasmvmquery return slice byte returned smart contract data deserialized passed return argument type querymsg struct statusmsgjsonstatusomitempty exportmetadata exportmetadatamsgjsonexportmetadataomitempty timestampatheight timestampatheightmsgjsontimestampatheightomitempty verifyclientmessage verifyclientmessagemsgjsonverifyclientmessageomitempty checkformisbehaviour checkformisbehaviourmsgjsoncheckformisbehaviouromitempty type verifyclientmessagemsg struct clientmessage clientmessage jsonclientmessage verifyclientmessage must verify clientmessage clientmessage could header misbehaviour batch update must handle type clientmessage appropriately call checkformisbehaviour updatestate updatestateonmisbehaviour assume content clientmessage verified trusted error returned clientmessage fails verify func clientstate verifyclientmessage ctx sdkcontext codecbinarycodec clientstore storetypeskvstore clientmsg exportedclientmessage error clientmessage clientmsgclientmessage return errorsmodwrapfibcerrorserrinvalidtype expected type got clientmessage clientmsg payload querymsg verifyclientmessage verifyclientmessagemsgclientmessage clientmessagedata err wasmqueryemptyresult return err global wasm variable wasm keeper structure keep reference wasm instantiated keeper constructor function keeper wasm store bytecode light client contract however wasm also needed wasm implementation clientstate interface function initialise contract execute call contract query contract since clientstate function access wasm keeper decided keep global pointer variable point instance one wasm keeper global pointer variable implementation clientstate function consequence positive adding support new light client upgrading existing light client way easier requires single transaction instead hardfork improves maintainability ibcgo since change codebase required support new client upgrade existence support rust dependency light client may exist negative light client written rust written subset rust could compile wasm introspecting light client code difficult compiled bytecode exists blockchain