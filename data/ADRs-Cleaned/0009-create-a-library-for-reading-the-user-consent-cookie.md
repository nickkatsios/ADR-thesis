create library reading user consent cookie technical story platui platui problem statement tracking consent store cookie consent information userconsent cookie urlencoded json information available frontend microservices javascript running user browser request header passed scala play controller running serverside frontend service interpret cookie decode parse scala json library also apply business logic ensure case uncertainty user default assumed rejected cooky javascript code propose make existing userpreferences object available window object mean service integrating tracking consent method available parsing cookie latest business logic additionally method subscribing notified change cookie preference realtime scala code situation problematic service raw userconsent cookie passed cookie header avoid team copy paste substantial quantity scala boilerplate replicating existing javascript logic across service look centralise logic easily maintained across platform ideally would like scala controller able something like scala private val themecookie cookiename theme value dark maxage somedaystosecondstoint private def allowedcookiesimplicit request requestheader userpreferencespreferencessettings seqthemecookie else seqempty val termsandconditions actionanycontent action implicit request oktermsandconditionspagewithcookiesallowedcookies driver keep repetitious boilerplate minimum change needed order single line code change centralise maintenance cookie reading logic easier roll change importance loosely coupled microservices avoidance unnecessarily introducing additional hard networked dependency microservices simplicity fewest number moving part preference introducing requirement microservices add additional library considered add needed logic playui playfrontendhmrc add needed logic bootstrapplay create microlibrary contain logic intention would added one library transitive dependency create hosted api decode accompanying client library nothing outcome chosen meet criterion positive consequence service determine acceptance rejection nonessential cooky single line code change cookie parsing logic rolled relatively easily teamplatui consuming service rely additional networked dependency additional library would needed assuming microlibrary added playfrontendhmrc bootstrapplay negative consequence version change userconsent cookie potential break functionality relying nonessential cooky consuming service may look introducing ability concept minor version increment version breaking change removal change meaning cookie type pro con add needed logic playui playfrontendhmrc good playui playfrontendhmrc already knowledge tracking consent bad logic duplicated across two library bad domainbusiness logic arguably doesnt live frontend component library add needed logic bootstrapplay good bootstrapplay already knowledge cooky bad would introduce knowledge tracking consent bootstrapplay already knowledge playui playfrontendhmrc trackingconsentfrontend see law demeter bad bootstrapplay owned teamplatui would hamper ability roll change cookie reading logic would require approval another team create microlibrary contain logic good teamplatui new library make change time change trackingconsentfrontend good defers library transitively add allowing proceed implementation keep open add either bootstrapplay playfrontendhmrcplayui later fallback advise team add good simple solution easy implement rollout create hosted api decode accompanying client library good potentially roll change centrally however likely change api would require update client library bad introduces host maintain backend microservice would expensive term ongoing running maintenance cost would substantially increase complexity number moving part bad introduces tight coupling microservices bad complicates local development team would spin another dependency service manager bad would likely still create library simplify integration bad unlikely would achievable needed timescales nothing good would require technical development bad team would introduce substantial boilerplate service bad bug boilerplate would difficult fix bad would extremely difficult roll change business logic across platform