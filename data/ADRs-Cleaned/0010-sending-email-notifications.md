sending email notifiations order send email notification user action publishing document work receive email generate content email subject body send email recipient dont anticipate sending email critical step user action still step prone error delay due interaction external system ensure sending email robust transient failure email sent confident accurate update critical api call mean sending notification nonproduction environment allows see notification would sent production prevents email sent intended recipient also possible see notification sent production order debug issue user report receiving notification content notification incorrect govuk notify combination action mailer active job sidekiq govuk notify govuk notify handle lowlevel concern sending email avoids setup mechanism sending email including logic handle lowlevel error retries handled notify default notify provide ruby gem make easy integrate service app without specific knowledge underlying apis notify dashboard see email sent log individual email well aggregate stats email notify provides facility restrict recipient email specific list restrict notification outside production order integrate notify app setup govuk publishing account follows one account production govuk publishing app two account testing notification integration staging agreed generic govuk publishing name part wider govuk strategy single notify account govuk publishing apps help limit future infrastructure growth action mailer action mailer generate individual email send notify action mailer process email recommended approach rail apps action mailer come inbuilt support testing sending email asynchronously although notify provides templating feature single generic template govuk publishing notification recipient subject body parameter body support limited form markdown action mailer handle generation email mean limit reliance notify template make change code usual benefit testing faster debugging version control notify support single recipient email generate send separate email recipient although requires api call easier reason failure individual email notify reject email recipient specific list one setup order retain endtoend email functionality avoid emailing user outside production action mailer interceptor redirect email google group integration staging environment google group act dumping ground viewing email generated enables check appear correctly text html form active job active job combination action mailer send email asynchronously mean delay calling notify apis impact user request retry feature active job cope transient failure notify action mailer integrates active job instead specific queueing system recent improvement active job framework also make viable background job avoid mixture framework active job handle asynchronous processing directly instead delegate queueing provider initially sidekiq already common govuk one inbuilt queueing adapter provided active job sidekiq sidekiq order handle actual processing background job sidekiq already apps govuk background job processing extent including apps managed wrapper gem order avoid duplicate retry behaviour disable sidekiq retries rely solely retry behaviour active job failure occurs job marked processed sidekiq retry manifest newly enqueued job retries exhausted exception propagate sidekiq job marked dead normally job would marked failed sidekiq requeued mean lose visibility number retries already raven report error sentry automatically integrates sidekiq note raven also integrates active job disabled sidekiq present active job catch exception part retry behaviour error get reported sentry exception handled active job retries exception handle exhausted already export sidekiq metric graphite consequence previously sidekiq implement background worker scheduling rewrite active job framework since active job retry job default longer add middleware facilitate aborting job retry feature active job instead sidekiq mean lose visibility number failure sidekiq dashboard metric exported graphite however retain visibility job totally failed body content email limited markdown subset implemented notify design call specific formatting liaise notify team implement something work text html email sent individual request notify doesnt support bulk recipient make easier reason failureretry individual email involves external api call