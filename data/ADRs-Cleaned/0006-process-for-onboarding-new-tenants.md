process onboarding new tenant enrolling marain service proposed defined adr way intend implement tenancy marain instance maraintenancy service noted adr managing desired model hand would excessively error prone design tooling allow create manage new tenant allow marain service licenced build tooling design underlying process tenant onboarding enrollment offboarding work allow new client tenant onboarded marain service without tightly coupling service central thing know everything envisaging central controlplane api referred remainder document management api marain primarily build top tenancy service provide standard operation creating new tenant enrolling marain service also allow manage concern licensing billing metering scope adr covered additional adrs work item documentation required onboarding onboarding relatively simple part process create new tenant client determine intend licensing work part management api play enrollment service enrollment interesting aspect process order avoid tightly coupling marain service management api two thing mean discovering available service mean determining configuration thats needed enroll service receiving attaching configuration tenant enrolled defined way creating required subtenants service making call dependent service behalf client described adr envisaging service tenant created single parent service tenant tenant underpin discovery mechanism allows management api enumerate service tenant enrolled provided discovery mechanism define way gather necessary information needed enroll tenant service intending make work defining common schema service communicate configuration requires well service upon depends service attach manifest file containing information service tenant via well known property key allowing management api obtain manifest part discovery process since process enrollment unenrollment standard across tenant actual implementation form part management api driven data manifest ever encounter situation service perform nonstandard action part tenant enrollment extend process support way service notified new enrollment could simple callback url potentially broadcasttype system something like azure event grid since dont yet service would attempt define mechanism time enrolling tenant service two thing firstly attach relevant configuration service tenant thats enrolled secondly service thats enrolled dependency service create new subtenant service tenant service enrolled service accessing dependency behalf client new subtenant enrolled dependedupon service level dependency dealt way example consider scenario two client three service root tenant client tenant contoso litware service tenant workflow operation foobar dependency tree service look like workflow contoso operation litware foobar seen diagram contoso licenced workflow foobar litware licenced workflow operation workflow dependency operation foobar operation dependency foobar let assume three service require storage configuration look happens litware enrolled workflow firstly manifest attached workflow service tenant obtain list required configuration enroll tenant workflow workflow manifest state workflow requires cosmosdb storage configuration also dependent operation foobar manifest operation foobar service tenant determine configuration required operation dependent foobar process repeated process determine list required configuration workflow sum four thing workflow storage config operation storage config foobar storage config invoked workflow foobar storage config invoked operation assemble information likely via marain management begin process enrollment first enroll litware tenant workflow attaching workflow storage configuration litware tenant workflow dependency create subtenant workflow service tenant call dependency behalf litware attach new tenant litware tenant well known property name specific workflow root tenant client tenant contoso litware workflow storage configuration workflowlitware subtenant workflow service service tenant workflow workflowlitware operation foobar next enroll new workflowlitware tenant operation foobar service start operation repeat process carried litware workflow resulting similar outcome workflowlitware tenant configuration attached operation service dependency operation foobar result sub tenant created operation calling foobar behalf workflowlitware new tenant attached workflowlitware operationsspecific wellknown key root tenant client tenant contoso litware workflow storage configuration workflowlitware subtenant workflow service service tenant workflow workflowlitware operation storage configuration operationsworkflowlitware subtenant operation service operation operationsworkflowlitware foobar next new operationsworkflowlitware tenant enrolled foobar service foobar service dependency create tenant simply attach storage configuration foobar tenant enrolled return also completes workflowlitware tenant enrollment operation root tenant client tenant contoso litware workflow storage configuration workflowlitware subtenant workflow service service tenant workflow workflowlitware operation storage configuration operationsworkflowlitware subtenant operation service operation operationsworkflowlitware foobar storage configuration foobar next continue workflow enrollment litware tenant enrolling new workflowlitware tenant workflow dependency foobar operation service enrolling operationsworkflowlitware foobar result tenant created foobar config attached workflowlitware root tenant client tenant contoso litware workflow storage configuration workflowlitware subtenant workflow service service tenant workflow workflowlitware operation storage configuration operationsworkflowlitware subtenant operation service foobar storage configuration operation operationsworkflowlitware foobar storage configuration foobar completes litwares enrollment workflow service seen resulted multiple servicespecific litware tenant created litware never explicitly made aware existence tenant able directly parent service make call dependency behalf litware tenant however step litware also enrolled operation service present workflow able operation litwares behalf workflowlitware tenant however implementation detail workflow something able change without impacting litware long result change public workflow api order allow litware operation service directly process went workflow repeated storage configuration operation attached litware tenant subtenant operation created accessing foobar behalf litware root tenant client tenant contoso litware workflow storage configuration workflowlitware subtenant workflow service operation storage configuration operationslitware subtenant operation service service tenant workflow workflowlitware operation storage configuration operationsworkflowlitware subtenant operation service foobar storage configuration operation operationsworkflowlitware foobar storage configuration operationslitware foobar new operationslitware tenant enrolled foobar service result foobar storage configuration attached operationslitware service root tenant client tenant contoso litware workflow storage configuration workflowlitware subtenant workflow service operation storage configuration operationslitware subtenant operation service service tenant workflow workflowlitware operation storage configuration operationsworkflowlitware subtenant operation service foobar storage configuration operation operationsworkflowlitware foobar storage configuration operationslitware foobar storage configuration foobar completes enrollment litware workflow operation service seen three different path litware make indirect foobar service possible client separate storage fact default even client marain storage data three different usage scenario foobar stored different container noted client get configure new subtenants directly fact unaware essentially implementation detail approach multitenancy marain able retrieve subtenants tenancy service update directly said likely management api allow configuration changed without exposing fact subtenants exist default configuration whilst want allow user bring storage marain service may likely scenario effectively four main way marain fully hosted default storage service storage deployed alongside service fully hosted managed nonstandard storage deploy separate storage account per client hosted clientprovided storage bring storage model selfhosted deployed client azure subscription case would expect storage deployed service essentially fully hosted order make first last simpler make configuration default storage available enrollment process simply copied tenant enrolled rather requiring explicitly stated every enrollment manifest file schema allow marking configuration optional indicating default configuration provided sensible location store default configuration service tenant offboarding offboarding considered many question happens client data stop marain likely depend licensing agreement put place result considered later consequence whilst adr address tenant created configured part enrollment yet cover updated new version service deployed requires different configuration scenario tenant service would potentially updated new configuration may dealt versioning requiring tenant enrolled specific version service separate service tenant existing version service would require take sidebyside approach versioning marain would likely make much straightforward deploy update move tenant onto new version deferring work better answer question versioning