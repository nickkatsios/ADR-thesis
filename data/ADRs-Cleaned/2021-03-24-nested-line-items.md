title processing nested line item area checkout tag checkout cart lineitems want handle nested order line item currently line item available nested cart processor consider first level line item one hand could implement cart processor process level line item hand nested line item added via plugins would implement processing logic core cart processor continue work getflat enrich way required data item cart fenced item could also processed processor process method hand still work getflat take care line item first level way collision processing line item plugin reuses core line item easily call processor handle nested line item example namespace shopwarecorecheckoutcart shopwarecorecheckoutcarterrorincompletelineitemerror shopwarecorecheckoutcartlineitemcartdatacollection shopwarecorecheckoutcartlineitemlineitem shopwarecorecontentproductcartproductcartprocessor shopwarecoresystemsaleschannelsaleschannelcontext class plugincartprocessor implement cartprocessorinterface var creditcartprocessor private creditcartprocessor var productcartprocessor private productcartprocessor public function constructcreditcartprocessor creditcartprocessor productcartprocessor productcartprocessor thiscreditcartprocessor creditcartprocessor thisproductcartprocessor productcartprocessor public function process cartdatacollection data cart original cart tocalculate saleschannelcontext cartbehavior behavior void lineitems originalgetlineitemsfiltertypepluginlineitemtype structure plugin line item plugin line item product line item credit line item foreach lineitems lineitem thiscalculatelineitem original behavior data tocalculateaddlineitem private function calculatelineitem lineitem cart original saleschannelcontext cartbehavior behavior cartdatacollection data void lineitemhaschildren originalremovelineitemgetid originaladderrorsnew incompletelineitemerrorlineitemgetid child return temporiginalcart new carttemporiginal originalgettoken tempcalculatecart new carttempcalculate originalgettoken provide nested product credit item temporiginalcartsetlineitems lineitemgetchildren first start product calculation required data product processor already loaded stored cartdatacollection thisproductcartprocessorprocessdata temporiginalcart tempcalculatecart behavior calculate credit credit scoped already calculated product required data credit processor already loaded stored cartdatacollection thiscreditcartprocessorprocessdata temporiginalcart tempcalculatecart behavior line item calculated new child lineitemsetchildren tempcalculatecartgetlineitems consequence plugins implement processing logic alternatively extend shopwares cart processor specific implementation nested line item