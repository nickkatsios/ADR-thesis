elasticsearch sidecar health update sidecar anymore processmanager removed simplification keystore updater run initcontainer hence monitor sidecar health anymore proposed deciders cloudonks team problem statement proposal aim outline possible approach report elasticsearch sidecar health combination cluster state clusterwide monitoring alerting elasticsearch pod composed container main container elasticsearch sidecar container running keystoreupdater keystoreupdater sidecar call elasticsearch endpoint nodesreloadsecuresettings decrypt reread entire keystore snapshotter job connect depends environment variable username secret mounted readonly file password certificate elasticsearch readiness currently health check based state sidecar sidecar error without anyone ever noticing state check everything correctly setup sidecar container call api succeeds sidecar container ready elasticsearch container impacted pod considered ready kubernetes stop send traffic pod must accept two container intimately linked sidecar failure impact elasticsearch availability design however binary simple thing fast start reliable could admit probability failure sidecar run simple binary low compared elasticsearch failure another challenge take account sidecar error expected ready yet mitigated considering startup delay ready report error period detect never started readiness probe fail never becomes ready driver error distinction sidecar failure easily identified elasticsearch failure error side effect sidecar failure increase unavailability elasticsearch compared current situation promote reliability simplicity healthchecking critical part system considered kubernetesway liveness probe expose http health endpoint kubernetesway readiness probe expose http health endpoint loggingbased error reporting operator polling event sending expose http health endpoint outcome chosen give flexibility take case failure depend kubernetes probeskubelet depend external component positive consequence collecting sidecar health operator side give react failure http server sidecar brings flexibility interact pod depend kubernetes probe kubelet minimize external dependency negative consequence increase little failure domain sidecar presence http server add complexity responsibility operator pro con kubernetesway liveness probe keystoreupdater sidecar expose http endpoint live consumed liveness probe endpoint return success long ready ready return response reflecting state call api considered ready reachable solution implies probe sidecar poll elasticsearch good well integrated kubernetes kubernetes restart sidecar container probe fails could probably resolve issue related state system example memory many connection good exposing health http allows easily collect system good easy expose cluster state another http endpoint bad kubernetes restart sidecar container liveness probe fails happens indefinitely sidecar container reach crashloopbackoff wont ready service impacted kubernetesway readiness probe endpoint consumed readiness probe goal ensure keystoreupdater able call api least prevent error coming bad configuration good well integrated kubernetes good exposing health http allows easily collect system good easy expose cluster state another http endpoint bad kubernetes stop send traffic readiness probe fails loggingbased error reporting solution consists limiting reporting error log sidecar retrieve ship container log agent cluster dedicated monitoring could filebeat fluent bit cluster state also logged collected aggregated elasticsearch good pretty simple implement good completely isolated elasticsearch bad make failure detection dependent log collection pipeline polling operator sending event term exposing http endpoint health sidecar considering sidecar healthy ready startup operator poll endpoint report change health event sending event added benefit giving richer behaviour top polling make state sidecar process observable could example return revision secret sidecar process seen response healthstatus check implement coordinated behaviour top example sidecar seen secret revision good readinessliveness probe provoke container restart service unavailability good give aggregated view sidecar health good make state sidecar process observable good give react failure bad increase responsibility operator bad add complexity operator link discussion issue httpskubernetesiodocstasksconfigurepodcontainerconfigurelivenessreadinessprobes httpswwwelasticcoguideenbeatsfilebeatcurrentrunningonkuberneteshtml