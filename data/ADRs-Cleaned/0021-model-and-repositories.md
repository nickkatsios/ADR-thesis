model repository aiming replace usage legacy objectmodel rejected proposal applied main argument fear adding new extra layer would confuse community help costtime would take apply entity place valuable topic adding extra layer would indeed hide legacy core class doesnt remove usage mostly hide instead going direction decided would valuable project start migrating core class doctrine entity adr opened define strategy httpsgithubcomprestashopadrpull today case way get data database rely legacy objectmodel class model advantage drawback already knwo dont plan keeping future least exact current form yet keep working feature service cqrs command miscellaneous data provider access data also alternative course doctrine entity legacy query dbal query problem stay solution rely code bound disappear modificed thus everytime create code relying objectmodels create new technical debt may big one technical debt nonetheless since well removereplace code point purpose adr introduce new access data one independent actual implementation objectmodel doctrine dbal propose add new interface represent model data data interface dont domain business logic simply mean acces data chose interface advantage independent implementation includes different way access could even imagine data accessed remote api interface internal code doesnt matter long interface respected summary adr proposes add new model interface represent data model also includes repository interface one associated model interface define structure much detail possible structure architecture naming convention imposed interface part implementation question dont thought implementation andor review limitation adr didint take account possible relationship model except multi shop special case could immproved second adr starter focus model basic field aka column focus read plan extending principle writeupdatedelete operation complex also dealt another adr model interface take class based objectmodel turn model interface representing property database column generic interface always translated object multilang property getters field return one string already localized language specified fetching object php interface contactinterface public function getcontactid int public function getemail int localized getters public function getname string public function getdescription string localized interface mostly crud case require data language edition multi lang component multilang field returned associative array language key dont include monolang getter php interface localizedcontactinterface public function getcontactid int public function getemail int return arrayint string associative array key languageid value localized value public function getlocalizednames array public function getlocalizeddescriptions array scalar value much possible fieldsgetters return scalr value much possible dont valueobject interface default compatible many case possible remaining simple easier serialization decimalnumber considered scalar value since better native float actually even mandatory type decimal value integer shoudl int though similar reason even possible strictly type array rely array instead collection simplify implementation maybe one day php language evolve handle typed array may able improve repository get entity multi lang entity must specify languageid multi shop entity content vary depending shop must specify shopid basic association without content modification simple getassociatedshopids enough shopid parameter necessary multi shop entity complex multi shop behaviour may getter based shopconstraint entity neither multi shop multi lang dont parameter course two repository needed multi lang interface since dont return interface however multi shop entity shopid always mandatory php interface contactrepositoryinterface public function getcontactint contactid int languageid int shopid contactinterface interface localizedcontactrepositoryinterface return language present database param contactid param shopid return localizedcontactinterface public function getlocalizedcontactint contactid int shopid localizedcontactinterface param contactid param shopid param language list filtered language return localizedcontactinterface public function getlocalizedcontactwithlanguagesint contactid int shopid int language localizedcontactinterface exception found exception entity found exception thrown currencynotfoundexception contactnotfoundexception found exception must extend associated model exception currencyexception type exception may implement generic exception interface note already implemented many domainexception cqrs question capitalize refactor mapping model exception domain exception may implemented existing command may troublesome php class currencynotfoundexception extends currencyexception implement entitynotfoundexceptioninterface invalid argument exception provided argument follow valid value like positive invalid argument provided throw invalidargumentexception extends base modelexception get byxyz php interface currencyrepositoryinterface public function getcurrencyint currencyid int languageid int shopid currencyinterface public function getcurrencybyisocodeint isocode int languageid int shopid currencyinterface public function getcurrencybyarray criterion int languageid int shopid currencyinterface one entity found happen getbycriteria exception thrown nonuniquecurrencyexception extends currencyexception implement nonuniqueentityexceptioninterface list search filter return full object must taken return array interface lose strong type implement collection entity maybe performant return collection interface must taken findall getall php interface currencyrepositoryinterface return currencyinterface public function findall array public function getall currencycollectioninterface public function findbyarray filter array sortby int limit null int offset null array dbal query object model doctrine entity case base implementation prestashopbundlemodelrepository preferably based dbal dbal query implemented inside repository passed dtos create dto prestashopbundlemodel implement interface specific case based legacy implementation based objectmodel create objectmodelrepository adaptermyentitydomainrepositorymyentityrepository objectmodel must implement model interface objectmodelrepository passed dependency prestashopbundlerepository proxy doesnt implement interface implementation based doctrine entity create entityrepository prestashopbundleentityrepositorymyentityrepository doctrine entity must implement interface doctrine repository passed dependency prestashopbundlerepository proxy doesnt implement interface dbal method example php namespace prestashopbundlemodelrepository class accessrepository implement accessrepositoryinterface public contructconnection connection thisconnection connection return roleinterface public function getroles array implement via dbal query querydata thisconnectioncreatequerybuilder parse data create dto object implement interface return dtos objectmodel example php namespace prestashopbundlemodelrepository prestashopprestashopadapterproductrepositoryproductrepository adpaterproductrepository class productrepository implement productrepositoryinterface private productrepository public contructadapterproductrepository productrepository thisproductrepository productrepository public function getproductint productid int languageid int shopid localizedproductinterface return product object model implement interface productinterface return thisproductrepositorygetbylanguagenew productidproductid new shopidshopid new languageidlanguageid public function getlocalizedproductint productid int shopid localizedproductinterface return product object model implement interface localizedproductinterface return thisproductrepositorygetnew productidproductid new shopidshopid doctrine example php namespace prestashopbundlemodelrepository prestashopbundleentityrepositoryshoprepository doctrineshoprepository class shoprepository implement shoprepositoryinterface private shoprepository public contructdoctrineshoprepository shoprepository thisshoprepository shoprepository public function getshopint shopid shopinterface return shop doctrine entity implement interface shopinterface return thisshoprepositoryfindbyidshopid legacy static method example php namespace prestashopprestashopadaptersecurity class access public function getroles array rolesflattenarray legacyaccessgetrolesemployeeprofileid transform flatten array interface implemented dto probaly return arraymapthis turnarraytointerface rolesflattenarray private function turnarraytointerfacearray data roleinterface return new roledto namespace prestashopbundlemodelrepository prestashopprestashopadaptersecurityaccess adapteraccess class rolerepository implement rolerepositoryinterface private access public contructadapteraccess access thisaccess access return roleinterface public function getroles array return thisaccessgetroles namespaces rule folder root namespace content rule srccoremodel prestashopprestashopcoremodel model interface maybe split domain least large one like product also contain dtos ifwhen needed allows usage scalar decimalnumber shopconstraint code prestashopprestashopcoremodel namespace srccoremodelrepository prestashopprestashopcoremodelrepository repository interface could split subnamespaces large domain allows usage scalar decimalnumber shopconstraint code prestashopprestashopcoremodel namespace srcprestashopbundlerepository prestashopbundlerepository implementation interface regardless implementation dbal objectmodel doctrine allows sure find repository usage legacy object srcadaptermodelrepository prestashopprestashopadaptermodelrepository repository based abstractobjectmodelrepository based objectmodel class dont implement model repository interface implement partially method based static call also avoid putting bundle namespace dont see particular restriction needed srcprestashopbundleentityrepository prestashopbundleentityrepository repository based doctrine entity usage legacy class