upgrade contentservers tech stack moving remaining route fxasettings deciders mill soper lauren zugai vijay budhram technical story fxa fxa problem statement many view contentserver still served rendered via backbonejs increasingly outofdate framework bring view uptodate bring technical debt already converted setting view reactjs moved separate reactjs app want follow example convert remaining contentserver route reactjs open question include well handle api call new page new view live well safely roll change user backend work may look like well clean rollout infrastructure finished driver want make change safe possible minimizing chance disruption user experience want avoid unnecessary work clip extra step wherever possible rolling change cleaning upon successful rollout simple possible sake simplicity efficiency lean made fxasettings conversion much possible want refactor make sense change preparation new work planned considered location converted view new react app host new contentserver route separate react app alongside fxasettings app would allow leave setting app untouched unchanged shared react app convert existing reactjs app currently fxasettings also house new route refactor backbone view react embed react component backbone view see detail previous adr incremental rollout approach group work many route released block batch like route resetpassword flow incremental rollout ensure route depend flow work expected may many group work experiment group feature flag turn booleanvalued environment variable enable multiple experiment approach requires set tear work feature flag limitation see next section give granular control beta url beta route refers approach originally took new setting react application express framework served setting route began beta new setting could tested betasettings current setting still available setting alternative approach create delta path express account resetpassword could show existing contentserver route resetpasswordshowreactapptrue show react version dont access experiment routing level since experiment infra spin backbone app start occurs route setup check parameter feature flag turned pro offer faster development setup con requires plan attack eventually migrate route betawhatever whatever would likely require implementation per route reqa case setting route parent setting route onetime flip betasettings setting handling experiment note experiment accessible backbone side since experiment infrastructure set setting regardless chosen react version contentserver route living fxasettings accessible parameter present choose feature flag feature flag entirely ideal risk could likely manually access local storage check user experiment fxacontentservers router file check experiment render backbone view via createviewhandler user experiment navigateaway route query parameter multiple experiment beta route block route guarded separate experiment user experiment router send user react version page via paramater may possible since cannot access experiment express level multiple experiment beta route block route guarded separate experiment user experiment router send user react version page via betaoriginalurl parameter single experiment config setting beta route route guarded one experiment separate feature flag per block route router file check experiment well feature flag send user react version page via betaoriginalurl parameter single experiment config setting beta route route guarded one experiment separate feature flag per block route router file check experiment well feature flag send user react version page via parameter consideration fxacontentserver lot thing app startup setting like metric spin recognizing relying party oauth sync check etc intend eventually removing fxacontentserver setting eventually thing app startup instead implemented wont access query params provided contentserver may follow adr cover approach launch fxasettings new base application depending complexity discussion time gql usage want extend gql functionality already exists fxasettings due advantage gql offer see outcome currently fxa implemented gql authenticated page gql authenticated route gql authenticated route continue rest api call user unauthenticated gql everywhere add per mutation query talk graphqlapi without authenticated allowing everywhere except likely oauth route another worm implication want gql everywhere instead hitting authserver directly rest api call likely even selective ensure graphqlapi handle emitting metric sending email sending push notification sqs eventbroker create new api set endpoint fxaauthserver graphqlapi pro faster implement con ideal move functionality shared space instead kicking road eventually remove newly created api favor shared service authclient access fxaauthserver api graphqlapi pro faster implement risk since already authclient route gql con likely refactor later remove functionality favor shared service iii move piece functionality standalone librarytype service fxashared typescript something like bull jobworker scheme decouple service send email actual email sending service pro get closer preferred architecture longterm mitigates refactoring work later con large scope increase project combination iii authclient needed graphqlapi migrating service fxashared pro seems like happy medium allows continue moving towards preferred architecture without blocking work con scope increase iii still needing refactoring work later time may requires coordinate plan across team since subscription platform looking graphql move functionality graphqlapi also potentially shared work outcome location converted view chosen shared react app conventional react approach react app cleanly handle internal routing locating view within single react app least confusing pattern engineer work shared state flow parameter example much easier handle arent navigating different apps easily shared component page navigation page efficient positive consequence navigation faster mental model engineer simpler bringing maintenance complexity dont increase amount work share state across apps negative consequence put work update safely rollout change setting app incremental rollout approach chosen single experiment config setting beta route config setting feature flag accessed express level require set tear experiment user still experiment directed react version route requires refactoring avoids reqa temporary beta approach positive consequence rework later smoother experience user negative consequence nonbeta approach requires larger set ticket minor unknown beta approach gql usage chosen extend gql functionality already exists fxasettings gql many route possible ensures type consistency complex type sharing reduces interaction backend frontend allows frontend ask exactly consistent rest fxasettings moving towards streamlined way reading writing data feed larger overarching goal positive consequence consistent rest modernized stack gain benefit gql offer negative consequence add additional work add necessary queriesmutations chosen authclient needed graphqlapi migrating service fxashared positive consequence frontend functionality work unblocked gql resolver work done doesnt wait refactoring work negative consequence require little refactoring line much link create new react app setting redesign adr graphql apollo setting redesign adr