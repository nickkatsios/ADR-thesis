rework permission system user pass query flowmachine instance first sign flowauth instance within flowauth instance user set claim define combination query run space scope generated full tree walk every combination query geographic component subqueries geographic component though normally derived targetted traversal query tree place full walk required offered fine degree control query could permit user run available set query increased space expanded exponentially eventually becoming unwieldy manifested several place building api spec inside flowapi displaying spec flowauth frontend server leading timeouts crash lowercapability machine passing large specific scope around jwts core change implemented change definition user access instead combination query user assigned role composed scope scope one two type simple scope control access serverwide capability allornothing currently implemented simple scope run permit user hold role run query run flowapi endpoint getresult permit user get result query get flowapi endpoint getavailabledates permit user get list available run query server scope imply role provided capabilites run query must provided combination one complex scope complex scope control access combination geographic component toplevel query descendent query toplevel query method available user flowmachine directly toplevel query may require set subqueries run wich turn may require subqueries descendent query finally geographic component spatial presentation available role query without spatial aggregate historgramaggregate geographic component nonspatial complex scope form geographiccomponenttoplevelquerysubquery ordering built assumed order importance user example common case administrator want create role restrics access admin level mostfrequestlocation subquery spatialaggregate toplevel query consequence new flowauth schema shown mermaid erdiagram server role contains role scope provides permission user role work server scope provides new auth flow follows mermaid sequencediagram participant flowauth actor user participant flowapi note user selects role token user flowauth role note flowauth check user permitted role flowauth user signed token role scope note user build query user flowapi query token note flowapi check query params covered single role flowapi user query result consequence much faster lightweight building token flowauth frontend lowercapability machine finegrained control query permission knockon effect reducing space managable sizeperhaps leading user make meaningful scope within role instead defaulting user cant explicitly grouped anymore role supercede group function scope cannot assigned directly user anymore