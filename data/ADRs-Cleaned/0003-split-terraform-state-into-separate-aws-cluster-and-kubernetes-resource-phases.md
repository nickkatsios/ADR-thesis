split terraform state separate aws cluster kubernetes resource phase terraform require least aws kubernetes provider eks infrastructure resource defined via aws incluster resource configuration defined via kubernetes kubernetes provider requires argument determined aws resource output nave implementation would look something like provider aws region varregion resource awsekscluster cluster provider kubernetes host awseksclusterclusterendpoint clustercacertificate basedecodeawseksclusterclustercertificateauthoritydata token awseksclusterclustertoken terraform provider fully handled node plan graph cannot guaranteed aws resource fully created point terraform configures kubernetes provider lead nondeterministic behaviour race condition etc terraform provider config value known ahead time split terraform resource two separate state phase actual name tbd clusterinfrastructure eks cluster associated aws resource kubernetes provider defined clusterservices kubernetes resource ingres controller incluster configuration awsauth configmap kubernetes provider configured via remote state clusterinfrastructure applied aws provider defined unless identify access aws data source resource obtaining current aws region consequence eks module manageawsauth input variable must set false prevent module attempting create aws auth configmap object also prevent potential issue tearing eks cluster deployed workload ingres controller service object commonly provision aws load balancer terraform know therefore include plan graph lead terraform attempting delete cluster reference detatched aws resource also introduces clear boundary separation concern cluster provisioning incluster resource configuration important useful divison enforce keep largely generic cluster infrastructure separate govukspecific configuration supporting service principle provides path switching eks cluster kubernetes cluster environment well providing baseline eks cluster could future nongovuk purpose