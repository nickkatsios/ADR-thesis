remotesettings client mobile browser proposed discussion httpsgithubcommozillaapplicationservicespull deciders csadilek mobile team leplatrem remotesettings team mhammond applicationservices team problem statement mozillas mobile browser requirement access remote setting service currently lack library tool suitable without work concrete case management search engine configuration stored remote setting firefox desktop shipped individual file mobile browser requiring application release change constraint proposed solution work performed mozillas mobile team limited experience rust required completed document identifies requirement identifies tool already exist close suitable identifies available take outline requirement requirement library able access mozillas remote setting service return result mobile browser list requirement exhaustive instead focus requirement drive making process identifies nonrequirements first nonrequirements following item may degree desirability hard requirement initial version http connection server must validated requirement verify content received server there requirement check signature body there requirement validate result server conforms predefined schema trust server data there requirement return stronglytyped data application returning json stringobject suitable there requirement cache server response filesystem app request content fine library always hit server there requirement kind scheduling awareness network state requested content immediately return appropriate error fetched there requirement support publishing record requesting review providing approval via new library there requirement push communicate change application enable rapidenrolment type feature there requirement manage bucket group collection via new library initial requirement requirement initial version library allow fetching record mozillas remote setting server includes support attachment fetching incremental change library create thread run event loop mobile apps responsible threading requirement might change future considering kind change mobile application scope project must necko networking android must enforce connection via valid http host although testonly exception might helpful allowing localhost connection http library remotesettings library browser specifically mean nimbus must also capable library work move nimbus library must considered part project existing library identified following library may suitable project remotesettings desktop version remote setting client desktop written javascript relatively stable since least considered capable roadblock suitable mobile browser written javascript might possible expose android via geckoview there reasonable path made available rust remote setting client existing remote setting client github client written rust evolved number year recent change made support merino rewritten python known consumer library left main attribute library relevant discussion written rust ffi currently consumable rust code recently updated async rust requires internal event loop includes capability verify signature content nimbussdk client nimbussdk component applicationservices repository written rust client code talk remotesettings server actually nimbus collection there reason believe cant general case main attribute library relevant discussion consumed component already consumed mobile browser via uniffi verify signature content could done hasnt sufficient justification made realistic threat model would solved capability client persist local cache remote resource instead delegate responsibility consuming application case nimbus persist via rkv library async rust instead everything blocking run thread exclusively created app good test support run docker image considered writing new library requirement client writing new library kotlin swift currently realistic however rejecting dont want duplicate effort required write maintain two library inevitably feature capability diverge future requirement supporting content signature verification would lead significant duplication writing new library scratch rust exposing via uniffi platform also possibility however rejecting existing rust library already exist would better served modifying forking one existing library existing remote setting client modifying forking existing client attractive would require number change async capability would probably removed rust event loop mobile browser something trying avoid better understand implication given browser already event loop threading model persistence model library something requirement new library isnt problem probably would preclude able library nimbus end result would effectively two remotesettings client written rust browser api change would probably required make suitable uniffi would also necessary would tractable would update nimbus client would almost certainly require moving client applicationservices repository avoid following issue marrying persistence model client existing rkvbased persistence nimbus would required ensuring upstream version change continued work managing circular dependency exists due library needing viaduct complication build process library end megazord exact reason nimbus applicationservices repo existing nimbus client splitting existing client nimbus way allows nimbus continue also making available standalone also attractive particular feature set client overlap requirement new library local persistence necessary signature verification required already component exposed via uniffi note preclude nimbus new crate moving existing remote setting client point future key benefit keep nimbus new crate client updating different client future always remain chosen chosen allows reuse new client nimbus well android minimal initial development effort new library end growing requirement already existing remote setting client remain able copy functionality library specific plan section nonnormative strictly part adr exists highlevel view task required create new toplevel component applicationservices repository identify exact api wish expose new library describe api uniffi implement api stub rust todoor similar depicted remotesettings diagram identify part nimbus factored shared component depicted rsclient diagram move functionality new shared component note component probably uniffi udl file consumption new component existing nimbus component still uncertainty requirement nimbus new component share configuration initialization code might something complex seems unlikely possible included completeness identify nimbus test move new client move update nimbus take dependency new component including test flesh api new toplevel component new shared component replace todo macro real code identify impact nimbus androidswift code particular shared configuration initialization code identified applicationservices repo implement android code applicationservices repo desired make ergonomic library mobile platform update mobile code uniffi change made nimbus implement mobile code consumes new library including test profit diagram attempt depict final layout note rsclient remotesettings new component everything else already exists please consider name suggestion name hard sure better dashed line normal rust dependency dependency listed cargotoml solid line component uniffi viaduct little odd consumed mobile application indirectly via glean hence support please ignore anomaly mermaid flowchart subgraph appservicessupportshared component applicationservicescomponentssupport rsclient othersupportcomponents end subgraph appservicescomponentstoplevel applicationservices component applicationservicescomponents nimbus remotesettings viaduct end subgraph mobile code mobile repository fenix firefoxios end nimbus nimbusudl mobile remotesettings remotesettingsudl mobile rsclient nimbus othersupportcomponents nimbus rsclient remotesettings othersupportcomponents remotesettings viaduct rsclient othersupportcomponents rsclient content signature section nonnormative strictly part adr exists content signature explicitly called nonrequirement capability sticking point desktop version remote setting client significant effort spent worth expanding http enforced network request consumer library high degree confidence server hit client server expect hit maninthemiddle attack able redirect different server response server exactly sent mozilla controlled server maninthemiddle attack able change content inflight therefore content received must exactly sent mozilla controlled server content signature offer additional capability checking content remote setting response match signature generated secret key owned mozilla independenty http certificate request capability added desktop version primarily protect integrity data rest desktop client cached response disk risk data could tampered effectively impossible guarantee data finally presented application initially sent main threatmodel required capability party application installed system firefox installed security model enforced desktop operating system notably window evidence rdparty application would locate modify cache remotesettings response modify way benefited caused revenue harm mozilla obvious example changing search provider setting reason declaring capability nonrequirement initial version twofold also declared caching response nonrequirement meaning there data rest managed library vulnerable kind attack mobile operating system far stronger application isolation general case party mobile application prevented touching file application obviously though thing may change future example might add response caching must sure reevaluate requirement requirement change