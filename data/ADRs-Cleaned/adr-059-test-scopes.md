adr test scope changelog initial draft add precision integration test add precision test proposed partially implemented abstract recent work sdk aimed breaking apart monolithic root module highlighted shortcoming inconsistency testing paradigm adr clarifies common language talking test scope proposes ideal state test scope adr module refactoring express desire sdk composed many independently versioned module adr app wiring offer methodology breaking apart intermodule dependency dependency injection described epic separate sdk module standalone module module dependency particularly complected test phase simapp key test fixture setting running test clear successful completion phase epic require resolution dependency problem epic unit testing module via mock thought gordian knot could unwound mocking dependency test phase module seeing refactors complete rewrite test suite discussion began around fate existing integration test one perspective ought thrown another integration test utility place sdks testing story another point confusion current state cli test suite xauth example code called integration test reality function end end test starting tendermint node full application epic rewrite simplify cli test identifies ideal state cli test mock address place end end test may sdk identify three scope testing unit integration end end seek define boundary shortcoming real imposed ideal state sdk unit test unit test exercise code contained single module xbank package client isolation rest code base within identify two level unit test illustrative journey definition lean heavily bdd book formulation section illustrative test exercise atomic part module isolation case might fixture setupmocking part module test exercise whole module function dependency mocked journey almost like integration test exercise many thing together still mock example journey illustrative test depinjects bdd style test show rapidly build many illustrative case demonstrating behavioral rule without much code maintaining high level readability example depinject table driven test example bank keeper test mock implementation accountkeeper supplied keeper constructor limitation certain module tightly coupled beyond test phase recent dependency report bank auth found total usage auth bank production code test tight coupling may suggest either module merged refactoring required abstract reference core type tying module together could also indicate module tested together integration test beyond mocked unit test case setting test case module many mocked dependency quite cumbersome resulting test may show mocking framework work expected rather working functional test interdependent module behavior integration test integration test define exercise relationship arbitrary number module andor application subsystem wiring integration test provided depinject helper code start running application section running application may tested certain input different phase application life cycle expected produce invariant output without much concern component internals type black box testing larger scope unit testing example clientgrpcquerytesttestgrpcquery test misplaced client test life cycle least runtime bank progress startup genesis query time also exercise fitness client query server without putting byte wire queryservicetesthelper example xevidence keeper integration test start application composed module keeper integration test suite one test suite exercise handleequivocationevidence contains many interaction staking keeper example integration suite app configuration may also specified via golang yaml statically dynamically limitation setting particular input state may challenging since application starting zero state may addressed good test fixture abstraction testing test may also brittle larger refactors could impact application initialization unexpected way harder understand error could also seen benefit indeed sdks current integration test helpful tracking logic error earlier stage appwiring refactors simulation simulation also called generative testing special case integration test deterministically random module operation executed running simapp building block chain specified height reached specific assertion made state transition resulting module operation error halt fail simulation since crisis included simapp simulation run endblockers end block module invariant violation also fail simulation module must implement appmodulesimulationweightedoperations define simulation operation note module implement may indicate gap current simulation test coverage module returning simulation operation auth evidence mint params separate binary runsim responsible kicking test managing life cycle limitation may take long time run minute per simulation timeouts sometimes occur apparent success without indication useful error message provided requiring developer run simulation locally reproduce test end end test exercise entire system understand close approximation production environment practical presently test located testsee rely testutilnetwork start inprocess tendermint node application built minimally possible exercise desired functionality sdk application required module test application developer advised application test limitation general limitation end end test orchestration compute cost scaffolding required start run prodlike environment process take much longer start run unit integration test global lock present tendermint code cause stateful startingstopping sometimes hang fail intermittently run environment scope test complected command line interface testing accept test scope identify following point scope app type mock unit none yes integration integration helper simulation minimal app minimal app valid sdk application developer test application full application instead minimal app unit test module must mocked unit test coverage illustrative test outnumber journey unit test unit test outnumber integration test unit test must introduce additional dependency beyond already present production code module unit test introduction per epic unit testing module via mock result near complete rewrite integration test suite test suite retained moved testsintegration accept resulting test logic duplication recommend improving unit test suite addition illustrative test integration test integration test shall located testsintegration even introduce extra module dependency help limit scope complexity recommended smallest possible number module application startup dont depend simapp integration test outnumber test simulation simulation shall minimal application usually via app wiring located xmodulenamesimulation test existing test shall migrated integration test removing dependency test network inprocess tendermint node ensure lose test coverage rest runner shall transition process tendermint runner powered docker via dockertest test exercising full network upgrade shall written cli testing aspect existing test shall rewritten network mocking demonstrated consequence positive test coverage increased test organization improved reduced dependency graph size module simapp removed dependency module intermodule dependency introduced test code removed reduced run time transitioning away process tendermint negative test logic duplication unit integration test transition test written dockertest may bit worse neutral discovery required transition dockertest discussion may useful test suite could run integration mode mocked tendermint fixture real tendermint many node integration fixture could quicker run fixures could battle hardening poc xgov completed progress unit test demonstrating bdd rejected observing strength bdd specification readability con cognitive load writing maintaining current consensus reserve bdd place sdk complex rule module interaction demonstrated straightforward low level test case continue rely table test level network mocking integration test still worked formalized