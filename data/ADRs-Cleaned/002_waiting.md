harness waiting strategy seeing thing happen harnes action observe state start sending message wait existing stack complete run animation frame necessary done make test pas triggered browsernavigationload via port command test asserts see external navigation screen wasnt loading waited animation frame update turn browsernavigationload send port message back app involves settimeout call since send function port regular function there wait wait thing complete unlike harness function wait navigation load happens send message back program update view external navigation screen message processed via settimeout allows next function processed turn observation screen fails since update hasnt happened yet update happens see screen updated expected another test show animation frame task reset setup failed subscribed animation frame another animation frame occurs observe mean behavior test witten harness differs behavior regular spec described adr generalize problematic case described think incoming port message result command processed show problem subsequent function call test processed even though activity resulting port message yet completed note usage specfile function follow pattern similar browsernavigationload message sent back spec program signal something recorded processed note noticed test asserts navigation view update show weve navigated beyond bound elm program isnt really important assert upon suppose case would expect view updated ignoring doesnt seem like great although maybe better test demonstrates problem worth solving dont run animation frame observe step ignore problem navigationload test see good idea expose way run function synchronously program runner way navigationload occurs call function immediately synchronously run animation task actually make test pas benefit isolating change case navigationload occurs due problem distinctive loading url really problem follows fact action elm program triggered sending port message directly test something cant happen normal spec one main reason harness first place describe interaction elm part system one test could follow pattern run animation task port message sent since return proxy app way run function port message sent turn make test pas limited something synchronous run queued animation task cant wait subsequent task doesnt feel like sufficiently general solution better test prove add wait function harness object async function either return immediately wait stack complete run remaining task signaling continue happens end every step probably would general solution assuming able call function right time test depends test writer realizing whats happening knowing wait function fix thing add wait function harness object test writer wait action triggered code sending port message program complete seems like general solution add information doc try remind folk function necessary