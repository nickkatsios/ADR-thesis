adr march testnet celestia node author renaynay wondertan changelog initial draft update bridge node definition legend celestia network refers data availability halo network created around core network bridge node bridge node node connected celestiacore node via rpc receives remote address running celestiacore node listens block celestiacore new block celestiacore bridge node performs basic validation block via validatebasic extends block data generates data availability header dah extended block data creates extendedheader block header dah finally broadcast data availability network network bridge node care kind celestiacore node connected validator regular full node care direct rpc connection celestiacore node listen new block name bridge chosen purpose node type provide mechanism relay celestiacore block data availability network full node full node thing light node instead performing lightavailability process dasing verify header legitimate performs fullavailability downloads enough share network order fully reconstruct block store serving share rest network light node light node listens extendedheaders network performs received header adr describes design march celestia testnet decided berlin offsite basic scaffolding structure celestia node focus next engineering sprint continue refactoring improving structure include feature defined later document new feature new node type definition introduce standalone full node rename current full node implementation bridge node remove dev node type make flag every available node type introduce bad encoding fraud proof bad encoding fraud proof generated full node inside shareservice upon reconstructing block via sampling process fraud detected full node generate proof broadcast fraudsub gossip network subsequently halt operation fraud detected full node continue operation without propagating message network since full node reconstruct every block listen fraudsub perform necessary encoding check every block light node however listen fraudsub bad encoding fraud proof light node verify fraud proof relevant header hash ensure fraud proof valid fraud proof valid node immediately halt operation invalid node proceeds operation usual eventually may choose reputation tracking system provided gossipsub node broadcast invalid fraud proof network requirement iteration introduce rpc structure basic apis implement scaffolding rpc node type user access following method headerapi headerheight extendedheader headerhash extendedheader nodeapi ppinfo return blob info broken several subcommands netinfo config return node config nodetype return node type full bridge light rpcinfo rpc port version available apis etc userapi accountbalanceacct return balance given account submittxtxdata submits transaction network note likely method added listed essential one iteration introduce stateservice stateservice responsible fetching state relevant user able submit transaction account balance preparing transaction propagating via txsub bridge node responsible listening txsub relaying transaction core mempool light full node able publish transaction txsub listen celestianodes state interaction detailed subsequent adr data availability sampling headersync currently light full node unable perform data availability sampling syncing begin sampling node synced head chain headersync daser refactored daser able perform sampling past header node syncing possible approach would syncing algorithm daser headersync align header received sync propagated daser sampling via internal pubsub daser maintain checkpoint last sampled header continue sampling last checkpoint new header refactoring headerservice becomes main component around service focused initially started blockservice important component devnet architecture overlooked problem regard sync initially made celestia full node would started together time core node led issue eventually needed connect alreadyrunning core node sync missing component implemented headerexchange core client wrapping another interface previously created blockservice called blockfetcher last minute wouldnt work otherwise leading lastminute solution like hand celestia light full node trusted hash header alreadyrunning chain sync point start listening new header proposed new architecture blockservice responsible reconstructing block share handed shareservice right blockservice charge fetching new block core node erasure coding generating dah generating extendedheader broadcasting extendedheader headersub network storing block data validation check instead full node rely shareservice sampling fetch enough share reconstruct block inside blockservice contrastingly bridge node block reconstruction via sampling rather rely headercoresubscriber implementation headersubscriber block headercoresubscriber handle listening new block event core node via rpc erasure code new block generate extendedheader pipe erasure coded block blockservice via internal subscription headersync optimization implement disconnect toleration unbonding period handling light full node currently prone longrange attack mitigate introduce additional trustperiod variable equal unbonding period applies header suppose node start period subjective head objective head higher unbonding period case light node must trust subjective head anymore specifically validatorset therefore instead syncing subsequent header top untrusted subjective head node request new objective head trustedpeer set new trusted subjective head approach follow tendermint model light client attack detection nice shareservice optimization implement parallelization retrieving share namespace issue already worked nmtsharesnamespace storage optimization right prepend share additional byte luckily reason prepended byte added solution possible get nmt node type indirectly without serializing type looking amount link recover namespace erasured data encode namespaces data possible get namespace share encoded inner nonleaf node nmt tree pruning share move ipld celetianode repo repo since ipld package pretty much entirely separate celestianode implementation make sense removed celestianode repository maintained separately extraction ipld also include review refactoring still legacy component either longer necessary documentation also updating implement additional light node verification logic similar tendermint light client model moment syncing logic light node simple syncs header single peer instead light node doublecheck header another randomly chosen witness peer primary peer received header described light client attack detector model tendermint