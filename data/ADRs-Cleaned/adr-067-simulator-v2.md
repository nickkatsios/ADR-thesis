adr simulator changelog june initial draft alexanderbez draft abstract cosmos sdk simulator tool allows developer test entirety application state machine pseudorandomized operation represent transaction simulator also provides primitive ensures nondeterminism issue application state machine successfully exported imported randomized state simulator played absolutely critical role development testing cosmos hub release cosmos sdk launch cosmos hub since hub simulator relatively changed much overdue revamp current simulator xsimulation act semifuzz testing suite take integer represents seed prng prng generate sequence operation meant reflect transaction application state machine process prng aspect block production consumption randomized includes block proposer validators sign miss block along transaction operation cosmos sdk module defines set simulation operation attempt produce valid transaction xdistributionsimulationoperationsgo operation sometimes fail depending accumulated state application within simulation run simulator continue generate operation reached certain number operation reached fatal state reporting result give ability application developer reliably execute full range application simulation fuzz testing application however major drawback namely advent abci specifically finalizeblock internal working simulator longer comply application would actually perform specifically operation executed finalizeblock whereas executed within finalizeblock additionally simulator extensible developer able easily define extend following consistency validity predicate known invariant today property test state block simulated addition also want achieve following consolidated weight management define weight within simulator via config defined module observability simulator execution easy understand outputlogs ability pipe log external sink smart replay ability rerun simulation seed also ability replay arbitrary breakpoint run simulation based real network state instead refactoring existing simulator xsimulation propose create new package root cosmos sdk simulator new simulation framework simulator accurately reflect complete lifecycle abci application specifically propose similar implementation simulatormanager exists today responsible managing execution simulation manager wrap abci application responsible following populating application mempool set pseudorandom transaction block may contain invalid message selecting transaction random proposer execute prepareproposal executing processproposal finalizeblock commit executing set validity predicate block maintaining cpu ram profile simulation execution allowing simulation stop resume given block height simulation liveness validator perblock application developer perspective provide module simulator manager take care rest addition write simulation test nondeterminism multiseed etc manager provide well type manager struct app sdkapplication mempool sdkmempool rng randrand configuration simulator testing input driven configuration file opposed cli argument allow extensibility ease along ability shared configuration file across multiple simulation execution alluded previously execution block manager generate series pseudorandom transaction attempt insert mempool via baseappchecktx abci lifecycle block mempool seed transaction block proposal would real network allows test state machine also test abci lifecycle block statistic total block total failed proposal collected logged written output full partial execution simulation output destination statistic configurable func simulator simulateblock rproposer sselectrandomproposer rtxs sselecttxs prepareresp err sappprepareproposalabciprepareproposalrequesttxs rtxs handle error processresp err sappprocessproposalabciprocessproposalrequest prepareresptxs handle error execute liveness matrix err sappfinalizeblock handle error err sappcommit handle error note application define appside mempool propose selecttxs mimic cometbft return fifoordered transaction adhoc simulator mempool case application define mempool simply ignore provided requestprepareproposal profiling manager responsible collecting cpu ram profile simulation execution propose pyroscope capture profile export local file via http endpoint disabled enabled configuration breakpoints via configuration caller express heightbased breakpoint allow simulation stop resume given height allow debugging cpu ram state validity predicate propose provide ability application provide simulator set validity predicate invariant checker executed block allow application assert certain state invariant held block note consequence propose remove existing notion invariant module production execution path deprecate usage altogether type manager struct preblockvalidator funcsdkcontext error postblockvalidator funcsdkcontext error consequence backwards compatibility new simulator package naturally backwards compatible existing xsimulation module however module still responsible providing pseudorandom transaction simulator positive providing intuitive cleaner apis application developer closely resembling true lifecycle abci application negative breaking current cosmos sdk module apis transaction generation reference osmosis simulation adr