adr signmodetextual changelog dec initial draft feb draft read conceptacked ledger team may change aug require signing raw byte sep add custom msgrenderers sep structured format instead line text nov specify cbor encoding dec link example separate json file dec reordering envelope screen dec mention exception invertability jan switch screentext titlecontent mar change signdoc array struct containing array mar introduce spec version initialized implementation started small value renderers detail still polished spec version abstract adr specifies signmodetextual new stringbased sign mode targeted signing hardware device protobufbased signmodedirect introduced adr intended replace signmodelegacyaminojson situation mobile wallet cli keyrings however ledger hardware wallet still signmodelegacyaminojson displaying sign byte user hardware wallet cannot transition signmodedirect signmodedirect binarybased thus suitable display endusers technically hardware wallet could simply display sign byte user would considered blind signing security concern hardware cannot decode protobuf sign byte due memory constraint protobuf definition would embedded hardware device effort remove amino sdk new sign mode created hardware device initial discussion propose textbased sign mode adr formally specifies signmodetextual transaction rendered textual representation sent secure device subsystem user review sign unlike signmodedirect transmitted data simply decoded legible text even device limited processing display textual representation sequence screen screen meant displayed entirety possible even small device like ledger screen roughly equivalent short line text large screen displayed several piece much long line text wrapped hard guidance given though character good target screen display single keyvalue pair scalar value composite value compact notation coin introduce conclude larger grouping text contain full range unicode code point including control character nul device responsible deciding display character cannot render natively see annex guidance screen nonnegative indentation level signal composite nested structure indentation level zero top level indentation displayed via devicespecific mechanism message quotation notation appropriate model leading character vertical bar capable display screen marked expert screen meant displayed viewer chooses opt extra detail expert screen meant information rarely useful present signature integrity see invertible rendering require rendering transaction invertible must parsing function every transaction rendered textual representation parsing representation yield proto message equivalent original proto equality note inverse function perform correct parsing error signaling whole domain textual data merely range valid transaction invertible composition rendering parsing note existence inverse function ensures rendered text contains full information original transaction hash subset make exception invertibility data large meaningfully display byte string longer byte may selectively render cryptographicallystrong hash case still computationally infeasible find different transaction rendering however must ensure hash computation simple enough reliably executed independently least hash reasonably verifiable raw byte string chain state rendering function parsing function may depend current chain state useful reading parameter coin display metadata reading userspecific preference language address alias note observed state change signature generation transaction inclusion block deliverytime rendering might differ signature invalid transaction rejected signature security security transaction signature three property given transaction signature chain state must possible validate signature match transaction verify signer must known respective secret key must computationally infeasible find substantially different transaction given signature valid given chain state user able give informed consent signed data via simple secure device limited display capability correctness security signmodetextual guaranteed demonstrating inverse function rendering transaction protos mean impossible different protocol buffer message render text transaction hash malleability client software form transaction raw transaction txraw serialized proto hash resulting byte sequence computed txhash various service track submitted transaction lifecycle various misbehavior possible one generate modified transaction different txhash signature still check signmodetextual prevents transaction malleability including txhash expert screen rendering signdoc signdoc signmodetextual formed data structure like type screen struct title string possibly size limited advised character content string possibly size limited advised character indent uint size limited something small like expert bool type signdoctextual struct screen screen plan protobuf serialization form sequence byte transmitted signed order keep decoder simple cbor rfc instead encoding defined following cddl rfc cddl rfc specification signdoc signmodetextual must encoded cbor deterministic encoding rfc section textual document struct containing one field array screen signdoc screenskey screen key integer keep encoding small screenskey screen consists text string indentation expert flag represented integerkeyed map entry optional must omitted encoding empty zero false text default empty string indent default zero expert default false screen titlekey tstr contentkey tstr indentkey uint expertkey bool key small integer keep encoding small titlekey contentkey indentkey expertkey defining signdoc directly array screen also considered however given possibility future iteration specification singlekeyed struct chosen former proposal structs allow easier backwardscompatibility detail example follow screen shown line text indentation indicated leading expert screen marked leading encoding transaction envelope define transaction envelope data transaction txbodymessages field transaction envelope includes fee signer info memo dont include msg denotes comment shown ledger device chain account number sequence address public key transaction message pluralize message int message see value renderers rendering end message memo skipped memo set fee see value renderers coin rendering fee payer skipped feepayer set fee granter skipped feegranter set tip skippted tip tipper gas limit timeout height skipped timeoutheight set signer signerinfo skipped transaction signer signer end signer extension skipped body extension extension end extension non critical extension skipped body non critical extension non critical extension end non critical extension hash raw byte hex encoding byte defined prevent hash malleability encoding transaction body transaction body txtxbodymessages field array anys pack sdkmsg since sdkmsgs widely slightly different encoding usual array anys protobuf repeated googleprotobufany described annex transaction int message optional message there sdkmsgs msg print following line msg intint string msg bank vbeta send coin value rendering msg struct end transaction message example given following protobuf message protobuf message grant googleprotobufany authorization cosmosprotoacceptsinterface cosmosauthzvbetaauthorization googleprotobuftimestamp expiration gogoprotostdtime true gogoprotonullable false message msggrant cosmosmsgvsigner granter string granter cosmosprotoscalar cosmosaddressstring string grantee cosmosprotoscalar cosmosaddressstring transaction containing sdkmsg get following encoding transaction message msg authz vbeta grant granter cosmosabcdef grantee cosmosghijkl end transaction message custom msg renderers application developer may choose follow default renderer value output msg case implement custom msg renderer similar eip smart contract developer chooses description string shown end user done setting cosmosmsgtextualvexpertcustomrenderer protobuf nonempty string set protobuf message representing transaction message object implementing sdkmsg interface protobuf message msgfoobar optional comment describe humanreadable language formatting rule custom renderer cosmosmsgtextualvexpertcustomrenderer proto field set msg registered function transform msg array one string may keyvalue format described point expert field prefix described point arbitrary indentation point string may rendered msg field default value renderer may generated several field custom logic unique algorithm identifier string convention chosen application developer identify custom msg renderer example documentation specification custom algorithm reference identifier identifier versioned suffix adapt future change would consensusbreaking also recommend adding protobuf comment describe human language custom logic moreover renderer must provide function one formatting protobuf string one parsing string protobuf function provided application developer satisfy point parse function must inverse formatting function property checked sdk runtime however strongly recommend application developer include comprehensive suite app repo test invertibility introduce security bug require signing txbody authinfo raw byte recall transaction byte merklelized chain protobuf binary serialization txraw contains bodybytes authinfobytes moreover transaction hash defined sha hash txraw byte require user sign byte signmodetextual specifically following string hash raw byte hexshalenbodybytes bodybytes lenauthinfobytes authinfobytes denotes concatenation hex hexadecimal representation byte capital letter prefix len encoded bigendian uint prevent transaction hash malleability point invertiblity assures transaction body authinfo value malleable transaction hash still might malleable point signmodetextual string dont follow byte ordering defined bodybytes authinfobytes without hash malicious validator exchange could intercept transaction modify transaction hash user signed signmodetextual tweaking byte ordering inside bodybytes authinfobytes submit tendermint including hash signmodetextual signing payload keep level guarantee signmodedirect byte shown expert mode hence leading update current specification current specification set stone future iteration expected distinguish two category update specification update require change hardware device embedded application update modify envelope value renderers update category include change screen struct corresponding cbor encoding type update require modification hardware signer application able decode parse new type backwardscompatibility must also guaranteed new hardware application work existing version sdk update require coordination multiple party sdk developer hardware application developer currently zondax clientside developer cosmjs furthermore new submission hardware device application may necessary depending vendor take time recommend avoid type update much possible update category include change value renderers transaction envelope example ordering field envelope swapped timestamp formatting modified since signmodetextual sends screen hardware device type change hardware wallet application update however statemachinebreaking must documented require coordination sdk developer clientside developer cosmjs update released side close time define spec version integer must incremented update either category spec version exposed sdks implementation communicated client example sdk might spec version sdk might thanks versioning client know craft signmodetextual transaction based target sdk version current spec version defined section top document initialized allow flexibility choosing define future version would allow adding field either signdoc struct protobuf backwardscompatible way additional formatting hardware device see annex example minimal msgsend see transaction transaction bit everything see transaction example stored json file following field proto representation transaction protojson screen transaction rendered signmodetextual screen cbor sign byte transaction cbor encoding screen consequence backwards compatibility signmodetextual purely additive doesnt break backwards compatibility sign mode positive humanfriendly way signing hardware device signmodetextual shipped signmodelegacyaminojson deprecated removed longer term ecosystem totally migrated amino totally removed negative field still encoded nonhumanreadable way public key hexadecimal new ledger app released still unclear neutral transaction complex string array arbitrarily long user might skip screen blind sign discussion detail value renderers polished see annex ledger apps able support signmodelegacyaminojson signmodetextual time open question add protobuf field allow app developer overwrite textual representation certain protobuf field message would similar ethereums eip contract developer decides textual representation internationalization reference annex initial discussion httpsgithubcomcosmoscosmossdkissues living document working group httpshackmdiofszaotftckmldtfmckeaboth working group meeting note httpshackmdiorkgfvrqaazzeiguyhcxw ethereums described transaction httpsgithubcomethereumeipspull