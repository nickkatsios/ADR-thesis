previous next pyhorace matlab code mex interface call python function dec proposed pyhorace prototype proposed python module pace package matlab horaceherbert code compiled library matlab code within library interact python code host specifically fitting model evaluation horace able call user defined model function compiled matlab library allow user mfile user model function would written python ccfortran subject separate adr however implementation compiled matlab library compiled matlab function cannot call python function directly standard api standard api matlab call python assumes matlab spawn python interpreter pyhorace would clash userlaunched parent python intepreter cause crash design document outlined two main method compiled matlab code call python function mex file reverse communication interface rci mex method reference python function given mex file cpython api call function python automatically convert copy result matlab array format rci approach compiled matlab program never explicitly call python function instead whenever matlab code call python function user instead call python wrapper exchange data matlab explained detail rci section wrapper general purpose approach requires code specific instance want employ multifit may prove restrictive integrating brille despite rci approach documented matlabpython api make stable robust hand mex allows current matlab code without modification flexible mex file unhandled exception mex file lead hard crash addition mex function cannot nonmatlab nonarray type data input output thus data must converted matlab format python vice versa involves least one data copy restriction mean python function supported method return nonconvertible type python class except special workarounds case brille also mean reference python function cannot passed directly mex function rather python code store global dictionary string key passed mex taken mex method compiled matlab code call python function rci approach would require extensive change multifit spinw matlab code handle pyhorace case futhermore change would incompatible matlab interface would result two different version multifit mfclass spinw spinw class hand mex approach current matlab code asis pyhorace consequence user model function written python includes euphonic brille cannot return nonconvertible data scalar value standard container list tuples dicts numpy array returned python object cannot instead arbitrary python object may handled global dictionary similarly function reference handled current minimum viable implementation handle spinwbrille interface brille python object passed matlab spinw method would improved general usage reverse communication interface taking example multifit define python wrapper concreteness call multifitpy instead calling matlab multifit code directly user call multifitpy give python function reference multifitpy call modified version multifit performs initialisation problem return multifitpy initial parameter evaluate user model multifitpy call user model function python parameter call multifit result multifit calculates residual jacobian determines next parameter whereupon return multifitpy new parameter multifitpy evaluates call multifit result etc thus python code always call matlab code data exchanged bidirectionally satisfies standard pythonmatlab interface however also mean python wrapper change matlab code needed method work change matlab code may quite extensive especially two specific case matlab call python multifit spinwbrille interface