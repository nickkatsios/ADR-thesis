primitive array constraint implementation proposed deciders sean carroll technical story implementing constraint array support object well primitive type problem statement first pas building array constraint generic parameter javalangreflectarray obtain length property representing curious cost javalangreflectarray compared grabbing length property known type anything name like reflect give nightmare terrible performance decided write jmh benchmark determine performance impact javalangreflectarray assist determining implementation driver want keep performance mind attempt performant possible across constraint avoid adding additional class limit duplicating logic across constraint possible considered benchmark code initially jdk showed fairly large impact found stack overflow post see link suggesting performance issue resolved jdk upgraded however still seeing roughly performance penalty java package jfluentvalidationconstraintsarraylength import jfluentvalidationcommoniterables import jfluentvalidationconstraintsconstraint import jfluentvalidationvalidatorsrulecontext import javalangreflectarray import javautilfunctionintsupplier public class arrayexactlengthconstraint implement constraint private intsupplier lengthsupplier public arrayexactlengthconstraintiterable iterablessizeother public arrayexactlengthconstraintobject arraygetlengthother public arrayexactlengthconstraintint length length public arrayexactlengthconstraintintsupplier lengthsupplier thislengthsupplier lengthsupplier override public boolean isvalidrulecontextt int len arraygetlengthcontextgetpropertyvalue return len lengthsuppliergetasint java package jfluentvalidationconstraintsarraylength import jfluentvalidationcommonarrays import jfluentvalidationcommoniterables import jfluentvalidationconstraintsconstraint import jfluentvalidationinternalensure import jfluentvalidationvalidatorsrulecontext import javalangreflectarray import javautilfunctionintsupplier public class booleanarrayexactlengthconstraintalternative implement constraint private final intsupplier lengthsupplier public booleanarrayexactlengthconstraintalternativeiterable ensurenotnullother thislengthsupplier iterablessizeother public booleanarrayexactlengthconstraintalternativeobject ensureargumentarraysisarrayother thislengthsupplier arraygetlengthother public booleanarrayexactlengthconstraintalternativeint length thislengthsupplier length override public boolean isvalidrulecontextt boolean int len contextgetpropertyvaluelength return arraylengthexactlen lengthsuppliergetasint outcome decided choose prioritized performance overhead maintain additional class duplicate logic might premature optimization small impact benchmark result still convinced sure someone convince overhead insignificant simply messed bencharmark point easier refactor ive included rough implementation case java package jfluentvalidationconstraintsarray import jfluentvalidationconstraintsarraylengtharrayexactlengthconstraint import jfluentvalidationconstraintsarraylengthbooleanarrayexactlengthconstraint import jfluentvalidationconstraintsarraylengthbooleanarrayexactlengthconstraintalternative import jfluentvalidationrulespropertyrule import jfluentvalidationvalidatorsrulecontext import jfluentvalidationvalidatorsvalidationcontext import orgopenjdkjmhannotations import orgopenjdkjmhrunnerrunner import orgopenjdkjmhrunneroptionsoptionsbuilder import javautilconcurrenttimeunit benchmarkmodemodeaveragetime outputtimeunittimeunitnanoseconds statescopebenchmark public class lengthbenchmark public static class foo private boolean bar public fooboolean bar thisbar bar rulecontextfoo boolean rulecontext booleanarrayexactlengthconstraintalternative booleanarrayexactlengthconstraintalternative arrayexactlengthconstraint arrayexactlengthconstraint booleanarrayexactlengthconstraint booleanarrayexactlengthconstraint setup public void prepare foo new foonew boolean propertyrule propertyrule new propertyrulefoo fbar bar rulecontext new rulecontextnew validationcontextf propertyrule booleanarrayexactlengthconstraintalternative new booleanarrayexactlengthconstraintalternative arrayexactlengthconstraint new arrayexactlengthconstraint benchmark public void booleanarrayexactlengthconstraintalternative booleanarrayexactlengthconstraintalternativeisvalidrulecontext benchmark public void arrayexactlengthconstraint arrayexactlengthconstraintisvalidrulecontext public static void mainstring args throw exception new runnernew optionsbuilder includelengthbenchmarkclassgetsimplename fork warmupiterations measurementiterations build run run benchmark mode cnt score error unit lengthbenchmarkarrayexactlengthconstraint avgt nsop lengthbenchmarkbooleanarrayexactlengthconstraintalternative avgt nsop object cast performance impact roughly run benchmark mode cnt score error unit lengthbenchmarkarrayexactlengthconstraint avgt nsop lengthbenchmarkbooleanarrayexactlengthconstraintalternative avgt nsop object cast performance impact roughly run benchmark mode cnt score error unit lengthbenchmarkarrayexactlengthconstraint thrpt opsns lengthbenchmarkbooleanarrayexactlengthconstraintalternative thrpt opsns lengthbenchmarkarrayexactlengthconstraint avgt nsop lengthbenchmarkbooleanarrayexactlengthconstraintalternative avgt nsop lengthbenchmarkarrayexactlengthconstraint nsop lengthbenchmarkbooleanarrayexactlengthconstraintalternative nsop performance impact throughput even larger average time bit much ignore positive consequence gain roughly performance instead average time throughput negative consequence class primitive type object type constraint class type compared constraint class exactlength betweenlength minimumlength maximumlength implement array length constraint primitive array duplicate logic constraint class across type pro con pro total file greatly reduced pro easier maintain con performant pro greater throughput average time con large increase number file con duplicate logic across constraint file link httpsstackoverflowcomquestionsperformanceofjavalangreflectarray httpsbugsopenjdkjavanetbrowsejdk note implementation java package jfluentvalidationconstraintsarraylength import jfluentvalidationcommoniterables import jfluentvalidationconstraintsconstraint import jfluentvalidationvalidatorsrulecontext import javalangreflectarray import javautilfunctionintsupplier public class arrayexactlengthconstraint implement constraint private intsupplier lengthsupplier private integer length public arrayexactlengthconstraintiterable iterablessizeother public arrayexactlengthconstraintobject arraygetlengthother public arrayexactlengthconstraintint length length public arrayexactlengthconstraintintsupplier lengthsupplier thislengthsupplier lengthsupplier public arrayexactlengthconstraintinteger length thislength length override public boolean isvalidrulecontextt int len arraygetlengthcontextgetpropertyvalue return len length null length lengthsuppliergetasint java package jfluentvalidationconstraintsarraylength import jfluentvalidationconstraintsconstraint import jfluentvalidationvalidatorsrulecontext import javalangreflectarray import javautilfunctionintsupplier public class arraylengthconstraint implement constraint private intsupplier minsupplier private intsupplier maxsupplier public arraylengthconstraintintsupplier minsupplier intsupplier maxsupplier thisminsupplier minsupplier thismaxsupplier maxsupplier public arraylengthconstraintint min int max thisminsupplier min thismaxsupplier max override public boolean isvalidrulecontextt int len arraygetlengthcontextgetpropertyvalue int min minsuppliergetasint int max maxsuppliergetasint len min len max max return false return true java package jfluentvalidationconstraintsarraylength public class arraymaximumlengthconstraint extends arraylengthconstraint public arraymaximumlengthconstraintint max super max java package jfluentvalidationconstraintsarraylength public class arrayminimumlengthconstraint extends arraylengthconstraint public arrayminimumlengthconstraintint min supermin