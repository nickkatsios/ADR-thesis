certificate store metadata value author tbeets implemented tag server security problem statement user source nats server identity credential store rather file may either client mtls server identity case driven either insitu credential store andor organizational policy disallows deploying secret operating system file edge computing scenario involving large fleet managed server may especially require credential store integration credential store may offered supported operating system service microsoft software key storage provider rdparty trusted platform module tpm provider credential store provider may implement standardsbased interface pkcs cryptographic token interface nats server requires configuration interface operator specify specific credential store provider configuration block map providerspecific identity parameter design following configuration property added map property map property description default example value certstore supported credential store provider see enabled provider windowscurrentuser certmatchby providerspecific identity searchlookup subject subject certmatch identity searchlookup term examplecom certstore configuration property given map logically take place certfile keyfile property operator specifies certstore certfile property map server error startup message certfile certstore may configured given map certstore configured keyfile property present ignored note provider name caseinsensitive certstore provider unknown nats server specific operating system build configured server error startup message cert store type implemented enabled cert store provider provider name description operating system windowscurrentuser microsoft software key storage provider local personal store current user window windowslocalmachine microsoft software key storage provider local personal store local machine window window provider microsoft software key storage provider ksp accessed nats server startup ondemand tlsnegotiation signature required two provider differ operating system access permission scope required specific store credential certificate related private key sourced provider windowscurrentuser store associated operating system user nats server process windowslocalmachine store associated local machine nats server process user must necessary window entitlement access local machine certificate store note store window appears personalcertificates microsoft management console certificate snapin windowsbuild nats server enhanced directly leverage window security identity library function apis library ncryptdll cryptdll invoked find retrieve public certificate startup perform signature negotiation inclusion intermediate certificate leaf certificate matched see example configuration nats server attempt source valid trust chain certificate local window machine trust store valid chain leaf trusted selfsigned certificate store typically root least one valid chain found first valid chain selected nats server form final certificate matched leaf certificate plus nonself signed intermediate certificate may present valid chain valid trust chain found local window machine trust store nats server form final certificate matched leaf certificate intermediate chained cert included validation policy note crl ocsp explicit role validation server client policy feature specifically avoided certificate match intermediate population window ksp ultimately provided eventual trust validator negotiation iethis provider implement identity lookup identity signature trustpolicy validator identity claim identity lookup certmatchby may one following subject ksp compare certmatch property value certificate subject rdn value return first match see also certfindsubjectstr issuer ksp compare certmatch property value certificate issuer rdn value return first match see also certfindissuerstr configured certmatchby match available provider server error message cert match type implemented example configuration given certificate provisioned store following issuer subject distinguished name text certificate data version serial number cbcaaefcbdc signature algorithm shawithrsaencryption issuer synadia communication inc natsio localhost validity feb gmt feb gmt subject natsio examplecom subject public key info map server configuration format text certstore windowscurrentuserwindowslocalmachine certmatchby subjectissuer certmatch lookup value certmatchby certmatch result subject examplecom success found subject natsio success found subject natsio examplecom fail found subject examplecom fail found issuer localhost success found issuer synadia communication inc success found issuer synadia communication inc natsio localhost fail found issuer localhost fail found note avoid negotiation failure caused return wrong certificate recommended lookup subject value representing unique name nats server certificate identity value examplecom case future certificate store interface new map configuration entry intended extensible future provider interface nats server may implement