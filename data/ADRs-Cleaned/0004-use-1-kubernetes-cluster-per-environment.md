kubernetes cluster per environment scope web sre team multiple environment sometimes called tier web sre service environment generally serve different purpose audience different uptime requirement environment optionally serve required point path towards production environment mozilla service environment generally include development dev staging stage production prod sometimes also testing environment usually ephemeral generally environment infrastructure provider account differ infrastructure application platform level kubernetes level exception testing tends ephemeral within particular dockercompose spin kind cluster pipeline multiple way differentiate persistent dev stage prod environment infrastructure application platform within kubernetes common pattern separating persistent environment distinct kubernetes cluster per environment one namespace per environment shared kubernetes cluster distinct node pool per environment within single cluster along selector taint toleration web sre service environment dev stage prod kubernetesbased distinct kubernetes cluster per environment dev stage prod within infrastructure account caveat environment required see distinct kubernetes namespace within cluster per application deploy application distinct cluster relevant expected application environment stage application deploy stage cluster prod application deploy prod cluster etc deploy operationals infrastructure change upgrade distinct cluster specifically moving change dev present stage prod reverting stage match prod within appropriate timeframe end goal keeping stage prod cluster close alignment development cluster availability uptime expectation application infrastructure include support outside business hour stage prod cluster availability uptime expectation application infrastructure require support outside business hour however specific project negotiated sres project stakeholder development cluster optionally include automatic infrastructure platform update first place review change effect goal promoting update stage prod feasible reviewed approved stable infrastructure release stage cluster deploy infrastructure change able relatively quickly move change stage prod avoid divergent result staging production application reviewed approved productionready stable application infrastructure release production cluster understand purpose stage cluster validate infrastructure application code headed production expect deployment stage cluster step release deployment pipeline application infrastructure moving production adr include following application within cluster name namespaces applicationspecific kubernetes resource keeping discourseprod namespace production cluster redundent also explicit left sres working service immediate push migrate existing service pattern cause lot churn instead going forward migration starting new service explicit declaration slos slas environment beyond development cluster roundtheclock support expectation multitenant cluster versus singletenant cluster pattern environment apply either case expectation development cluster exists left service sres determination approach nonperistent cluster local development pipeline environment implement cluster per environment left sres implementation consequence pro pattern support meaningful separate staging environment especially infrastructure change testing impact application trickier case dev staging prod application live production cluster clearer boundary environment within infrastructure con work bring current service alignment including fair amount migration infrastructure update hence adr considered pattern involve creating new service performing migration admin developer user kubernetes cluster hop cluster compare environment state log etc mitigated somewhat kubernetes command line tooling though resource itseappsprod cluster implementation httpsgithubcommozillaititseappsprodinfra itseappsstage cluster implementation httpsgithubcommozillaititseappsstageinfra good short synapsis kubernetes tier separation approach found production kubernetes rosso lander brand harris httpswwworeillycomlibraryviewproductionkubernetes