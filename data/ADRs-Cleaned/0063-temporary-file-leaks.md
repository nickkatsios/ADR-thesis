prevent temporary file leak lazy consensus implemented order reduce memory allocation apache james buffer big email temporary file smtp email processing mean james entity relying mail object resource management place prevent temporary file leak result unreasonable disk occupation file descriptor leak core component found badly manage resource mailets bounce mail queue apis mail repository apis found causing temporary file leak james allows user define custom mailets badly manage email insider tend commit error expect user commit point toward systematic approach detect mitigate temporary file leak similar leak detection performed library one mention netty buffer library relies phantom reference detect leak phantom reference allows java garbage collector report recently gced object upon phantom reference allocation check done check recently gced object release related resource implement leak detector netty phantom reference allow several mode nothing james behaviour simple log leak deletes associated file advanced simple allocation stack trace come performance cost useful diagnostic testing assertion error upon leak streangthen test suite detect leak part build consequence make james core component leak proofed allows user safely write extension involving email duplication sending performance impact turning simple leak detection default behaviour expected significant similar functionality implemented simpler way relying java finalize method called upon garbage collection yet move done many operational problem come finalize longer pause finalise run significantly slower finalize method exists finalizing stage object still live ease promotion old generation result called kill world follow work mail management james test suite poor lead many false positive prevents leveraging leak detector benefit part test suite significant work would needed reference jira james leak detection netty phantom reference