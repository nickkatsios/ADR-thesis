adr container hook background job hook given user ability customize self hosted runner run job user also want ability customize run container scope job rather locked docker implementation runner may want podman kubernetes even change docker command run give publish example create hook guiding principle extensibility focus make sure flexible enough cover current future scenario even cost making harder utilize hook args map directly yaml value provided user example current runner override home hook shouldnt pas hook env envs user set user input runner invokes container interface set variable actionsrunnercontainerhooksusersfoorunnerhooksjs entrypoint hook handler partial opt must handle every hook pas command args via stdin exit code success every exit code failure support runner command support job hook timeout send sigint process fail terminate within reasonable amount time send sigkill eventually kill process tree example input look like json command jobcleanup responsefile usersthbooprunnerworkguidjson args state efeadcfdafdbdbddfbac command command expect invoke responsefile file write output command output args specific argument command state json blog pas around maintain state covered detail writing response file text written stdout stderr appear job step log mind support way actually return data wrapping json unique tag processing like command writing file user typically view logging information safe action worry someone accidentialy logging unsantized information causing unexpected unsecure behavior eventually plan move stdoutstderr style command favor runner cli investing area doesnt make lot sense time writing file communicate isnt ideal pattern existing pattern runner serf well let reuse output output must correctly formatted json example output look like state container efeadcfdafdbdbddfbac network githubnetworkbdbfbc service redis daaebdadabbdcdfeeedbabb port network githubnetworkbdbfbc alpine true state unique field command return empty store state pas future command overwrite next hook invoked return unique state field dependent upon command run versioning version hook launch needed always major version split hook future ship beta allow breaking change month job job currently variety field correspond container consider allowing hook populate new field job scope original release however hook hook implemented high level map action runner rather specific docker action like docker build docker create mapping runner action create extensible framework flexible enough solve user concern future providing first party implementation give user easy starting point customize specific hook like docker build without write full blown solution would provide hook mirror every docker call make expose hook help support user expectation user may noop multiple hook dont correspond case dont want way feel clunky user understand hook implement ignore isnt great doesnt scale well dont want build solution may add hook mapping runner action updating hook painful experience user overwhelming easier tell user build hook track data rather hook runner certain information provide information back hook expose container create return container created container run container give image say create run container dont store container runner map better scenario dont really container preparejob hook preparejob hook called job started pas job service container job expect prune anything previous job needed create network needed pull job service container start job container start service container write response file information required container alpine otherwise optional field want set job otherwise unavailable user return health check succeeded jobservice container started hook always called container hook enabled even service job container exist job allows fail job implement default job container want job container provided example input command preparejob responsefile usersthbooprunnerworkguidjson state args jobcontainer image node workingdirectory wthbooptestthbooptest createoptions cpu environmentvariables nodeenv development usermountvolumes sourcevolumepath mydockervolume targetvolumepath volumemount readonly false mountvolumes sourcevolumepath homethomasgitrunnerlayoutwork targetvolumepath readonly false sourcevolumepath homethomasgitrunnerlayoutexternals targetvolumepath readonly true sourcevolumepath homethomasgitrunnerlayoutworktemp targetvolumepath wtemp readonly false sourcevolumepath homethomasgitrunnerlayoutworkactions targetvolumepath wactions readonly false sourcevolumepath homethomasgitrunnerlayoutworktool targetvolumepath wtool readonly false sourcevolumepath homethomasgitrunnerlayoutworktempgithubhome targetvolumepath githubhome readonly false sourcevolumepath homethomasgitrunnerlayoutworktempgithubworkflow targetvolumepath githubworkflow readonly false registry username foo password bar serverurl httpsindexdockeriov portmappings tcp udp service contextname redis image redis createoptions cpu environmentvariables mountvolumes portmappings tcp udp registry username foo password bar serverurl httpsindexdockeriov field description arg field jobcontainer optional object containing information specified job container image required string containing docker image workingdirectory required string containing absolute path working directory createoptions optional optional create specified yaml environmentvariables optional map key value envs set usermountvolumes optional array user mount volume set yaml sourcevolumepath required source path volume mounted docker container targetvolumepath required target path volume mounted docker container readonly false required whether mount read mountvolumes required array mount mount container field sourcevolumepath required source path volume mounted docker container targetvolumepath required target path volume mounted docker container readonly false required whether mount read registry optional docker registry credential private container registry username optional username password optional password serverurl optional registry url portmappings optional array sourcetarget port map container service array service container spin contextname required name service job image required string containing docker image createoptions optional optional create specified yaml environmentvariables optional map key value envs set mountvolumes required array mount mount container field sourcevolumepath required source path volume mounted docker container targetvolumepath required target path volume mounted docker container readonly false required whether mount read registry optional docker registry credential private container registry username optional username password optional password serverurl optional registry url portmappings optional array sourcetarget port map container example output state network githubnetworkbdbfbc jobcontainer efeadcfdafdbdbddfbac servicecontainers redis daaebdadabbdcdfeeedbabb container efeadcfdafdbdbddfbac network githubnetworkbdbfbc service redis daaebdadabbdcdfeeedbabb port network githubnetworkbdbfbc alpine true cleanup job cleanupjob hook called end job expects stop running service job container equiavalent pod stop network one exists delete job service container equiavalent pod delete network one exists cleanup anything else created run input look like example input command cleanupjob responsefile null state network githubnetworkbdbfbc jobcontainer efeadcfdafdbdbddfbac servicecontainers redis daaebdadabbdcdfeeedbabb args args provided output expected run container step runcontainerstep called per container action job expects pull build required container fail cannot run container action return exit code container stream step log output stdout stderr cleanup container executes example input image command runcontainerstep responsefile null state network githubnetworkbdbfbc jobcontainer efeadcfdafdbdbddfbac servicecontainers redis daaebdadabbdcdfeeedbabb args image node dockerfile null entrypointargs devnull entrypoint tail workingdirectory wthbooptestthbooptest createoptions cpu environmentvariables nodeenv development prependpathfoobar barfoo usermountvolumes sourcevolumepath mydockervolume targetvolumepath volumemount readonly false mountvolumes sourcevolumepath homethomasgitrunnerlayoutwork targetvolumepath readonly false sourcevolumepath homethomasgitrunnerlayoutexternals targetvolumepath readonly true sourcevolumepath homethomasgitrunnerlayoutworktemp targetvolumepath wtemp readonly false sourcevolumepath homethomasgitrunnerlayoutworkactions targetvolumepath wactions readonly false sourcevolumepath homethomasgitrunnerlayoutworktool targetvolumepath wtool readonly false sourcevolumepath homethomasgitrunnerlayoutworktempgithubhome targetvolumepath githubhome readonly false sourcevolumepath homethomasgitrunnerlayoutworktempgithubworkflow targetvolumepath githubworkflow readonly false registry null portmappings example input dockerfile command runcontainerstep responsefile null state network githubnetworkbdbfbc jobcontainer efeadcfdafdbdbddfbac service redis daaebdadabbdcdfeeedbabb args image null dockerfile wactionsfoodockerfile entrypointargs hello world entrypoint echo workingdirectory wthbooptestthbooptest createoptions cpu environmentvariables nodeenv development prependpathfoobar barfoo usermountvolumes sourcevolumepath mydockervolume targetvolumepath volumemount readonly false mountvolumes sourcevolumepath mydockervolume targetvolumepath volumemount readonly false sourcevolumepath homethomasgitrunnerlayoutwork targetvolumepath readonly false sourcevolumepath homethomasgitrunnerlayoutexternals targetvolumepath readonly true sourcevolumepath homethomasgitrunnerlayoutworktemp targetvolumepath wtemp readonly false sourcevolumepath homethomasgitrunnerlayoutworkactions targetvolumepath wactions readonly false sourcevolumepath homethomasgitrunnerlayoutworktool targetvolumepath wtool readonly false sourcevolumepath homethomasgitrunnerlayoutworktempgithubhome targetvolumepath githubhome readonly false sourcevolumepath homethomasgitrunnerlayoutworktempgithubworkflow targetvolumepath githubworkflow readonly false registry null portmappings tcp udp field description arg field image optional string containing docker image otherwise dockerfile must provided dockerfile optional string containing path dockerfile otherwise image must provided entrypointargs optional list containing entry point args entrypoint optional container entry point default image entrypoint overwritten workingdirectory required string containing absolute path working directory createoptions optional optional create specified yaml environmentvariables optional map key value envs set prependpath optional array additional path prepend path variable usermountvolumes optional array user mount volume set yaml sourcevolumepath required source path volume mounted docker container targetvolumepath required target path volume mounted docker container readonly false required whether mount read mountvolumes required array mount mount container field sourcevolumepath required source path volume mounted docker container targetvolumepath required target path volume mounted docker container readonly false required whether mount read registry optional docker registry credential private container registry username optional username password optional password serverurl optional registry url portmappings optional array sourcetarget port map container output expected currently build container action start job hook move time building hook could expose hook buildpull container action called start job would require hook author track build container state could painful run script step runscriptstep expects invoke provided script inside job container return exit code stream step log output stdout stderr example input command runscriptstep responsefile null state network githubnetworkbdbfbc jobcontainer efeadcfdafdbdbddfbac servicecontainers redis daaebdadabbdcdfeeedbabb args entrypointargs runnertempabcsh entrypoint bash environmentvariables nodeenv development prependpath foobar barfoo workingdirectory wthbooptestthbooptest field description arg field entrypointargs optional list containing entry point args entrypoint optional container entry point default image entrypoint overwritten prependpath optional array additional path prepend path variable workingdirectory required string containing absolute path working directory environmentvariables optional map key value envs set output expected limitation support linux launch hook set runner admin thus supported self hosted runner consequence support non docker scenario self hosted runner allow customer customize docker invocation shipmaintain doc docker hook open source repo example support hook add enough telemetry able troubleshoot support issue come