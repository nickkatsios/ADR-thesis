jetstream publish retries responder metadata value author wallyqs partially implemented tag jetstream client motivation nats server running jetstream cluster mode occasional blip leadership result number responder available error election order try mitigate failure retries added jetstream enabled client attempt publish message jetstream ready implementation responder available error header signal client one available serve published request synchronous publish request jetstream internally request produce message jetstream service ready moment publishing server send requestor message right away improve robustness producing message jetstream client back bit try send message later default client wait retry time sending message total would attempted send message time found example implementation request api client stream persists message sent foo jsaddstreamnatsstreamconfigname foo var retrywait timemillisecond maxattempts loop publish message every range timenewticker timemillisecondc subject foo msg fmtsprintfid err ncrequestsubject bytemsg timesecond err nil err natserrnoresponders attempt attempt maxattempts attempt backoff retrying timesleepretrywait next attempt err ncrequestsubject bytemsg timesecond err nil err natserrnoresponders retry continue error exhausting number attempt result either timeout error case deadline expired nats response stream error error last attempt still responder error example customizing retries retrywait retryattempts two added customize retry logic default err jspublishfoo bytebar natsretrywaittimemillisecond natsretryattempts err nil logprintlnpub error err make publish retry needed deadline possible set maximum deadline retries client retry needed example client attempt publish second wait ack response server backing needed service available package ctx cancel contextwithtimeoutcontextbackground timesecond defer cancel err jspublishfoo bytebar natscontextctx natsretrywaittimemillisecond natsretryattempts err nil logprintlnpub error err custom ackwait err jspublishfoo bytebar natsackwaittimesecond natsretrywaittimemillisecond natsretryattempts err nil logprintlnpub error err