testing framework enhancement first attempt testing notification surfaced concern patient selection mechanism selected patient across multiple treatment group patient excluded incorrectly due past experiment inconsistency notification dispatched resulted patient receiving subset message cascade issue appointment recorded mobile app affect visit counted inconsistency make reporting complicated reduce quality experiment data issue impact validity experiment addressed rerun first experiment run subsequent experiment relevant document relevant prd experiment flow patient selection aka enrollment enforce treatment group membership constraint patient multiple treatment group membership active experiment patient multiple scheduled appointment included experiment experiment including completed one start end accidentally excluded large number patient experiment enforcing constraint select patient close expected visit selecting patient far advance increase likelihood patient state changing expected visit patient eviction patient may evicted experiment experiment progress evicting patient experiment mean sent pending message excluded result evict patient new appointment created original appointment updated without corresponding visit blood sugar prescription drug recorded avoid tracking new expected visit moving notification correct introduce noise result nurse update patient appointment app change scheduled case patient expected return becomes unclear appointment enrolled experiment longer relevant also happen accidental appointment different scheduled created failed send notification could happen invalid number due network failure tracking visit start monitoring return visit patient enrollment experiment treatment group end monitoring return visit patient day appointment scheduled infer visit creation appointment rely blood pressure blood sugar prescription drug note experimentation make change existing dashboardsreports infer visit appointment rationale portion appointment record created due bug problematic flow make impossible distinguish real visit accidentally created appointment consequence excluding appointment creation criterion mean experiment patient total visit lower number report dashboard affect validity result since reduction distributed uniformly across treatment group since may lead undercounting visit report relative improvement return rate rather absolute percentage example cascade group patient return rate control group patient return rate look difference absolute percentage reporting store result experiment denormalized format close final reporting reporting schema tied treatment group membership populate everyday scanning previous day activity new metric want track added table database table track membership experiment related activity membership although might appeal separate notion membership reporting currently see separate table table domain model simplifies design significantly additionally membershipreport table would essentially superset membership table reporting joining two large data table performant divergence reporting various experiment revisit experiment timeline currently capture experiment timeline storing state field state upcoming running completed cadence experiment though arent captured well attribute alone example notification sent day enrollment end patient monitored till day enrollment end cadence put timeline look like additionally state attribute tracked every day modified state change starttime endtime buffer already information required compute cadence remove state field introduce method work starttime endtime compute cadence object design separation concern experiment flow procedurally describes step involved running experiment currently responsibility shared experimentationexperiment experimentationrunner refactor following class class responsibility experimentationexperiment setup experiment assign treatment group integrally experimentationtreatmentgroup describes treatment group behaviour patient experimentationtreatmentgroupmembership store patient membership treatment group collect related data experimentationremindertemplate specifies message sent treatment group experimentationnotificationsexperiment specifies default eligibility criterion conduct notification experiment experimentationcurrentpatientexperiment specifies eligibility criterion selection conduct current patient experiment experimentationstalepatientexperiment specifies eligibility criterion selection conduct stale patient experiment faq split experiment notificationsexperiment experiment significant responsibility maintaining integrity across experiment providing api timeline notificationsexperiment handle notification related aspect experiment including day day operation create subclass individual experiment individual experiment subclassed notificationsexperiment since enough shared behaviour different selection notifying behaviour consequence experiment hierarchy reporting schema assumes ever run notification experiment kind experiment future rethink design reporting schema assumes experiment reporting differ might augment modify schema required reporting entirely different might separate membership table reporting table membership monitoring buffer currently hard coded common experiment updating code apply buffer existing experiment well might consequence integrity experiment might want store experiment model become pressing concern constraint buffer nextmembership monitoring lastnotification enforced updating code might consequence integrity current experiment