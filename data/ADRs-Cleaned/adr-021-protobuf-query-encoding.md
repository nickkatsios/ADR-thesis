adr protocol buffer query encoding changelog march initial draft adr continuation motivation design established adr adr namely aim design protocol buffer migration path clientside cosmos sdk adr continues add specify encoding query custom query definition module define custom query protocol buffer service definition service definition generally associated grpc protocol however protocol buffer specification indicates generically requestresponse protocol protocol buffer encoding thus service definition specifying custom abci query even reuse substantial amount grpc infrastructure module custom query define service canonically named query protobuf xbanktypestypesproto service query rpc querybalancequerybalanceparams return cosmossdkvcoin rpc queryallbalancesqueryallbalancesparams return queryallbalancesresponse handling interface type module interface type true polymorphism generally force oneof applevel provides set concrete implementation interface app support apps welcome query implement applevel query service recommended module provide query method expose interface via googleprotobufany concern transaction level overhead high justify usage however query concern providing generic modulelevel query preclude apps also providing applevel query return applevel oneofs hypothetical example gov module would look something like protobuf xgovtypestypesproto import googleprotobufanyproto service query rpc getproposalgetproposalparams return anyproposal message anyproposal proposalbase base googleprotobufany content custom query implementation order implement query service reuse existing gogo protobuf grpc plugin service named query generates interface named queryserver type queryserver interface querybalancecontextcontext querybalanceparams typescoin error queryallbalancescontextcontext queryallbalancesparams queryallbalancesresponse error custom query module implemented implementing interface first parameter generated interface generic contextcontext whereas querier method generally instance sdkcontext read store since arbitrary value attached contextcontext withvalue value method cosmos sdk provide function sdkunwrapsdkcontext retrieve sdkcontext provided contextcontext example implementation querybalance bank module would look something like type querier struct keeper func querier querybalancectx contextcontext params typesquerybalanceparams sdkcoin error balance qgetbalancesdkunwrapsdkcontextctx paramsaddress paramsdenom return balance nil custom query registration routing query server implementation would registered appmodules new method registerqueryservicegrpcserver could implemented simply xbankmodulego func appmodule registerqueryserviceserver grpcserver typesregisterqueryserverserver keeperquerieramkeeper underneath hood new method registerservicesd grpcservicedesc handler interface added existing baseappqueryrouter add query custom query routing table routing method described signature method match existing registerserver method grpc server type handler custom query server implementation described grpclike request routed service name cosmossdkxbankvquery method name querybalance combined form full method name cosmossdkxbankvqueryquerybalance get translated abci query customcosmossdkxbankvqueryquerybalance service handler registered queryrouterregisterservice routed way beyond method name grpc request carry protobuf encoded payload map naturally requestquerydata receive protobuf encoded response error thus quite natural mapping grpclike rpc method existing sdkquery queryrouter infrastructure basic specification allows reuse protocol buffer service definition abci custom query substantially reducing manual decoding encoding query method grpc protocol support addition providing abci query pathway easily provide grpc proxy server route request grpc protocol abci query request hood way client could host language existing grpc implementation make direct query cosmos sdk apps service definition order server work queryrouter baseapp expose service handler registered queryrouterregisterservice proxy server implementation node could launch proxy server separate port process abci app commandline flag rest query swagger generation grpcgateway project translates rest call grpc call special annotation service method module want expose rest query add googleapihttp annotation rpc method example protobuf xbanktypestypesproto service query rpc querybalancequerybalanceparams return cosmossdkvcoin googleapihttp get xbankvbalanceaddressdenom rpc queryallbalancesqueryallbalancesparams return queryallbalancesresponse googleapihttp get xbankvbalancesaddress grpcgateway work directly grpc proxy described translate request abci query hood grpcgateway also generate swagger definition automatically current implementation rest query module implement rest query manually addition abci querier method grpcgateway approach generate separate rest query handler query server described grpcgateway handle translation protobuf rest well swagger definition cosmos sdk provide cli command apps start grpc gateway either separate process process abci app well provide command generating grpcgateway proxy proto file swaggerjson file client usage gogo protobuf grpc plugin generates client interface addition server interface query service defined would get queryclient interface like type queryclient interface querybalancectx contextcontext querybalanceparams opts grpccalloption typescoin error queryallbalancesctx contextcontext queryallbalancesparams opts grpccalloption queryallbalancesresponse error via small patch gogo protobuf gogoprotobuf tweaked grpc codegen interface rather concrete type generated client struct allows also reuse grpc infrastructure abci client query contextwill receive new methodqueryconnthat return aclientconn route call abci query client cli method able call query method like clientctx clientnewcontext queryclient typesnewqueryclientclientctxqueryconn params typesquerybalanceparamsaddr denom result err queryclientquerybalancegocontextbackground params testing test would able create query client directly keeper sdkcontext reference queryservertesthelper queryhelper baseappnewqueryservertesthelperctx typesregisterqueryserverqueryhelper keeperquerierappbankkeeper queryclient typesnewqueryclientqueryhelper future improvement consequence positive greatly simplified querier implementation manual encodingdecoding easy query client generation existing grpc swagger tool rest query implementation type safe query method generated via grpc plugin going forward breakage query method backwards compatibility guarantee provided buf negative client existing abcirest query refactored new grpcrest query path well protobufprotojson encoded data unavoidable protobuf refactoring neutral reference