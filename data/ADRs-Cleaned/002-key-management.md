adr key management revealing mac key previous version otr protocol mechanism called diffiehellman ratchet ratchet ratchet key material message exchanged ratcheting approach consists attaching new contribution sent message sent message sender advertises new value message key computed latest acknowledged value three step ratchet work follows alice want send encrypted message bob pick recent encryption key puba bob acknowledged receiving advertising data message ake message key alices recent key generates new key nextdh pick recent bob encryption key pubb received either advertised data message ake message diffiehellman compute shared secret two key puba pubb message key encrypts message latest sends encrypted message bob advertises next diffiehellman key nextdh bob receives encrypted message alice diffiehellman compute shared secret two key puba pubb message key decrypts message latest want send encrypted message acknowledges alices next diffiehellman key nextdh puba generates new key nextdh pick recent alices encryption key puba received diffiehellman compute shared secret two key puba pubb message key encrypts message latest sends encrypted message alice advertises next diffiehellman key nextdh alice receives encrypted message bob proceeds decrypt previously stated design introduces postcompromise secrecy within conversation since compromised key regularly replaced new key material disadvantage ratchet session key might renewed every message forward secrecy therefore partially provided also lack outoforder resilience message arrives newly advertised key necessary decryption key already deleted message able decrypted order improve forward secrecy ratchet two ratchet approach combined session key produced ratchet seed perparticipant kdf symmetric ratchet message encrypted key produced kdf symmetric ratchet key frequently refreshed ratchet executed participant want send message one received resulting double ratchet called double ratchet algorithm provides forward secrecy across message due kdf symmetric ratchet also postcompromise secrecy since compromised kdf key eventually replaced new seed achieve outoforder resilience double ratchet make second derivation function within kdf symmetric ratchet kdf symmetric ratchet advanced normally kdf key passed second derivation function encryption double ratchet nevertheless provide asynchronicity combined prekey scheme achieve prekeys onetime ephemeral public contribution uploaded advance untrusted server otrv protocol consider double ratchet algorithm improve forward secrecy maintaining security property prior otr version like deniability property deniability property still achieved usage dakes message authenticated shared mac key rather signature generated longterm key otrv also publishes mac key malleable encryption expand set possible message forger otrv therefore improve forward secrecy provide postcompromise secrecy support outoforder resilence asynchronicity usage prekey ensemble uploaded server usage double ratchet algorithm correct way initializing dake must taken consideration preserve security proof dakes otrv initial ephemeral key ring signature derivation first mixed shared secret must key simply attached first two interactive dake message identity message authr message second noninteractive dake message noninteractiveauth message design composes properly security proof modeled ratcheting ephemeral public key exchanged two flow dake even begin furthermore ratcheting ephemeral public key included phi value otrv reveals mac key worth note otr version contains vulnerability related message authentication revelation mac key done immediately participant conversation two potential solution problem possible receiver reveal mac key give weaker deniability put full trust receiver sender receiver reveal mac key sender must reveal two ratchet generation otrv made allow receiver reveal mac key otrv chosen reveal mac key double ratchet otrv receiver data message reveal mac key first message sent per ratchet participant expiring session reveal mac key sent tlv type otrv decided double ratchet algorithm key management allows otrv support outoforder resilience improve forward secrecy form permessage forward secrecy otrv support outoforder network model message key stored reasonable amount time skipped delayed outoforder message decrypted implementers nevertheless careful storage message key attacker try cause denialofservice attack example forcing store large amount message key try capture retroactively decrypt message sent data message always type tlv attached case receiver participant never sure message corresponding stored skipped message key arrive tlv attached reason every time message key stored extra symmetric key also derived stored upon receipt message corresponding stored message key extra symmetric key either discarded decided receiver reveal mac key first message sent every ratchet even mac key stored message key session expired stored message key deleted corresponding mac key placed oldmackeys list later revealed either next sent data message immediate tlv type sent session expired consequence change data exchanged comparison previous otr version usage double ratchet algorithm improves forward secrecy key management ratcheting process become somewhat complex consequence allowing outoforder network model message key stored change fragmentation data message work comparison previous otr version reference marlinspike advanced cryptographic ratcheting signal blog available httpssignalorgblogadvancedratcheting bonneau morrison finitestate security analysis otr version available httpwwwjbonneaucomdocbmotrvanalysispdf unger dechand bonneau fahl perl goldberg smith sok secure messaging cacr available httpcacruwaterloocatechreportscacrpdf goldberg unger improved strongly deniable authenticated key exchange secure messaging waterloo canada university waterloo available httpcacruwaterloocatechreportscacrpdf