adr metric scripting wed like able script metric reporting third party consumer raster foundry currently manually assemble metric people ask however enough time passed consistent enough obligation know would scriptable adr seek answer question ought script production particular subset metric specifically tile server request user adr considers three possible solution weighs extensibility queryability platform dependence difficulty one take existing infrastructure metric collection move collection aws lambda function orchestrate lambda function step function plan would work already see issue beginning would work athena query initiated via aws lambda would process aggregate data insert aggregated metric raster foundry database information could exposed user report could generated regularly little intervention solution heavily dependent aws would require future hypothetical baremetal raster foundry installation come metric aggregation strategy however dependent aws also doesnt depend particular backend technology improves transferability tile server api server individual component strategy arent difficult strategy whole add infrastructure complexity branching new aws service application first time adding collection new lambda function second add middleware database store metric care strategy wed extract metadata incoming request either update count database append row would effectively become audit trail tile request depending create database table adding metric would require one appending row new metric type sort polymorphic value field database table adding new metric table specific configuration adding nullable column writing relevant data new incoming request retrieving data mean querying postgres fairly good strategy also extent platform dependent sense depends raster foundry deployed alongside postgres database however new piece vendor lockin since whole api tile server already depend heavily preconfigured transactor depends postgres require either invest unifying backend technology writing functionality http middleware akkahttp directive strategy fairly straightforward tile server side relies good job designing table dont overwhelm database retrieve information third define sort metric sink typeclass provide typeclass evidence database like second except instead implementing counter middleware database would implement counter middleware type evidence satisfy typeclass requirement querying data would depend sort sink chose choose postgres second adding new metric would require forcing new metric type required metric sink typeclass adding method typeclass also provides extensibility metric destination since could start postgres metric sink example later add grafana sort metric sink provided construct typeclass evidence required start second mindful potential later target configurable metric sink designing particular problem outset well start tile metric database table hold enough get metric want reason second likely safer avoids increasing infrastructure complexity marginal cost lockin lower marginal cost additional vendor lockin bear burden someday migrating everything http postgres additional aws lockin cost either make difficult anyone deploy bare metal solution make cost paying expensive second also extensible since storing information database allows expose via api information authorization elsewhere downside choosing second couple metric update release cycle could avoided coupling aws throwing every piece information data lake cost acceptable given benefit line strategy collecting data sake collecting data consequence well create middleware take partial function request matching update count database based extracted metadata request start another middleware backsplashserver subproject designed pull separate subproject start configurable well also create database table hold metric although could query database directly dao endpoint require platform admin privilege api view metric demand endpoint allow eventually shift metric push model send metric client request pull model client fire dashboard log raster foundry see metric theyre allowed see dependency http middleware impetus switch server library api server akkahttp http would allow dump metric service middleware