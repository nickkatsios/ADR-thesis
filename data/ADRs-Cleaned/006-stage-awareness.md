stage awareness implemented since best practise produce single artifact stage application provides confidence artifact deployed prod itll behave tested code also best practise employ continuous delivery infrastructure riffraff common vary infrastructure based stage example asg prod typically higher capacity code receives traffic prod typically also powerful instance type reason domain name prod different code let call stage aware value guardiancdk gucdk support stage aware value quo within yaml cloudformation template achieve stage awareness stage parameter mapping findinmap intrinsic function single yaml template artifact code prod stage contains fragment yaml parameter stage type string default code allowedvalues code prod description stage name mapping myapp code mininstances maxinstances prod mininstances maxinstances resource autoscalinggroupmyapp type awsautoscalingautoscalinggroup property maxsize fnfindinmap myapp ref stage maxinstances minsize fnfindinmap myapp ref stage mininstances note drawback model stack codeprod nomenclature case team edit entirely remove allowedvalue property stage parameter findinmap fails key cannot found failure seen runtime quite long feedback loop mapping support primitive type string list gucdk support stage aware value way significantly abstract remove listed drawback user provides shorter feedback loop position position evaluated following criterion adherence best practice producing single deterministic artifact adherence best practice continuous delivery infrastructure support stack code prod simplicity api presented user short feedback loop ease maintenance replicate model employed yaml template creating parameter mapping intrinsicfindinmap function familiar team therefore migration path gucdk much simpler worth noting structure aws cdk recommendation traditional aws cloudformation scenario goal produce single artifact parameterized deployed various target environment applying configuration value specific environment cdk build configuration right source code create stack production environment separate one stage put configuration value right code regarding implementation two version construct pattern stage aware provide consistent api construct pattern stack match pattern still raw construct benefit encoding best practice however also produce amount duplicated code codebase pattern stage aware pattern stage aware issue identified somewhat alleviated pattern pas primitive type construct mean construct directly stage aware form becomes little difficult however reinforces idea pattern default entry point project score whitecheckmark adherence best practice producing single deterministic artifact cdk synth create single cloudformation template file whitecheckmark adherence best practice continuous delivery infrastructure riffraff support deployment single cloudformation template file support stack code prod order support possible stage typesafe way likely resulting code within gucdk difficult reason gucdk could enforce code prod infra simplicity api presented user would possible gucdk present strongly typed api primitive type however stronger type instancetype supported solution stage parameter token cannot perform logic confusing often cause runtime error whitecheckmark short feedback loop resulting cloudformation template would look similar write yaml cloudformation type system help ensure dont suffer findinmap issue listed ease maintenance although type system could guidance order produce stage aware component wed either copypaste boilerplate introduce complex abstraction solution directly recommendation aws might limit evolution gucdk provide set pattern construct primitive type user provides mapping findinmap needed whitecheckmark adherence best practice producing single deterministic artifact cdk synth create single cloudformation template file whitecheckmark adherence best practice continuous delivery infrastructure riffraff support deployment single cloudformation template file whitecheckmark support stack code prod user would able specify stage simplicity api presented user user would create mapping time creating mapping within cdk quite verbose aim gucdk simplify infrastructure making easy follow best practice stronger type safe type instancetype supported short feedback loop likely faster handwriting yaml template whitecheckmark ease maintenance code handle stage awareness gucdk code best code add native cdk support riffraff tool whitecheckmark adherence best practice producing single deterministic artifact whitecheckmark adherence best practice continuous delivery infrastructure whitecheckmark support stack code prod simplicity api presented user stage dependent value placed cdk good solution would likely require build artifact follow cloud assembly spec departure quo big possibly breaking change whitecheckmark short feedback loop wed cdk exactly aws suggest tooling quite mature good ease maintenance solution would require significant change riffraff cdk toolkit available cli tool known plan java sdk supported produce cloudformation template stage model step away best practice exact artifact stage however artifact produced cdk pipeline thus retain deterministic characteristic stack gain stageawareness one would simply instantiate class class mystack extends gustack gustack provided gucdk new mystackscope mystack stack thestack stage prod mincapacity domainname examplecom new mystackscope mystack stack thestack stage code mincapacity domainname codeexamplecom score whitecheckmark adherence best practice producing single deterministic artifact whilst single artifact deterministic unit snapshot test ensure resulting template across stage differ property value overall infrastructure possible whitecheckmark adherence best practice continuous delivery infrastructure riffraff currently support different file per stage whitecheckmark support stack code prod whitecheckmark simplicity api presented user user defines shape input mystack type including strong type instancetype whitecheckmark short feedback loop standard cdk workflow employed whitecheckmark ease maintenance inline aws cdk recommendation small change riffraff would needed however possible nonbreaking way produce cloudformation template stage consequence riffraff would require change enable different cloudformation template file depending stage deployed riffraffyaml would likely look like yaml stack playground region euwest deployment cloudformation type cloudformation app cdkplayground parameter templatestagepath new code cdkplaygroundcodetemplatejson prod cdkplaygroundprodtemplatejson mean adoption gucdk requires editing riffraffyaml addition creating cdk directory repository note time writing gucdk currently implement proposal move suggested edit riffraffyaml schema include templatestagepath precedented templatestageparameters property prod code test infra prodaardvark codeaardvark prodzebra codezebra