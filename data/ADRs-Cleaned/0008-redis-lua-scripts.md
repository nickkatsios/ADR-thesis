redis lua script deciders dannycoates shanetomlinson vbudhram bbangert chenba problem statement currently fairly basic mechanism transaction type operation redis may expand redis replace mysql database oauth expansion include case require new indexing joinlike transactional operation support future case make current one concise evaluate implementation fxasharedredis driver robust redis transaction increased redis oauth updating module dependency move redis last updated year ago ioredis actively maintained considered continue expanding fxasharedredis lua script outcome lua script proofofconcept showed lua viable overall simpler positive consequence future case simpler implement custom redis glue code simpler stack trace improved maintainability negative consequence additional developer cost understanding lua change lua script require additional consideration regard performance performance implication checklist item lua script change similar sql stored procedure pro con continue expanding fxasharedredis fxasharedredis connection pool utilizes bluebird module disposer feature transaction isolation connection management currently depends older redis module hasnt updated two year well likely switch ioredis maintain connection pool well also add new functionality handle new transaction existing update function cant handle well design retry mechanism handle write conflict existing code simply ignores current case insufficient new case transactional case require code error handling method pro work well current case con watchmultiexec redis command cumbersome async language like requiring connection pool transaction isolation multiple redis round trip adding complexity maintenance burden currently depends outdated redis node module depends bluebird specific feature update function isnt well suited new transactional operation new code added transaction write conflict still occur handling get complex lua script lua script offer benefit watchmulti execute atomically number readswrites accept arbitrary argument would take multiple round trip read modify write standard redis command executed single eval call well eliminate connection pool wrapper require code development debugging lua redis provides ldb pro allow eliminate custom redis connection pool layer lua script natively atomic allows code cleaner enabling single redis call instead multiple round trip net fewer line code synchronous transaction simpler transaction code eliminates write conflict performant native promise con lua isnt additional language deal sharded clustering requires care key script must reside node dont currently sharding additional performance consideration lua script redis throughput link current update implementation lua prototype redis transaction