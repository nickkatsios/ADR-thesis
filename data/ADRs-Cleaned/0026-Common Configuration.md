common configuration submitter lenny goodell intel elizabeth lee intel change log original approved revised approved revised configuration provider system record referenced case common configuration ucr url case link tbd adr describes architecture new common configuration capability impact service requirement new capability described referenced ucr deemed architecturally significant due crosscutting impact current design following flow chart demonstrates bootstrapping service configuration current levski release proposed design configuration setting common service partitioned separate common configuration source common configuration source pushed configuration provider new corecommonconfigbootstrapper service bootstrapping service either load common configuration configuration provider via uri endpoint provides common configuration service additional private configuration may override andor extend common configuration additional common configuration setting must present indicate common setting pushed configuration provider setting stored last service must wait setting present prior pulling common setting environment override applied configuration loaded file overridden value pushed configuration provider common config bootstrapping following flow chart demonstrates bootstrapping seeding common configuration configuration provider service configuration bootstrapping following flow chart demonstrates bootstrapping service configuration new common configuration capability secret store configuration part design secret store configuration removed service configuration common private secret provider instantiated prior processing service configuration may require secret provider secret store configuration combination default value environment variable override environment variable one currently override configuration specifying common configuration location cpconfigprovider command line service default pulling common configuration standard path configuration provider edgexcommon cpconfigprovider assumes usage corecommonconfigbootstrapper service cannot cccommonconfig new cccommonconfig command line added service take uri specifies common configuration pulled configuration provider authentication limited basicauth addition new environment override variable edgexcommonconfig added allows overriding new command line cpconfigprovider specified cccommonconfig specified service start solely private configuration scenario information common configuration must added service private configuration individual bootstrap handler enhanced detect empty configuration robust error messaging providing common configuration configuration provider cpconfigprovider command line edgexconfigprovider environment variable configuration provider cccommonconfig command line edgexcommonconfig environment variable may specified http endpoint return common configuration file response local file contains common configuration private configuration file alongside private configuration writable section writable section common private configuration watched change configuration provider change common writable processed changed setting must checked see setting exists service private section change ignored setting exists service private section service private override always retained change service private writable section processed done currently common application device service setting setting common application service andor device service included single common configuration source setting ignored service dont marshaled service configuration struct example configuration file common configuration toml writable loglevel info writableinsecuresecrets writableinsecuresecretsdb path redisdb writableinsecuresecretsdbsecrets username password writabletelemetry interval publishtopicprefix edgextelemetry added publish topic prefix writabletelemetrymetrics service metric name must present list device sdk common service metric eventssent false readingssent false app sdk common service metric messagesreceived false invalidmessagesreceived false pipelinemessagesprocessed false pipeline added tag metric pipeline defined pipelinemessageprocessingtime false pipeline added tag metric pipeline defined pipelineprocessingerrors false pipeline added tag metric pipeline defined httpexportsize false single metric http export mqttexportsize false brokeraddress topic added tag metric mqttexport defined common security service metric securitysecretsrequested false securitysecretsstored false securityconsultokensrequested false securityconsultokenduration false writabletelemetrytags contains service level tag attached service metric gatewaymyiotgateway tag must added via consul env override chnage existing value added new one device service specifc common writable configuration writablereading readingunits true application service specifc common writable configuration writablestoreandforward enabled false retryinterval maxretrycount service healthcheckinterval host localhost serverbindaddr leave blank default host value unless different value needed maxresultcount maxrequestsize curently defines maximum size http request body byte requesttimeout servicecorsconfiguration enablecors false corsallowcredentials false corsallowedorigin httpslocalhost corsallowedmethods get post put patch delete corsallowedheaders authorization accept acceptlanguage contentlanguage contenttype xcorrelationid corsexposeheaders cachecontrol contentlanguage contentlength contenttype expires lastmodified pragma xcorrelationid corsmaxage registry host localhost port type consul database databasesprimary host localhost port timeout type redisdb messagequeue protocol redis host localhost port type redis authmode usernamepassword required redis messagebus secure insecure secretname redisdb messagequeueoptional default mqtt specific enable evnironment variable override qos quality sevice value least exactly keepalive second must greater retained false autoreconnect true connecttimeout second skipcertverify false additional default nats specific enable evnironment variable override format nats retryonfailedconnect true queuegroup durable autoprovision true deliver new defaultpubretryattempts subject edgex required nats jetstram stream autoprovsioning device service specifc common configuration device datatransform true maxcmdops maxcmdvaluelen profilesdir resprofiles devicesdir resdevices enableasyncreadings true asyncbuffersize label usemessagebus true devicediscovery enabled false interval application service specifc common configuration trigger typeedgexmessagebus triggeredgexmessagebus type redis triggeredgexmessagebussubscribehost host localhost port protocol redis triggeredgexmessagebuspublishhost host localhost port protocol redis triggeredgexmessagebusoptional authmode usernamepassword required redis messagebus secure insecure secretname redisdb default mqtt specific enable environment variable override qos quality service value least exactly keepalive second must greater retained false autoreconnect true connecttimeout second skipcertverify false default nats specific enable environment variable override format nats retryonfailedconnect true queuegroup durable autoprovision true deliver new defaultpubretryattempts subject edgex required nats jetstream stream auto provisioning core data private configuration toml maxeventsize defines maximum event size kilobyte writable persistdata true writabletelemetry writabletelemetrymetrics service metric name must present list core data service metric eventspersisted false readingspersisted false service port startupmsg core data microservice client core data longer dependent client service service thier specific client database databasesprimary name coredata messagequeue publishtopicprefix edgexeventscore added publish topic prefix subscribeenabled true subscribetopic edgexeventsdevice required subscribing event messagebus messagequeueoptional default mqtt specific enable evnironment variable override clientid coredata app rfid llrp inventory private configuration toml service port startupmsg rfid llrp inventory service client clientscoredata protocol http host localhost port clientscoremetadata protocol http host localhost port clientscorecommand protocol http host localhost port trigger typeedgexmessagebus triggeredgexmessagebus triggeredgexmessagebussubscribehost subscribetopicsedgexeventsroaccessreportedgexeventsreadereventnotification triggeredgexmessagebuspublishhost publishtopicedgexeventsdeviceprofilenamedevicenamesourcename publish topic format device service triggeredgexmessagebusoptional default mqtt specific enable environment variable override clientid apprfidllrpinventory appcustom every devicereader antenna port represents tag location assigned alias freezer backroom etc give meaning data default alias set application format readeref readeref devicename antennaid see also httpsgithubcomedgexfoundryapprfidllrpinventorysettingthealiases order override alias set default alias key new alias value want readeref freezer readeref backroom appcustomaliases see httpsgithubcomedgexfoundryapprfidllrpinventoryconfiguration appcustomappsettings deviceservicename devicerfidllrp adjustlastreadonbyorigin true departedthresholdseconds departedcheckintervalseconds ageouthours mobilityprofilethreshold mobilityprofileholdoffmillis mobilityprofileslope device mqtt private configuration toml maxeventsize value unlimit maximum event size sent message bus coredata writable insecuresecrets required redis message bus writableinsecuresecrets writableinsecuresecretsmqtt path credential writableinsecuresecretsmqttsecrets username password service port startupmsg device mqtt started client clientscoredata protocol http host localhost port clientscoremetadata protocol http host localhost port messagequeue publishtopicprefix edgexeventsdevice added publish topic prefix messagequeueoptional default mqtt nats specific enable environment variable override clientid devicemqtt messagequeuetopics commandrequesttopic edgexdevicecommandrequestdevicemqtt subscribing inbound command request commandresponsetopicprefix edgexdevicecommandresponse publishing outbound command response added publish topic prefix mqttbrokerinfo schema tcp host localhost port qos keepalive clientid devicemqtt credentialsretrytime second credentialsretrywait second connestablishingretry connretrywaittime authmode mqtt broker authentication mechanism currently none usernamepassword authmode supported service secret key username password authmode none credentialspath credential comment outremove multilevel topic incomingtopic datatopic responsetopic responsetopic usetopiclevels false uncomment multilevel topic incomingtopic incomingdata responsetopic commandresponse usetopiclevels true mqttbrokerinfowritable responsefetchinterval specifies retry intervalmilliseconds fetch command response mqtt broker responsefetchinterval module service impacted following module service impacted gomodbootstrap service configuration bootstrapping handled module service consume gomodbootstrap configuration file updated remove common setting leaf private setting override certain common setting see example new service provides common configuration contains new configuration file contains common setting see example environment override applied common setting service responsible pushing common setting configuration provider first startup providing override flag common service force repushing configuration configuration provider change securitysecretstoresetup needed seed basic auth secret new configuration service distribute consuming microservices taf test script may impacted based setting modified via configuration provider consideration new service owns common configuration could integrated core metadata rather creating new microservice violates microservice design principle single responsibility configuration provider environment override seed value configuration provider make configuration provider system record configuration environment override longer highest precedence edgex changingadding environment override configuration provider seeded impact service configuration service full configuration store configuration provider rather private setting consensus redundant common setting service private setting separate application service device service common configuration setting could configuration source loaded separately application device service would add undue complexity mitigated setting ignored marshaller service new service could provide rest endpoint serve common configuration consensus default configuration thus endpoint accept new capability described related adrs serviceselfconfig reference tbd