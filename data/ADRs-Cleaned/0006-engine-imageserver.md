engine imageserver thumb proposed deciders donald gray jack lewis issue problem statement dlcs engine currently array single value generated confined thumbnail thumbnail generation done appetiser time jpeg generation allow engine produce thumbnail based valid iiif imageapi size parameter introduce imageserver avoid replicating resizing logic elsewhere identify best way available imageserver engine without affecting live assetrequest traffic driver deployment deployment remain straightforward simplicity refactoring engine imageserver thumbnail creation shouldnt make code considerably complex scaling time high usage engine scale many instance imageserver cope additional considered run cantaloupe sidecar fargate engine task sharing ephemeral storage run cantaloupe separate service shared engine instance host sharing local disk run cantaloupe separate fargate service sharing efs storage run cantaloupe separate fargate service sharing object storage dockerized iiifprocessor npm package rather cantaloupe outcome chosen run cantaloupe separate fargate service sharing object storage similar specialserver run could specialserver dont want put additional load public imageserving traffic cantaloupe streaming performant reading disk shouldnt issue ingest time user waiting byte load origin accessible imageserver either optimised origin copied dlcs storage exception thumb channel without iiifimg would require temporary upload see bottom document working notessequence diagram work problem positive consequence engine infrastructure remains unchanged cantaloupe already serve image consistent processing across ingest delivery docker image different configuration scale separate instance independant engine cantaloupe per engine cantaloupe handle reqs etc scavenging issue shared storage effectively limitless negative consequence additional service manage requesting thumb channel without iiifimg require temporary file thumb generation cleanup lifecycle rule distributed call generate thumb may automatic retry backoff avoid failing ingest single request fails pro con run cantaloupe sidecar fargate engine task sharing ephemeral storage positive consequence simplest arrangement http call made locally addressed cantaloupe scaling consistent approach appetiser currently reading local disk performant reading negative consequence basic engine task would resource even lightly run cantaloupe separate service shared engine instance host sharing local disk positive consequence multiple engine single cantaloupe negative consequence management overhead manage instance patching etc bigger starting stake majority time resource unused scaling could get complicated run cantaloupe separate fargate service sharing efs storage positive consequence multiple engine single cantaloupe manage infrastructure fargate negative consequence unsure efs would operate load would thorough testing dockerized iiifprocessor npm package rather cantaloupe positive consequence dockerized npm package much lightweight cantaloupe negative consequence ingest imageserving different technology different processor could result error subtly different output rounding issuescolour cast working note working note made work whether able cover required ingest permutation imageoptpolicy origin type origin format happens engine iiifimgthumbs default http download origin call appetiser convert uploads converted call cantaloupe generate thumb uploads thumb iiifimgthumbs default http imagejp download origin call appetiser convert would noop uploads converted call cantaloupe generate thumb uploads thumb iiifimgthumbs default soptimised download origin call appetiser convert uploads converted call cantaloupe generate thumb uploads thumb iiifimgthumbs default soptimised imagejp download origin uploads converted call cantaloupe generate thumb uploads thumb iiifimgthumbs useoriginal http download origin upload origin call cantaloupe generate thumb uploads thumb iiifimgthumbs useoriginal soptimised download origin call cantaloupe generate thumb original upload thumb thumb http download origin upload origin call cantaloupe generate thumb upload thumb thumb soptimised call cantaloupe generate thumb origin upload thumb filethumbs http origin already sdlcsstorage call cantaloupe generate thumb upload thumb filethumbs soptimised call cantaloupe generate thumb origin upload thumb http sambient thumb without iiifimg would thumb uploaded dlcsstorage location transient store known prefix lifecycle remove cleanup non optimised origin iiifimgthumbs mermaid sequencediagram participant imageworker participant origin participant appetiser participant cantaloupe participant dlcss originimageworkerdownload image byte alt imageoptimisationpolicy default imageworkerappetiserconvert appetiserappetisergenerate appetiserimageworkerjp path end imageworkerdlcssupload derivative original loop per thumb size policy imageworkercantaloupeget iiifsoriginfullsizedefaultjpg dlcsscantaloupe read derivative original cantaloupeimageworker thumbnail byte imageworkerdlcss upload thumbnail jpeg end optimised origin iiifimgthumbs mermaid sequencediagram participant imageworker participant origin participant appetiser participant cantaloupe participant dlcss originimageworkerdownload image byte alt imageoptimisationpolicy default imageworkerappetiserconvert appetiserappetisergenerate appetiserimageworkerjp path imageworkerdlcssupload derivative loop per thumb size policy imageworkercantaloupeget iiifsoriginfullsizedefaultjpg dlcsscantaloupe read cantaloupeimageworker thumbnail byte imageworkerdlcss upload thumbnail jpeg end else imageoptimisationpolicy useoriginal loop per thumb size policy imageworkercantaloupeget iiifsoriginfullsizedefaultjpg origincantaloupe read cantaloupeimageworker thumbnail byte imageworkerdlcss upload thumbnail jpeg end end nonoptimised origin thumb mermaid sequencediagram participant imageworker participant origin participant cantaloupe participant dlcss originimageworkerdownload image byte alt optimisedorigin imageworkerdlcssupload original temp thumb note imageworker imagepolicy end loop per thumb size policy imageworkercantaloupeget iiifsoriginfullsizedefaultjpg alt optimisedorigin origincantaloupe read else optimised dlcsscantaloupe read end cantaloupeimageworker thumbnail byte imageworkerdlcss upload thumbnail jpeg end