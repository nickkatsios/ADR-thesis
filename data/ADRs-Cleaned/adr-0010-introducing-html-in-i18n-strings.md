kind architecture record adr introducing html translation string hubert sablonnire want whitelisted html tag translation string main reason would add strong code anchor directly translated sentence actually really hard properly adr try explain thinking chosen solution current system theory right system two mode static text inkey string text params inkey params string observation params string object number result always string may contain html tag html tag may come static part params static part translation always come developer params always come userapi mean cannot trust result templating library function sanitize output thats exactly lithtml component always consider output string treated unsafe html system completely agnostic lithtml really like isolationdecoupling example let take example translationlangjs mycomponentonehello world mycomponenttwo name hello name mycomponentjs render return html div inmycomponentone inmycomponenttwo name strongworldstrong div case function would return unsafe string strong tag handled lithtml template would produce following html hello strongworldstrong hello strongworldstrong unsafe html string escaped lithtml want example example wed like produce html hello world hello strongworldstrong observation strong tag treated html came static part translation strong tag escaped came param requirement here wish whitelisted html tag strong code static part translation string whitelisted attribute ahref title every tag rendered pure safe text attribute removed everything translation string param escaped safe text solution isolated decoupled create component possible solution small possible note question apply sanitization buildtime seems like buildtime check devs dont add crazy html tag translation string seems hard doimplement seem super safe regarding security heard dompurify fit requirement regarding filtering html string dom structure lot thing dont lithtml html template tag function system static part trusted params escaped accepts regular html custom syntax good target want system decoupled component good solution here description good solution would work trust translation string solution solution would assume new system trusted mean must take care sanitization must whitelistfilter tag attribute static part must escape params could done template tag function called sanitize inside translation file like mycomponentone sanitizehello strongworldstrong mycomponenttwo name sanitizehello strongnamestrong observation assuming dompurify whitelistfilter stuff find way simply escape thing params still problem system still return html string even know sanitized well templating system trust html string mean result call would lithtml unsafe directive component forget sanitize tag translation string exposed security risk would require hard work babelast stuff automate check checkin task solution super satisfying regarding security since templating system trust everything come system briefly mentioned could possible make mistake dont invest buildtime check tooling return lithtml template solution youre familiar lithtml would know treat string unsafe trust mean trust templateresults let say find way function return templateresults inkey templateresults inkey params templateresults observation return lithtml templateresults instead string completely break isolationdecoupling want enforce return lithtml templateresults could rely html static part escaped params already mentioned lithtml accepts way html static part would help whitelistfilter stuff correctly without allowing html tagsattributes dompurify would properly dont see would fit system want return templateresults would achieve goal lithtml unsafe directive component way lithtml would accept templateresults trustworthy solution nogo dont want system decoupled templating system much possible return dom solution youre familiar lithtml would know trust string trust templateresults also trust documentfragment interesting could achieve requirement whitelistingfilteringescaping function return sanitized documentfragment course could still return unsafe string return sanitized documentfragment needed inkey stringdocumentfragment inkey params stringdocumentfragment think achieved template tag function mentioned another solution mycomponentone sanitizehello strongworldstrong mycomponenttwo name sanitizehello strongnamestrong observation documentfragment part dom lithtml specific achieve isolationdecoupling intemplating think idea could templating solution tweeks way everything unsafe default developer sanitize return documentfragment trusted probable mistake developer html translation string forgets sanitize return unsafe string templating system escape fine template tag function like lithtml would help identify static part params still find way strictly escape content params sanitizefilter whole content params escaped escaping content params already explained dont want lithtml allows regular html syntax would tricky combine whitelisting mechanism would break isolationdecoupling requirement knowledge clear official way escape string dom api looked escapehtml really small yet another party dependency based regexes omg decided imitate lithtml dom behaviour textnode setup span textnode const span documentcreateelementspan const textnode documentcreatetextnode spanappendchildtextnode set unsafe html text textnodedata hdirtyh html ask innerhtml parent consolelogspaninnerhtml lthgtdirtylthgt html textnode behave parent style tag whitelistingfiltering whole content params escaped managed really easily dompurify dont lot setting full list safe think time smaller tried achieve whitelistingfiltering treewalker easy api opinion well known web devs seems useful situation want check thing situation want manipulate dom end something simpler template element safely parse whole html string params escaped queryselectorall template content list iterate element microbenchmarks dont seem agree seem bad performancewise compared treewalker end really easy implement sanitization requirementsrules look source want liblibinsanitizejs recap return string cannot trusted return documentfragment trusted implementation really small byte implementation unit tested added cypressio project create test suite added consolewarn warn dont follow rule dont see would easily run sanitization part incheck task exaplined dev html translation string forgets sanitize template tag function return string escaped templating system like mean open security door sanitize function return documentfragment security door unit test small implementation system work domenabled environment browers node dont think problem prevent checkin task work like