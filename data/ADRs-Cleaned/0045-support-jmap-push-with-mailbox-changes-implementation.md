support jmap push mailboxchanges implementation lazy consensus implemented jmap push notification allow client efficiently update almost instantly stay sync data change server order support handle state property come jmap getset request mean james able record new state object whenever change happens well return recent state client fetching object first step implement mailboxchanges implement mechanism record change happening mailbox object form list mailboxid event createdupdateddestroyed occur message appended mailbox store mailboxids along state object cassandra table state list change mailboxid stored separated list corresponding change represent created updated destroyed case message appended mailbox counted updated event mailboxid stored updated list leveraging mailboxchanges table fetch change occurred since particular state state stored cassandra time based uuid timeuuid ensures conflicting change happen case two event occur point time timeuuid also allows state sorted chronological order component implemented mailboxchangesrepository allows storing fetching state along list mailboxid mailboxchanges table mailboxchangelistener listens change trigger record creation mailboxchanges table mailboxchangemethod handle state property allowing client fetch change since particular state mailboxsetmethodmailboxgetmethod query mailboxchangesrepository state property example mailboxchanges requestresponse request mailboxchanges accountid caecbefcbfbaffcaaeddacdcaf sincestate ddabeefcccc response mailboxchanges accountid caecbefcbfbaffcaaeddacdcaf oldstate ddabeefcccc newstate bfbabeed hasmorechanges false created updated destroyed consequence due limitation event listening mechanism listener store one change one mailboxid state instead many however keeping data type change separated list opened future improvement change fetched linear fashion oldest newest opposed prioritize newer change first according spec cassandra table structure one table required table mailboxchanges primary key accountid clustering column state column created column updated column destroyed column iscountchange ordered state reference support jmap http push implement mailboxchangerepository implement jmap mailboxchangelistener implement mailboxchanges method related contract test implement cassandramailboxchangerepository mailboxget handle state property mailboxset handle oldstate newstate mailboxchanges updatedproperties handling adr mailboxchanges