see httpsgithubcomazavearasterfoundryissues feature requirement provide way user request shipment export imagery system geotiff format able deliver finalized export user able deliver export large area high resolution provide user indication progress requested export high level matter architecture choose workflow probably going look something like user make export request via api generate export configuration based user request render output report delivery report imagery handling source imagery come several source project collection scene user may select subset available band user may request rgb image output tool ndvi ndwi evi either limited areaofinterest polygon delivery imagery able delivered via ratelimited metered http link direct deposit user bucket direct deposit user dropbox user able select projection imagery receive data model choosing appropriate internal data representation export parameter important ideally would like single export process handle exporting imagery tool node project want process easy reason well resilient change tool project user dont lot information actual usage pattern functionality look like beta user band rgbnir imagery however know many beta user expressed pressing able view imagery map exporting result analysis urgent many focus immediate development effort providing solution user want export rgb imagery project already contain rgb band little analysis alteration aside color correction mosaicking approach constrain scope development allow iterate quickly addressing concrete problem faced real user put another way explicitly deferring implementation export functionality following case falsecolor composite hyperspectral nonrgb data source project whose scene dont available band resolution tool output arbitrary tool node however expect cover deferred case sooner rather later design data model way believe allow easily expand export functionality going forward detail design given additionally order avoid making functionality limited information aspect functionality outlined addressed adr noted end section data model internally wrap export configuration inside tool definition even though initial focus providing export rgb data project mean user request export particular project without colorcorrection internally generate oneoff tool look something like following export output tool project user wanted colorcorrect would colorcorrection operator middle instead identity operator approach increase initial complexity developing export process work specifying tool generating imagery arbitrary tool definition still progress finalized process work least extent necessary support case ultimately believe adopting architecture upfront net win term development effort following reason force functionality tool dogfooding provide opportunity discover problem tricky area functionality user make tool robust overall let get head start exporting tool making eventual implementation functionality straightforward get ideally able simply userdefined tool definition export rather internallygenerated tool everything work unlikely thing work perfectly practice almost certainly save time simplify architecture export job able assume always receive tool definition input implement separate export logic depending whether user chooses export project tool workflow user request create api endpoint allows user request export project stage development endpoint accept minimum parameter allowing user specify project export delivery http link deposit dropbox deposit areaofinterest geometry mask export output output projection srid endpoint prevent export project scene user making request authorized access may also basic verification delivery user dropbox configured enough space dropbox etc generate export configuration endpoint convert user request internal representation export configuration toolcentric structure described export configuration stored database record trigger creation airflow dag run perform actual export airflow dag run triggered similarly way ingests currently triggered user make api request row written exportconfiguration table table name important signaling pending requires processing airflow task run periodically every minute two kick dag run export configuration marked pending change configuration dont get processed twice outline export configuration might look like given end section exact schema expected change add functionality note airflow early version rest api may allow trigger dag run directly userfacing api endpoint would eliminate periodic task scan pending export thereby reduce latency however feature early stage wait mature utilize render output spark job take export configuration relevant portion render necessary output store result detail job function run defined delivery result export task stored consistent format delivery mechanism structured process copy data make available target three target know internal accessible via http external dropbox internally store information database record user multiple aws dropbox credential tied account authentication detail external account treated sensitive information password internal delivery process make export result available via http could done number way moving specific bucket making database record link export result publiclyaccessible url delivery also include ratelimiting metering exact detail functionality left undefined external delivery process require bucket prefix file stored aws credential external aws account sufficient permission write location parameter provided user delivery process authenticate provided credential copy result export process provided bucket prefix location dropbox delivery process require credential dropbox account well location within dropbox functionality similar external delivery mechanism delivery process authenticate provided credential attempt copy export result provided dropbox account dropbox account limited storage delivery mechanism preverify enough space available store export result handle error may arise user dropbox running space update provide user update progress export consistent existing update mechanism express enumeration export record database enumeration expected look something like following subject change pending export airflow dag kicked submitted export dag processed rendering export rendered delivering export rendered delivered success export delivered successfully complete error export encountered error failed complete structure update separate airflow task wherever possible update mechanism tightly coupled task report often brought fails causing incorrect reporting keeping task separate task real work ensure reporting based airflow view task expect often correct example dag structure given sample export configuration schema schema omits common field user creation datetime intended starting point change expected exportconfiguration source tool could also stored json field represents tool definition outputprojection srid mask multipolygon area interest clip result deliveryconfig deliveryconfig user create object providing credential dropbox etc enum pending submitted rendering delivering success error result json link deliveryconfigtype http error message failure deferred structure following feature left undefined gather information usage desired functionality rate limiting metering downloads dont know much detail necessary could carry high engineering cost depending solution chosen user interface allowing user select different band export falsecolor composite anticipated priority early user dont enough information case develop clear path forward implementing backend handling project contain scene different set band andor different resolution previous consequence wrapping export inside tool likely require greater upfront development effort exporting project directly would however described believe approach pay significant dividend term development effort robustness later storing update enumeration make difficult store extra metadata export prevents storing finegrained percent completion simpler implement however flexible solution also complex believe simplicity enumerationbased solution make straightforward extend update functionality concrete case arises complex feature developed largely without direct user feedback far deferred architecting number aspect functionality gather realworld usage information reduces risk expend development resource feature user dont deferring implementation expose possibility may develop feature time pressure point future balanced fact situation occur much clearer understanding necessary functionality point