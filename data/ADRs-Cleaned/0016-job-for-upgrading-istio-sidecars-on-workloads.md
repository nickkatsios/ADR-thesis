job upgrading istio sidecar workload istios service mesh capabilites facilitated via sidecar injected workload pod sidecar run istiopatched version envoy tied version istio injects typically new version istio released new version sidecar released well istio good far supporting older version sidecar deployed istio upgraded still documented best practice roll pod istio upgrade additional constraint operator cfforks cluster expect able perform upgrade one kapp deploy postinstall hook bash script limit considerably see slack thread constraint kubernetes job resource run kubectl command needed roll workload pod waiting new istio control plane healthy end add necessary minimal serviceaccounts role needed list resource istiosystem namespace restart resource configured workload namespace also build maintain container image contains job logic istio component tagged istio version job positively determine correct version control plane component alive healthy also name job according istio version take advantage job inherent immutability case cfforks upgrade contain new istio version pushing job cause rerun preventing workload rolling unnecessarily subsequent job clean previous one consequence apps always current version istios side car apps deployed single instance experience downtime upgrade may break uptime testing team deploying instance fix without requiring significant additional resource completed job hang around configured workload namespace platform operator see