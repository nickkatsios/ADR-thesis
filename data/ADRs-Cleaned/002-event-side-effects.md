event side effect author opqdonut macroz luontola cscwooller background application event generate sideeffects adding entitlement posting elsewhere email notification wanted come architecture event pollers sideeffect let implement event poller scheduled job walk event keeping track event already seen sideeffect fails poller stop retry event later pollers separate testability want decouple failure perhaps future configurability well course share infrastructure code storing event processed amendment process manager author opqdonut luontola problem existing pollers since one event generate multiple email email might fail shouldnt retry process whole event entitlement poller causing entitlement immediately available approving application made implementing integration harder new design process manager outboxes new design process manager run right command handler process manager look event produce command produce new command new database row since manager run synchronously command handler sideeffects quick able fail sideeffects fail might retried decoupled command outboxes outbox database table store sideeffects yet happen email send entitlement post scheduled job poller monitor outbox try send message count retries etc well start separate outboxes email entitlement generic outbox implemented later get type side effect example process manager approver bot read submit event produce approve command email process manager read event writes email email outbox see also issue email poller refactoring email poller process manager outbox issue refactoring entitlement amendment generic outbox author opqdonut instead separate outbox table mentioned previous amendment easier directly generic outbox table