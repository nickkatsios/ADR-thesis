architecture record database migration general arachnes philosophy embrace concept immutability reproducibility rather changing something replace something new usually simplifies mental model reduces number variable reducing way thing wrong one area approach cant work administering change production database database must stable existence across time cant throw away data every time want make change yet change database happen data model change new field added entity relationship refactored challenge provide way provide measured safe reproducible change across time also compatible arachnes target defining describing relevant part application including data model therefore schema configuration compounding challenge build system define concrete schema different type database based common data model chimera described adr prior art several system already exist best known probably rail active record migration oriented around making schema change relational database another solution interest liquibase system reifies database change data explicitly applies relation database scenario variety user story accomodate example include new developer project want create local database work current head codebase local development responsible production deployment project team new software version ready requires new field added database new code run want set staging environment exact mirror current production system fellow developer merging branch different feature made different change data model sure compatible merge recognize made mistake earlier development stored currency value floating point number create new column database fixedpoint type copy existing value rounding logic youve agreed domain expert chimera explicitly define concept migration reify migration entity configuration migration represents atomic set change schema database given database instance either migration logically applied hasnt migration unique expressed namespacequalified keywords every migration one parent migration except single special initial migration parent migration may applied database unless parent already applied migration also signature signature checksum actual content migration applied database whether txdata datomic string sql ddl json string etc ensure migration changed already applied persistent database adapter responsible exposing implementation migration accompanying config dsl appropriate database type chimera adapter must additionally satisfy two runtime operation hasmigration take signature particular migration return true migration successfully applied database implies database must migration aware store idssignatures migration already applied migrate given specific migration run migration record migration applied migration type four basic type migration native migration instance migration type directly implemented database adapter specific type example native migration sql database would implemented primarily via sql string native migration adapter appropriate type chimera migration define migration chimera entityattribute data model abstract work multiple different type adapter chimera migration supported chimera adapter sentinel migration coordinate manual change existing database code requires always fail automatically apply existing database database admin must add migration record explicitly perform manual migration task note actually implementing deferred needed structure usage migration may one parent migration form directed acyclic graph appropriate combine well arachnes composability model module may define sequence migration build data model extending module branch point build data model share structure module may also depend upon chain migration specified two dependent module indicate requires configuration chimera database component may depend number migration component migration ancestor form database definition represent complete schema concrete database instance far chimera concerned database component started connects underlying data store verifies specifies migration applied fails start guarantee safety arachne system given application simply start compatible specified database parallel migration create opportunity problem two migration dependency relatinship parallel migration operation incompatible would yield different result depending order applied operation conflict applying database could result error nondeterministic behavior parallel migration chimera migration arachne aware internal structure detect conflict refuse start run migration actually touch database unfortunately arachne cannot detect conflicting parallel migration migration type responsibility application developer ensure parallel migration logically isolate coexist database without conflict therefore advisable general public module chimera migration addition making broadly compatible possible also make tractable application author avoid conflicting parallel migration since worry create chimera migration entity type one drawback chimera migration cannot see full entity type defined one place reading config dsl script cannot avoided real living application entity defined time many different migration application grows chimera migration contains fragment full data model however pose usability problem developer machine consumption many reason developer module view query entity type model point time snapshot rather series incremental change support case chimera module creates flat entity type model database rolling individual chimera entity definition form single full data structure graph canonical entity model render schema diagram user queried module applying migration invoke adapter migrate function defined since different team wish different way possibility include application call migrate every time started advisable database excellent support transactional atomic migration scenario developer worry deploying code devops team manually invoke migrate function new configuration prior deployment continuousdeployment setup server could run battery test clone production database invoke migrate automatically pas development team inspect set migration generate set native sql txdata statement handoff dedicated dba team review commit prior deployment database without migration every application want chimera migration system situation migration may good fit include prefer manage database schema working existing database predates arachne work database administered separate team however still may wish utilize chimera entity model leverage module define chimera migration support chimera allows configuration designate database component assertonly assertonly database never migration applied require database track concept migration instead inspect chimera entity model rolling declared migration assert database already compatible schema installed everything start normal component fails start course schema chimera expects likely exact match present database accomodate chimera adapter defines set override configuration entity accompanying dsl user apply override change behavior mapping chimera query store data note chimera override incompatible actually running migration assertonly database migration rollback generalized rollback migration intractable given variety database chimera intends support one following strategy instead development testing constantly creating throwing away new database back database running migration cant afford downtime data loss associated restoring backup manually revert change unwanted migration proposed consequence user define data model configuration data model automatically reflected database data model change explicitly modeled across time migration entity type schema element represented arachne apps configuration given configuration database built migration reliably reproduced configuration migration contain entire perfectly reproducible history database migration optional chimera data model existing database