solrcontentstore replication solr index replication distributes copy master index one slave server master server charge manage update index querying handled slave division labor enables solr scale provide adequate responsiveness query large search volume source apache solr reference guide searchservices set extension written top apache solr leverage mechanism replicating index however there external part data managed plain lucene index contentstore contentstore composed several file specifically one indexed document solrinputdocument instance stored filesystem serialized compressed form contentstore searchservices maintains input data original form entering solr therefore applying text analysis source data needed managing searchrelated capability like fingerprinting highlighting clustering stored original field value retrieval query time masterslaves infrastructure contentstore must managed master must replicated slave unfortunately default builtin solr replication mechanism considers lucene index datafiles configuration file core conf folder schemaxml stopwordstxt consequence default solr replicationhandler contentstore wont replicated slave builtin solr replicationhandler work index replication mechanism provided orgapachesolrhandlerreplicationhandler component quite complex contains logic needed side master slave therefore play different workflow depending role solr node master node responsible manage index consequence deletes add update replication handler doesnt play active role take care incrementing index version providing required endpoint retrieving index datafiles slave node maintains local index version replication enabled periodically poll master order detect index change replicated repeater node act time master slave intermediate node replicating index slave different datacenter commitversioninfo drive replication process composed two different value index version number indicating index version timestampbased change every time update add delete applied index generation lucene index composed several segment progressive identification number called generation one largest generation active one replication perspective generation number doesnt actually indicate active segment instead current replicateable one available service one single endpoint replication provided replicationhandler command request parameter indicate logical endpoint want execute available command listed following table additional column report customisation going implement impact following table list available sharding method associated mnemonic code value shardmethod attribute configure solrcoreproperties commanddescription indexversionreturns version index version generation latest replicatable index specified master slave filecontentreturns stream reference given file replicating file synched filelistreturns list index file associated given generation configuration file included replication backupan asynchronous call backup data latest index commit point restorerestores index snapshot current core statusbackup restorestatusrestore deletebackupdeletes index snapshot previously created fetchindexforces specified slave fetch copy index master enablepollslave enables polling slave node disablepollslave disables polling slave node enablereplicationmaster enables replication master slave disablereplicationmaster disables replication master slave detailsreturns replication current node configuration commitsgets commit point index workflow briefly mentioned runtime logic replicationhandler depends role hosting solr node master node master main responsibility replication perspective update index version generation index version actual trigger replication mechanism index version incremented updated time change set change applied index generation follows similar path directly maintained low level lucene expose relevant endpoint needed called slave replicating data slave slave mode providing endpoint seen slightly different semantic indeed main difference active role played background thread simplifying performs following operation get latest index version generation commandindexversion master slave version replication happens otherwise temporary directory hold downloaded data created index list file replicated fetched commandfilelist includes datafiles configuration file file replicated retrieve download content commandfilecontent internally set downloaded data file could change solr could decide download part index full copy searchservices replication mechanism include also contentstore part synchronization workflow order additional behaviour requires customisation workflow provided default solr replicationhandler explained alfresco replication handler design alfresco replicationhandler name suggests customisation default solr replicationhandler described customisation injects additional logic side replication mechanism order efficiently replicate content store master master maintains core versioning history owned data consists underlying lucene index configuration file versionedreplicated content store content store replication enabled master replication handler configuration declare new replicationhandler class solrconfigxml additional attribute indicates absolute path content store root folder version number associated set change incremented persistent change hard commit lucene index note behaviour already implemented default replicationhandler mean inject additional logic required content store part mechanism specifically version number aka indexversion also storing content store change content store change stored separate lucene index must respect following requirement must present master node must initialised ondemand even scratch case absence must associate indexversion set content store change deletes add must answer efficiently following query given two index version give document content store change sorted commit timestamp asc ideal candidate class index facaded solrcontentstore class dealing filesystem change would also manage lucene index executing operation solrcontentstore would execute collect change flushed new document internal index committracker executes commit existing endpoint master side described search would slightly changed following way commandnotesimpact indexversionreturns version index version generation latest replicatable index specified master slaveno filecontentthe command wont change difference additional content store stream handleryes filelistthere additional content store section would list content store change must synchronized specifically deletes section list item upserts would virtual file something like contentstoreblalbalba corresponds master side optimized stream transferring upserts new add update yes backup restore restorestatus deletebackup fetchindexwe include also configurable fetch include also content store yes enablepoll disablepoll enablereplication disablereplication detailswe include detail content storeno commits content store alfresco concept currently manually backed term design would want backup well however design described document related set functionality although backup management consists set service provided replicationhandler believe better create dedicated issue focus complex aspect slave slave configuration alfresco replication perspective would exactly slave node providing capability builtin handler also indicate absolute path content store root folder workflow slave node would follow existing path slave persist latest applied content store version somewhere file called version version doesnt exist slave get whole content store scheduled interval see pollinterval slave poll master indexversion command order get latest replicateable version master data version slave equal version master nothing happens slave version lesser master version replication start slave issue filelist command retrieving list change index change configuration file change content store change slave asks downloads index file slave asks downloads configuration file slave downloads applies content store add slave executes deletes content store content store version number updated slave solr replication handler actually number indicating version first called indexversion mainly responsible triggering replication process second lucene generation number last active segment lucene index purpose ignore generation indexversion master version lesser slave version something strange happened two index thing replicate whole content store thing happens lucene index consequence new replication mechanism able properly synchronize master slave whole logical index belonging searchservices master node explained includes lucene index datafiles configuration file conf folder contentstore