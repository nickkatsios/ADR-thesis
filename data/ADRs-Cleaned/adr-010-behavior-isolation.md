adr isolating behavior custom element vanilla javascript stage approved adopted adr landed share javascript behaviour vanilla function primer view component pvc primer react prc consumed via react hook prc custom element drive behaviour component perspective adr changed since approval document address change update finding javascript function react hook currently share behaviour across pvc prc javascript function behaviour like focustrap focuszone anchoredposition developed within primerbehaviors imported pvc prc utilised drawback javascript function currently see standard invocation pattern called like function argument take become complex quickly wired manually component requiring passing containing element state theyre difficult engineer apply standard component pattern respective framework example engineer cannot add focustrap component element make trap focus instead engineer must create component call behaviour complexity bear biggest weight primer react add abstraction behaviour hook creates another layer complexity indirection remodelled web component wed vastly simplify lot web component standard invocation pattern adopted component model respective framework see web component wired manually part tree share association mean manage internal state driven component far easily engineer easily drop web component tree add desired behavior example engineer add focustrap element tree make trap focus require additional component hook deliver functionality taking closer look example behaviour clarify looking focustrap example see work container element also know initial focus another element able manage lifecycle focus trap work get abort signal passed argument focustrap function react make slightly easier create loc usefocustrap hook however hook really solve issue state management simplifies creation react ref abort controller ref still managed inside component code come actually implementing usefocustrap hook end supplying ref typically additional management making hook somewhat leaky abstraction additional overhead hook requires documentation test addition doc test already behavior little simpler pvc view component additional behaviour already web component dont concept like ref pas abortcontroller still created help manage lifecycle trap instance component required manage focus trapping focustrap function container attach web component would container would component invoke would component addition web component could manage lifecycle provide far simpler method invocation management state function top complexity there also complexity behaviour properly manage focus trap focustrap function creates two sentinel element appends dom increase complexity debugging code surprising new dom element tree also effect test web component would able utilise shadowdom create clean separation utility element required behavior focustrap example noted exceptional rather representative focuszone similarl usefocuszone hook anchoredposition useanchoredposition behaviour web component would container would lifecycle hook manage internal state would standard invocation pattern wed simply drop focustrap activeisactive component element would manage lifecycle thanks hook browser provides interactive state could managed via react case another modelling behaviour web component simplify application engineer instead requiring engineer understand another hook would fit transparently already understood concept component specifically behaviour like focuszone focustrap make understanding component far simpler component existing within tree component engineer easily understand relationship element component would affect currently opaque current function part tree shadowdom shadowdom preferred way custom element mutate html shadow root encapsulated rest document mean custom element free mutate html within shadowdom wihout disrupting reconciler reacts virtual dom implementation observer mutationobservers document mutation within shadowdom private element framework like react still interact light dom node normally would shadowdom exists browser today power built element like input textarea button video browser build element many element toggled example chrome input underlying shadowdom html placeholder content input content whenever inputplaceholder changed chrome change textcontent dividplaceholder element similarly whenever text input element plain divs textcontent changed happens transparently without userland library like react able influence adr describes complexity around custom element shadowdom state primer react accumulate added complexity implement custom element shadowdom due requirement polyfills today shadowdom well supported across modern browser polyfills required support github property shadowdom githubcom unpolyfilled shadowdom feature multiple year without issue recently primer react added relative time component component shadowdom component work seamlessly component library require additional support library facilitate shadowdom shadowdom within underlying relativetime custom element allows update display localised representation given time without causing mismatch reacts internal representation dom dom update encapsulated away react relativetimes private shadow root also mean react able work reconciling update relativetime component rerendered given datetime prop change allows realtime update component without triggering potentially costly rerenders react ssr server side rendering ssr refers constructing template html string server side delivering html custom element server rendered specifying tag name markup delivered constraint around rendering server behavior entirely client side driven framework server ruby rail partial view component represent custom element markup server reacts core library offer way represent reacts component tree either real dom server way developer either reactdom library client reactdomserver library runtime like nodejs server deliver similar experience traditional server side application built framework like ruby rail sometimes referred isomorphic code unique selling point isomorphic component developer write component execute environment delivering string html server response reconciling dom operation client adr describes complexity around custom element server side rendering claim custom element well supported primer react would accumulate added complexity would surfaced user going claim library may exist usage antithetical custom element pattern primer reacts recent addition relative time component wrapper relativetime custom element demonstrates custom element loaded server side runtime nodejs without causing error adding additional line code element typescript const root typeof globalthis undefined globalthis window typeof window const htmlelement roothtmlelement null unknown typeof windowhtmlelement line could also added global avoid adding element relativetime react component litlabsreact make integrating component react painless requires line code integration typescript const relativetime styledcreatecomponentreact relativetime relativetimeelementsx additional step required consumer primer react component behaves firstclass react component supporting property event regular react component server render custom element tag case relativetime component relativetime client able assign class property callback event expected react require small library like litlabsreact due lack support custom element react likely library custom element shadowdom content rendered either client side element connects dom server side template element allows browser piece together shadowdom content html stream known declarative shadowdom declarative shadowdom always necessary depends case element rendered declarative shadowdom supported chrome safari time writing unreleased technology preview includes dsd support browser dsd polyfill additional line code may additional consideration shadowdom declarative shadowdom shadowdom consideration outside scope document depend component created respect server side rendering shadowdom essence different component client side apis navigator location however blocker adoption respect ssr styling styledcomponents primer react currently cssinjs library called styledcomponents library accumulates object map property runtime create hash digest class name component inject mapped stylesheet page way life javascript object notation within file react component addition primer react also styledsystem allows style property directly within react component prop primer react prop allow customisation style adr describes complexity around styling custom element styledcomponents library claimed custom element must another wrapping element apply style today primer reacts relativetime component styled prop like primer react component styling consideration custom element one consideration custom element always represent node dom tree mean component represent behaviour focustrap influence even interrupt noninheritable property flow document example element focus trapping display flex focustrap component within flex element require focustrap element styled display flex many builtin element require consideration example form datalist picture one mitigation replace nonsemantic element div span within tree custom element another replace semantic element custom element offer similar behavior case relativetime replace time element offer equivalent semantic value incompatibility react tool react includes feature called portal react describes firstclass way render child dom node exists outside dom hierarchy parent component allows react reconcile component tree specific entry point part tree rendered predominant case portal avoid issue around zindex overflow dom node child overflowing parent unable break overflow boundary portal attempt solve simply moving dom node different part dom tree adr claimed custom element citing example detailsdialog detailsmenu make assumption dom tree make incompatible react portal still remains true today nuance also consider generally good practice custom element flexible regard child three common pattern see restricted custom element built element strict association child via manual slot assignment able render direct child node match set criterion creating portal around element work custom element may rely event propagation child portal capture event redistribute accordance react tree reacts synthetic event system creating portal around child custom element may cause issue custom element built element may rely idref pattern custom element pointed another element via attribute example attribute pattern work well react portal custom element unique pointer search single element within entire dom tree child however due way react may add remove element portal lifecycle careful attention paid within custom element ensure observes idref element attacheddetached document many custom element simply issue three pattern may cause issue react portal also come caveat react portal work element special consideration must already made regard existing element example possible create react portal dom element element require strict hierarchy detailssummary ulli dddt may cause issue child element inside react portal get moved another part dom example see detail element provides default summary detail summary element moved react portal cause document structure change also mean accessibility tree change interactive element within portal cause issue focus flow unless large remediation strategy place limit usability react portal either noninteractive element element focus trap given constraint may correct say custom element raise compatibility issue react portal rather react portal must created judicious consideration may create issue within dom tree react portal work around zindex overflow issue problem may better solved existing web platform standard dialog element popover attribute neither introduce caveat consideration react portal extensibility custom element two predominant mode communication ancestor may set attribute element property directly class instance communicate downward intent ancestor may also listen event custom element announce lifetime allow ancestor react react component similar mode communication instead attribute react component prop within react component prop may callback map event common react application also centralised state management centralised state management tool handle memory data dispatch arbitrary point react tree mapped prop adr claimed react hook offer better extensibility interact state driven consumer custom element require listening event document given state management library agnostic underlying framework important acknowledge entirely possible state management library redux mobx many component framework vue svelte react well custom element react component may also directly communicate custom element mechanism react component communicate built element passing prop within jsx complication arises react hard code list attribute map class property list prefixed callback map event example hidden prop element rendered react react look hidden property hard coded loookup table map prop hidden call prop given jsx element hard coded table map setattributename call result stringified reacts support custom event custom attribute robust say preacts entirely possible map attribute event react prop today primer react includes relativetime component litlabsreact library relativetime wrap relativetime custom element automatically map prop directly class instance convert callback prop event listener observe event announcement element way relativetime behaves like written react utilisation litlabsreact library requires line code typescript const relativetime styledcreatecomponentreact relativetime relativetimeelementsx react require small library like litlabsreact due lack support custom element react likely library organizational overhead one consideration around sharing code one implementation primer organisational overhead adr enumerates concern around development including issue developing multiple repository handling depdencies npm link also enumerates concern around orchestrating release mostly concern around available tooling across multiple repository scope issue intrinsic shared code however example sharing code done within monorepo scope discussion adr adr raise another concern around development contribution regard familiarity working react also familiarity working custom element well requirement developer switch primer view component library serve example handling concern today primer view component successfully integrating authoring component custom element multiple year primer behaviour library also serve example handling concern today primer view component primer react component utilise primerbehaviors library manage shared code one concern come regard custom element global registry tag name hook behaviour given page one custom element definition given tag name time example cannot two different version relativetime relativetime tag github custom element since many component breaking change weve found limitation issue said possible remediate issue several way naming tag differently version library organizational overhead shared dependency something address future regardless utilise custom element addressed later adrs scope adr mandate remediation strategy shared dependency custom element may custom element share behaviour pvc prc existing built html element provide necessary semantics required continue say custom element provide standin element page client side behaviour benefit shadowdom custom element decided custom element adr conclude custom element written enforce language tooling adr enforce custom element must written circumstance merely decides may chose technology see fit repository adr conclude custom element live may continue existing set custom element various repository may write custom element monorepo enforced adr rewrite adr conclude rewrite existing component behavior today may consider custom element refactors adr enforce rewrite existing code consequence litlabsssr today introduce new dependency primer react may removed later react support custom element box seems likely react continue ship dependency may expediate resolve organisational overhead issue deciding custom element share code among pvc prc may highlight area addressed subsequen