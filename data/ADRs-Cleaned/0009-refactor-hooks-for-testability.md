refactor hook testability adr currently repohooks class remains largely untested due combination two factor method class static contract called defined hook extensionjson global variable entrypoints extensionswikibaserepowikibasephp mean cannot easily refactor method increase testability method rely heavily wikibaserepo singleton store make harder test way inject mock wikibaserepo without dependency injection rfc enabling dependency injection hook currently way however interim solution needed order mitigate amount untested logic exists file place codebase reviewing issue two initial solution considered refactor repohooks singleton instantiated inject mock wikibaserepo instead real deal adopt pattern wikibaseclient enables mock several part namely store replace real store creating overridestore method see following clienttestsphpunitincludesmockclientstorephp clienttestsphpunitincludesdataaccessparserfunctionspropertyparserfunctionintegrationtestphp however discussion decided implement middle ground would enable gradually refactor hook rather one time big change decided adopt existing pattern wikibase repo hook handler get singleton class provides least four method constructor make dependency injection easier public static method bootstrap instance global setting consistency would typically named newfromglobalsettings optional public static method get cached instance handler object rather instantiate time useful hook handler called several time public static method wire functionality hook system contain little logic hard test without complete integration test public method perform actual handler logic testable way class placed includeshooks directory example pattern seen httpsgerritwikimediaorgrcmediawikiextensionswikibase consequence increase ability test code hook well general test coverage deciding single source truth regarding hook encourage common understanding help newcomer code refactor write hook decoupling test actual store might make test run faster connection database read writes made adopting pattern regarding testing hook help guide refactoring writing new piece code considered hard test doesnt provide pattern endtoend testing hook running public static method hook wiring isnt covered pattern