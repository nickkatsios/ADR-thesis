subject transform metadata value author jnmoyne derekcollison tbeets implemented tag server problem statement part multiple technical implementation nats server create mapping formula transform applied input subject yielding desired output subject transforms part core nats subject mapping account level jetstream stream definition jetstream sourcing jetstream republish crossaccount service stream mapping shadow subscription across leaf subject transform shall defined source filter defines input subject eligible via match transformed destination subject mapping format defines notional subject filter transformed output subject match input subject token match source wildcards survive transformation input mapping function whose output build output subject design destination taken together source form valid subject token transform resulting transform applied input subject match source subject filter determine output subject weighted clusterscoped mapping case core nats subject mapping account level actually one mapping destination per source mapping weight percentage total weight percentage indicate likeliness mapping furthermore weighted mapping clusterscoped meaning also create mapping destination total per cluster name apply take precedence server part cluster specified allows administrator define mapping change depending upon cluster message initially published example consider following mapping foo destinationfoowest weight cluster west destinationfoocentral weight cluster central destinationfooeast weight cluster east destinationfooelsewhere weight mean application publishing message subject foo result message published core nats subject foowest application connected server west cluster foocentral application connected server central cluster fooeast application connected server east cluster also define worth destination catchall server apply cluster supercluster server running clustered mode example message published cluster south would mapped fooelsewhere transform rule given input subject must match source filter usual subscriptioninterest way transform valid valid input subject sourcematching literaltoken position ignored usable mapping function sourcematching wildcardtoken position mapping function transform destination format sourcematching wildcard single token token passed destination mapping function wildcard cardinal position number wildcardx notation number first instance wildcardtoken source filter instance wildcardtoken source filter sourcematching wildcard multi token token mapped respective position destination format literal token destination format mapped output subject unchanged position value wildcardtokens transforms source transforms defined interaccount import stream service destination must make wildcardtokens present transforms source however starting version transforms place core nats account mapping subject transforms stream stream import stream republishing allowed drop number wildcardtokens mapping function mapping function placed transform destination format subject token format mappingfunction legacy notation equivalent wildcardx still supported backwards compatibility note mapping function name valid upper camelcase lower case wildcard wildcard valid transforms defined interaccounts import stream service allowed mapping function wildcardx legacy list mapping function currently following mapping function available wildcardx output value token wildcardtoken index equivalent legacy notation partitionxabc ouputs partition number assigned deterministic hashing value wildcardtokens splitxy split value wildcardtoken multiple token presence character splitfromleftxy split two value wildcardtoken character starting left splitfromrightxy split two value wildcardtoken character starting right slicefromleftxy slice multiple token value wildcardtoken every character starting left slicefromrightxy slice multiple token value wildcardtoken every character starting right example transforms input subject source filter destination format output subject onetwothree uno unoonetwothree fourfivesix eins einsfourfivesix onetwothree onetwothree fourfivesix einszweidreivier einszweidreivierfourfivesix onetwothree one uno unotwothree onetwothree onetwo unodosunodosthree oneoneunouno onetwothreefourfiveonethreefiveunounofourtwo onetwothreefourfiveonethreefiveunowildcardwildcardunofourtwo onetwothreefourfivetwothreeunounoonefourfive abcdefghijsplitabcdefghi splitfromleft splitfromright slicefromleft slicefromright note nats cli provides utility server mapping experimenting different transforms input subject