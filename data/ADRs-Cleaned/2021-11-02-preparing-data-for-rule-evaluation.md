title preparing data rule evaluation area servicessettings tag framework rule datahandling creating new rule definition consider retrieving data necessary evaluation since rule could possibly evaluated given request data evaluation must also present time circumstance cause carefully consider performance regard additional database query storing data beforehand instance rule always able evaluate based data retrieved instance rulescope instance provides getters saleschannelcontext instance datetimeimmutable current time everything evaluated derived method instance data necessary evaluation cant already retrieved method saleschannelcontext least favorable add additional association criterion dal search saleschannelcontextfactory unless additional association needed anyways much wider scope preferred always indexer updater service indexer data absolutely necessary evaluation stored part target entity definition data persisted asynchronously within message queue kept background process avoid additional database query storefront request consequence make sure rulescope doesnt already provide necessary data evaluate rule youre trying match whether target entity specific manytoone onetoone association corresponding fkfield target definition match association youre trying match whether target entity specific manytomany association corresponding manytomanyidfield manytomanyidfield association yet evaluate rule matching association always prefer adding manytomanyidfield definition seeking alternative solution adding manytomanyidfield make sure target entity indexer call manytomanyidfieldupdater writing indexerupdater service rule evaluation absolutely data association rule evaluation create existing service indexing said data consider following writing service updating indexed field indexed data contains multiple value per entity jsonfield store updater service plain sql make sure updater service handle updating great number row best possible performance make sure updater service also called update accordingly deletion data upon index data based indexed data also relies state target entity make sure updater service also called change target entity update indexed data accordingly data indexed inherited parent make sure also consider involving parent plain sql update field containing preindexed data