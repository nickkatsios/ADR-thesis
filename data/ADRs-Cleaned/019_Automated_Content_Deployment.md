automated content deployment deciders abban dunne corinna hillebrand gabriel birke technical story httpsphabricatorwikimediaorgt problem statement want automatically deploy fundraising content repository whenever change git commit test production branch destination server associated branch driver security reason want host system deployment infrastructure repository consists several file want deployment atomic application either new set file old one never mix three production server receive new version simultaneously although atomically would like system notify via email deployment failed would like record log file successful deployment ansible playbook atomic deployment test production server dockerfile definition package ansible deployment playbook server configuration standalone docker image deployment software run docker image deployment prefer configuration code setting workflow gui maintenance onboarding effort system low possible optional would nice button trigger deployment optional would nice feature branch application repository could associated feature branch content repository instead test considered cronjob git pull gitlab pipeline selfhosted jenkins drone ansible web gui custom webhook script outcome chosen drone benefit outweigh drawback see pro con cronjob git pull dismissed meet requirement atomic deploys gitlab pipeline dismissed meet requirement keep credential ssh key infrastructure premise selfhosted jenkins automated content deployment setup maintenanceintensive especially codeasconfiguration complex switched infrastructure provider abandoned solution setting would much effort drone created drone setup automated deployment point setup prototype stage security tweak documentation system two webhooks ansible runner repository contains dockerfile setup content repository docker image ansible runner deploy content pro con good standard software thats active development good drone fit well dockerbased approach good working prototype good could reuse deployment future good learning opportunity bad much whole system small portion creates onboarding yaml syntax setup maintenance effort bad company harness bought project might linger change focusdirection even open source project ansible web gui ansiblebased deployment cicd system configuration language wrong tool job http trigger ansible playbook software system ansible awx rundeck semaphore polemarch nciansiblegui good right tool job good reuse deployment bad added complexity additional functionality product bad effort required pick right product configure custom webhook script script would expose http endpoint following step verify github authentication token parse webhook request check repository branch match configured deploy destination pull newest version ansible runner image run ansible runner image deploy parameterized branch optional rate limit request max per minute avoid abuse would automatically build ansible runner via gitlab would add another step deploy playbook involves notification failure veryfication parsing request httpspackagistorgpackagesswopgithubwebhook open question communicate docker cant docker cli dont want allow web server access security reason wed investigate php library communicate docker encrypted tcp socket certificate good low maintenance effort good low onboarding effort complexity bad unforeseen risk could occur development