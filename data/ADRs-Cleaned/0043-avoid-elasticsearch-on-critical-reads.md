avoid elasticsearch critical read lazy consensus implemented scope distributed james user willing webmail powered jmap protocol end following operation mailboxget retrieve mailbox call resolved metadata stored cassandra emailquery retrieve list email call nowadays resolved elasticsearch email search right resolution pas cassandra emailget retrieve various level detail depending requested property either retrieved cassandra alone objectstorage elasticsearch queried every jmap interaction listing email administrator thus enforce availability good performance component relying service every read also harm resiliency elasticsearch outage major impact also mention elasticsearch implementation distributed james suffers following flaw update flag lead update email object leading sparse segment currently rely scrolling jmap order ensure messageid uniqueness response respecting limit position noticed slow trace elasticsearch even simple query regarding distributed james datastores responsibility cassandra source truth metadata storage adapted known access pattern elasticsearch allows resolution arbitrary query performs full text search provide optional view common emailquery request draft rfc implementation includes filter sort sentat view stored cassandra updated asynchronously via mailboxlistener consequence migration task provided new adopter administrator would offered configuration turn view needed enabled given client following well defined emailquery request administrator would longer ensure high availability good performance elasticsearch ensure availability basic usage mailbox content listing given prerequisite thus expect decrease overall elasticsearch load allowing saving compared actual deployment furthermore expect better performance resolving query cassandra expected added load cassandra low search simple cassandra read store messageid cassandra dataset size grow percent enabled alternative willing adopt view affected disabling listener view usage keep resolving emailquery elasticsearch another solution implement projecting inmemory datagrid infinispan projection would computed mailboxlistener data would first fetched cache fallback elasticsearch choose cassandra already well mastered disk storage cheaper memory infinispan would moreover additional datastore allow persistent state infinispan hand would faster would restriction data filtering sorting also would require one software dependency example optimized jmap request email list sorted sentat limit rfc emailquery accountid caecbefcbfbaffcaaeddacdcaf filter inmailboxabcd comparator propertysentat isascending false position limit draft getmessagelist filterinmailboxes abcd sort desc email list sorted sentat limit given receivedat rfc emailquery accountid caecbefcbfbaffcaaeddacdcaf filter inmailboxabcd adate comparator propertysentat isascending false position limit draft draft expose single property thus differenciate sentat receivedat draft adopts sentat back property thus request cannot written draft syntax email list sorted sentat limit given sentat draft getmessagelist filterafteradate inmailboxes abcd sort desc rfc filter property targeting sentat thus request cannot written cassandra table structure several table required order implement view top cassandra eventual denormalization consistency enforced batch statement table allows sorting message mailbox sentat allows answering table emailqueryviewsentat primary key mailboxid clustering column sentat clustering column messageid ordered sentat table allows filtering email receivedat given limited number result soft sorting limit applied sentat column allows answering table emailqueryviewsentat primary key mailboxid clustering column receivedat clustering column messageid column sentat ordered receivedat finally upon deletes receivedat sentat known thus provide lookup table table emailqueryviewdatelookup primary key mailboxid clustering column messageid column sentat column receivedat note handle position limit fetch position limit ordered item removing position first item reference jira discussing adr