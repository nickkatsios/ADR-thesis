edgex metric collection approved original proposal approved tsc metric telemetry data defined count rate action resource circumstance edgex instance specific service example metric include number edgex event sent core data application service number request service api average time take process message application service number error logged service control plane event cpe defined event occur within edgex instance example cpe include device provisioned added core metadata service stopped service configuration changed cpe confused core data event core data event represent collection one sensordevice reading core data event represent sensing measured state physical world temperature vibration etc cpe represents detection happening inside edgex software adr outline metric telemetry collection handling note adr initially incorporated metric collection control plane event processing edgex architect felt scope design large cover one adr control plane event processing covered separate adr future system management service sma executor currently provide limited set metric requesting client party application system external edgex namely provides requesting client service cpu memory usage metric resource utilization service executable versus metric happening inside service arguably current system management metric provided container engine orchestration tool example docker engine underlying tooling info sma deprecated since ireland release removed future yet named release going forward user edgex want insight metric telemetry happening directly service task preforming word user edgex want telemetry service activity include sensor data collection much fast etc command request handled many device etc sensor data transformation done application service fast filtered etc sensor data export much sent many export failed etc api request often quickly many success versus failed attempt etc bootstrapping time time come available service activity processing time amount time take perform particular service function respond command request definition metric telemetry data defined count rate action resource circumstance edgex instance specific service example metric include number edgex event sent core data application service via message bus via device service application service ireland beyond number request service api average time take process message application service number error logged service collection dissemination metric data require internal service level instrumentation relevant service capture send data relevant edgex operation edgex currently offer service instrumentation metric first step implementation metric data edgex make metric data available subscribing party application system necessarily consume information future edgex may consume metric data example edgex may future metric number edgex event sent core data app service mean throttle back device data collection future edgex application service may optionally subscribe service metric message bus attaching appropriate message pipe service thus allowing additional filtering transformation endpoint control metric data service point feature supported consideration would made whether event sensor reading message metric message application service time edgex persist metric data except may retained part message bus subsystem mqtt broker consumer metric data responsible persisting data needed external edgex persistence metric information may considered future based requirement adopter demand feature general edgex metric meant provide internal service external application system better information happening inside edgex service associated device communicates requirement service push specified metric collected service specified configuration message endpoint supported edgex message bus implementation currently either redis pubsub mqtt implementation supported service configuration specifies message endpoint service metric metric message topic communication may secured unsecured application service provide mean export secured unsecured message pipe today configuration placed writable area user wish change configuration dynamically turning onoff metric consul change service configuration indicates metric available service service configuration allows edgex system manager select metric word providing configuration determines metric collected reported default metric turned default setting service report metric metric turned service collect sends metric designated message topic metric collection must pushed designated message topic appointed schedule schedule would designated configuration done way similar auto event device service initial implementation one scheduled time metric collected pushed designated message topic future may desire set separate schedule metric deemed complex initial implementation info initially proposed metric associated level allow metric turned level like level associated log message logging level metric data seems arbitrary time considered complex initial implementation may reconsidered future release based new requirementsuse case also proposed categorize label metric essentially allowing grouping various metric would allow group metric turned allow metric organized per group reporting time feature also considered beyond scope initial implementation reconsidered future release based requirementsuse case also proposed service offer rest api provide metric collection information metric collected ability turn collection dynamically deemed scope first implementation may brought back case requirement demand requested metric following list example metric requested edgex community adopter various service area metric would generally collected pushed message topic configured interval example minute defined interval sample metric thought relevant work group may reflect metric supported implementation exact metric collected service determined service implementers sdk implementers case app function device service sdks general following metric apply service service uptime time since last service boot cumulative number api request succeeded failed invalid avg response time millisecond appropriate unit measure apis avg max request size coresupporting latency measure time event take get core data latency measure time command request take get device service indication health event processed configurable period number event persistence number reading persistence number validation failure validation device identification number notification transaction number notification handled number failed notification transmission number notification retry application service processing time pipeline latency measure time event take get application service pipeline access time often failing export sent retried later time current store forward queue size much data size packaged sensor data sent endpoint volume number invalid message triggered pipeline number event processed device service number device managed device request may informative reading count rate note envisioned may additional specific metric device service example onvif camera device service may report number time camera tampering detected security security metric may difficult ascertain cross service metric given nature design per service basis global security metric may scope security metric collection copied service leading lot duplicate code also true threat detection based metric may feature best provided party based particular threat security profile number api request denied due wrong access token kong per service within given time number secret accessed per service name count access failure data persistence layer count service start restart attempt design proposal collect push architecture metric data collected cached service designated time kicked configurable schedule service collect telemetry data cache push designated message bus topic metric messaging cached metric data designated time marshaled message pushed preconfigured message bus topic metric message consists several keyvalue pair required name name metric serviceuptime required value telemetry value collected number hour service required timestamp time epoch timestampmilliseconds format data collected similar nature origin sensed data optional collection array tag tag set keyvalue pair string provide amplifying information telemetry tag may include originating service name unit measure associated telemetry value value type value additional value metric one value example histogram would include min max mean sum value metric name must unique service metric reported multiple service service uptime name required unique across service information key value tag etc string format placed json array within message body example representation example metric message body single value json nameserviceup value timestamp tagsservicecoredatauomdaystypeint example metric message body multiple value json nameapirequests value timestamp tagsservicecoredatauomcounttypeint mean rate raterate info key metric name must unique gometrics requires metric name unique per registry metric considered immutable configuration configuration unlike provided core data device service specify message bus type location metric message sent fact message bus configuration reuse service already message bus common message bus configuration defined common configuration service message queue configuration inclusive metric yaml messagequeue protocol redis tcp host localhost port type redis mqtt publishtopicprefix edgexeventscore standard existing core device topic publishing messagequeueoptional default mqtt specific enable environment variable override client identifier clientid devicevirtual connection information qos quality service value least exactly keepalive second must greater retained false autoreconnect true connecttimeout second skipcertverify false certkey file certkey pemblock specified additional configuration must provided service provide metric telemetry specific configuration area configuration likely different type service additional metric collection configuration provided include trigger collection telemetry metric cache sending appointed message bus define metric available turned false default list metric likely different per service key list metric name true false value specify metric topic prefix metric data published providing prefix edgextelemetrytopic name service metric name servicenamemetricname appended per metric allowing subscriber filter service metric name metric configuration defined writable area configurationtoml allow dynamic change configuration consul specifically writablewritabletelemetry area dictate metric collection configuration like yaml writable writabletelemetry interval publishtopicprefix edgextelemetry servicenamemetricname added publish topic prefix available metric listed metric listed false default serviceup false apirequests false info discussed future edgex release service may want separate message bus connection example one sensor data one metric telemetry data would allow qos setting message bus connection different would allow sensor data collection example messaged higher qos metric alternate approach could modify gomodmessaging allow setting qos per topic thereby avoid multiple connection initial release feature service connection therefore configuration metric telemetry well sensor data library support service gomodmessaging support golang service equivalent service service would determine metric collect push message bus common library chosen edgex language supported currently gometrics golang library publish application metric would allow edgex utilize versus construct library utilized thousand project provides mean capture various type metric registry sophisticated map metric published reported number well known system influxdb graphite datadog syslog gometrics library made original java package httpsgithubcomdropwizardmetrics similar package would selected created per core meeting important provide implementation adopter edgex see difference whether metricstelemetry collected service configuration metric service structure based metric collection mechanism service specifically provided device service sdk may operate differently cover configuration resulting metric message edgex message bus must formattedorganized consideration gometrics golang library library would provide package service expectation parity service may difficult achieve given feature gometrics gometrics still require edgex team develop bootstrapping apparatus take metric configuration register metric defined configuration gometrics gometrics would also require edgex team develop mean periodically extract metric data registry ship via message bus something current gometrics library gometrics offer ability data reported system would required edgex expose capability possibly apis user wanted export subsystem addition message bus per kamakura planning meeting noted gometrics already dependency code due party package see httpsgithubcomedgexfoundryedgexgoblobfddafbcbccffbeaccgosuml community question gometrics per monthly architect meeting manages telemetry data persistence memory database etc memory registry essentially keyvalue store key metric name offer query api order easily support adr suggested rest api yes metric stored registry metricregistry essentially map get getall method provided query metric gometrics package feature become requirement side dozen type metric collection simple gauge counter sophisticated structure like histogram stored registry map data made available report export publish various integrated package influxdb graphite datadog syslog etc nothing mqtt base message service would implemented scratch metrictelemetry count reset needed happen whenever post message bus would work rest yes unregister reregister metric rest api would constructed call capability gometrics another library called opencensus multilanguage metric library including library feature rich opencensus also roughly size gometrics library additional open question consideration given allow metric placed different topic per name add topic name like device name device service future consideration consideration given incorporate alternate protocolsstandards metric collection httpsopentelemetryio httpsgithubcomstatsd metric already library pulled service package may side implementation per monthly architect meeting decided gometrics service creating library open census service either findpick package provides similar functionality gometrics implement internally something providing mvp capability gometrics help avoid much service bloat since already service per monthly architect meeting decided implement metric service first per monthly architect meeting decided support rest api service would provide information metric service provides ability turn instead writable configuration allow consul mean change configuration dynamically adopter chooses consul configuration regard metric collection configuration circumstance would static external api requested future external tool rest api may added see older version idea implementation case per core working group meeting many previous meeting adr decided edgex approach one push via message busmqtt pull rest api approach require service collect metric telemetry specific service collecting service must either push onto message topic message cache memory storage mechanism depending whether storage durable allow rest api call would cause data pulled cache provided response rest call given mechanism require collection process belief push probably preferred today adopter future highly desired pull rest api could added along cache metric telemetry pull per core working group meeting importantly edgex making metric telemetry available internal edgex message bus adopter would create something pull data bus way voiced several call important adopter realize today edgex providing last mile metric data adopter must provide last mile pick data topic make available system something per core working group meeting many previous meeting adr decided prometheus prometheus library mean provide metric reason many push pull favored first implementation see point also see similar debate online plusesminuses approach edgex want make telemetry data available without dictating specific mechanism making data widely available specific debate centered prometheus popular collection library inside service collect data well monitoring system watchdisplay data prometheus popular open source approach felt many organization choose influxdbgrafana datadog appdynamics cloud provided mechanism homegrown solution collect analyse visualize otherwise telemetry therefore rather dictating selection monitoring system edgex would simply make data available whereby organization could choose monitoring systemtooling noted edgex approach merely make telemetry data available message bus prometheus approach would provide collection well backend system otherwise collect analyse display etc data therefore typically work done adopter get telemetry data proposed edgex message bus solution something reporter come gometrics allow data taken directly gometrics pushed intermediary prometheus monitoringtelemetry platform referenced capability may well supported beyond scope edgex adr however even without reporter felt relatively straightforward exercise part adopter create application listens edgex metric message bus make data available via pull rest api prometheus desired prometheus client library would added service would bloat service although available benefit gometrics already hashicorp consul already service implementation detail gometrics package offer following type metric collection gauge hold single integer int value example number notification retry operation update gauge get gauge value example code metricsnewgauge gupdate set value gupdate set value fmtprintlngvalue print current value gauge counter hold integer count counter could implemented gauge example current store forward queue size operation increment decrement clear get counter count value metricsnewcounter cinc add one current counter cinc add current counter making cdec decrement counter making fmtprintlnccount print current count counter meter measure rate int event time one five fifteen minute interval example number rate request service api operation provide total count event well mean rate minute rate metricsnewmeter mmark add one current meter value timesleep timesecond allow time mmark add one current meter value timesleep timesecond allow time mmark add one current meter value timesleep timesecond allow time mmark add one current meter value timesleep timesecond allow time fmtprintlnmcount print fmtprintlnmrate print fmtprintlnmrate print fmtprintlnmrate print fmtprintlnmratemean print histogram measure statistical distribution value int value collection value example response time apis operation update get min max count percentile sample sum variance collection metricsnewhistogrammetricsnewuniformsample hupdate hupdate hupdate hupdate fmtprintlnhmax print fmtprintlnhmin print fmtprintlnhmean print fmtprintlnhcount print fmtprintlnhpercentile print fmtprintlnhvariance print fmtprintlnhsample print timer measure rate particular piece code called distribution duration example often app service function get called long take get function operation update get min max count rate rate rate mean percentile sum variance collection metricsnewtimer tupdate timesleep timesecond tupdate timesleep timesecond tupdate timesleep timesecond tupdate timesleep timesecond fmtprintlntmax print fmtprintlntmin print fmtprintlntmean print fmtprintlntcount print fmtprintlntsum print fmtprintlntpercentile print fmtprintlntvariance print fmtprintlntrate print fmtprintlntrate print fmtprintlntrate print fmtprintlntratemean print note gometrics package offer variant like gaugefloat hold bit float consequence global configuration turn metric offon edgex doesnt yet global config service given potential service publishes metric message topic implementation unless service different pipe topic allow multiple publisher like app service implementation allow service sends different topic probably avoid service bloat edgex enterprise system implement concise economical way metric help side since already module edgex module brought default care concern must given cause much bloat side sma report service cpu memory configuration provides mean startstoprestart service currently outside scope new metric collectionmonitoring future party mechanism offer capability sma may warrant sma irrelevant existing notification service serf send notification via alternate protocol outside edgex communication service provided generic communication instrument micro service independent type data concern future notification service could configured subscriber metric message trigger appropriate external notification via email smtp etc reference possible standard implementation open telemetry statsd gometrics opencensus