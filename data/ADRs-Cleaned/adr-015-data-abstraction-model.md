architecture record data abstraction model application store manipulate data current state art clojure usually done straightforward adhoc way user write schema interact database parse data user input persistence format explicit code acceptable youre writing custom concrete application scratch work arachne arachnes module able read write domain data also compatible multiple backend storage module example userpassword based authentication module able read write user record application database work whether user datomic sql nosql database word arachne cannot function well world every module required interoperate directly one several module instead way module speak common language data manipulation persistence case data persistence isnt concern many situation common abstract data model highly useful include quickly defining api endpoint based data model html mobile form generation generalized data validation tool unified administration metric tool modeling manipulation actually two distinct concept play data modeling data manipulation modeling activity defining abstract shape data essentially writing schema way specific concrete implementation module data model generate concrete schema generate api endpoint form validate data etc manipulation activity model create read update delete actual data abstract data manipulation layer generally mean polymorphic api support common set implementation extended concrete crud operation existing solution orms framework answer problem rail activerecord elixir ecto oldschool java hibernate etc every case try paper look like access actual database provide idiomatic api language read persist data languagelevel api uniformly designed make database easy also effect providing common abstraction point extension unfortunately orms also exhibit common set problem nature extra level indirection provide abstraction given complex database abstraction always leaky significant way effectively requires thorough understanding orms apis also underlying database implementation orm map data one format another orms also tied tightly relational model attempt extend activerecord example nonrelational data store varying level success database migration one function make sure concrete database schema match abstract data model application orms implement form database migration serve repeatable series change made database ideally redundant abstract data model avoid repeating information twice also ensure consistency arachne provide lightweight model data abstraction persistence oriented around entityattribute mode avoid word salad acronym loaded baggage false expectation give semantically clean name free define name set expectation around suggest chimera keeping greek mythology theme several relevant connotation chimera consists two part entity model allow application author easily specify shape domain data arachne configuration set persistence operation oriented around plain clojure data map set vector implemented meaningfully multiple type adapter individual operation granular consumed provided carte adapter dont support certain behavior omit cost compatibility module although support arbitrary database cannot guaranteed persistence operation designed support majority commonly system including relational sql database document store tuple store datomic nosql type system data model level chimera powerful easy way specify structure data data module read data expose new functionality driven application domain model flexible enough projected schema diverse type adapter customizable enough configured adapt existing database installation adapter chimera adapter arachne module take abstract data structure operation defined chimera extend specific database database apis jdbc datomic mongodb etc applicable also abstract adapter bulk work adapting chimera particular genre database example keyvalue store similar semantics core operation likely keyvalue adapter bulk work adapting chimera operation keyvalue storage several thin concrete adapter implement actual getput command cassandra dynamodb redis etc limitation drawback chimera designed make limited set common operation possible write generically cannot ever complete interface every database application developer understand native apis selected database dedicated wrapper module expose full power selected technology chimera represents single dimension functionality entityattribute model definition cannot provide access unique powerful feature different database provide user ought leverage also important recognize problem even problem module might want tackle chimera basic entityattribute model simply good fit entity model isnt good fit chimera instead find write arachne module defines data modeling abstraction better suited task hand example application might good fit chimera include extremely sparse wide data dynamic data cannot predefined attribute structure unstructured heterogeneous data large binary sampling data data cannot indexed requires distributed streaming data processing handle effectively modeling data model arachne application like everything else data configuration chimera defines set dsl form application author define data model programmatically course module also read write modify definition part normal configuration process note configuration schema including schema data model defined chimera requires special bootstrapping core module also implies arachne core dependency chimera mean module required chimera chimera special relative conceivable data model mean good fit modeling kind data stored configuration modeling entity type entity type entity define structure content domain entity entity type specify set optional required attribute entity type must entity type may one supertypes semantically supertypes imply entity instance subtype also instance supertype therefore set attribute valid required entity attribute type ancestor type entity type define data structure object class define method behavior addition defining structure entity entity type additional config attribute serve implementationspecific hint example entity type could attribute override name sql table persistence config attribute would defined sql module chimera basic attribute entity type defined chimera name type namespacequalified keyword supertypes may attribute applied entity type attribute definition attribute definition entity define type value associated entity specify name attribute namespacequalified keyword min max cardinality attribute thereby specifying whether required optional type allowed value see section value type whether attribute key value key attribute expected globally unique guaranteed present serve way find specific entity matter underlying storage mechanism whether attribute indexed primarily hint underlying database implementation like entity type attribute definition may number additional attribute modify behavior implementationspecific way value type value attribute may one three type reference value entity attribute must specify entity type target entity component reference added semantic implication value entity logical part parent entity retrieved automatically along parent also deletedretracted along parent entity primitive simple atomic value primitive may one several defined type map directly primitive type jvm boolean jvm javalangboolean string jvm javalangstring keyword clojure clojurelangkeyword bit integer jvm javalanglong bit floating point decimal jvm javalangdouble arbitrary precision integer jvm javamathbiginteger arbitrary precision decimal jvm javamathbigdecimal instant absolute time millisecond resolution jvm javautildate uuid jvm javautiluuid byte jvm byte array since storage support binary data might serialize base fairly small set primitive represent reasonable common denominator supportable target database note set closed module specify new primitive type logically subtypes generic primitive entirely new type also defined caveat work adapter implementation defined validation attribute name namespacequalified keywords spec registered keywords validate corresponding value clojure requires namespace loaded spec defined globally registered ensure relevant spec loaded application run chimera provides config attribute specify namespaces containing spec arachne ensure namespaces loaded first module author ensure spec loaded needed chimera also provides generatespec operation programmatically build spec given entity type validate full entity map type schema migration operation order data persistence actually work schema particular database instance least schema compatible application data model defined chimera entity type attribute see adr indepth discussion database migration work ramification chimera data model declared configuration entity manipulation previous section discussed data model define general shape structure entity application entity manipulation refers operation available create read update delete specific instance entity data representation domain entity represented application code simple clojure map function chimera entity pure data object required support additional protocol entity key restricted namespacequalified keywords correspond attribute name defined configuration see attribute definition key ignored chimera operation value may clojure value subject spec validation certain operation cardinalitymany attribute must clojure sequence even one value reference value represented one two way nested map lookup reference nested map straightforward example myapppersonid myapppersonname bill myapppersonfriends myapppersonid myapppersonname joe lookup reference special value identify attribute must key value indicate target reference chimera provides tagged literal specifially lookup reference myapppersonid myapppersonname bill myapppersonfriends chimerakeymyapppersonid chimera operation return data one representation representation largely equivalent important note passing nested map persistence operation intended semantics nested map must parent map example cannot call create expect toplevel entity created nested entity updated entity explicitly declare entity type type may derived inspecting set key comparing entity type defined configuration persistence operation following basic operation defined get given attribute name value return set matching entity map database result guaranteed found unless attribute indexed result may truncated efficiently returned create given full entity map transactionally store database adapter may throw error entity key attribute value already exists update given map attribute value update attribute provided attribute new value map must contain least one key attribute also take set attribute name deletedretracted entity adapter may throw error entity exists given key delete given key attribute value remove entity attribute component operation transactional possible adapter cannot provide transactional behavior operation note fact clearly documentation user make false assumption integrity system operation protocol may required module satisfied adapter carte thus module require full set operation still work adapter long satisfies operation set operation exhaustive module adapter free extend chimera define additional operation different stricter semantics operation possible implement consistently reasonably performant way broad enough set different type database make possible composed flexibly operation expressed data direct method capability model adapter must specify list operation support module validate list runtime ensure adapter work operation require addition specifying whether operation supported adapter must specify whether support operation idempotently andor transactionally proposed consequence user module define shape structure domain data way independent particular database type database module perform basic data persistence task databaseagnostic way module restricted severely limited subset data persistence functionality relative database natively common data persistence layer optional easily bypassed good fit set data persistence operation open extension specable namespaced keywords pervasively straightforward leverage spec heavily validation testing seed data generation