elasticsearch node certificate management update decided simplify way handle selfsigned certificate node private key still managed operator signed operator passed pod secret directly main benefit remove complexity csr init container outlined proposal also handle set certificate transport protocol another set http protocol userprovided certificate also supported proposed deciders team problem statement productiongrade elasticsearch setup must set certificate even important kubernetes cluster running service could misbehave impersonate elasticsearch node manage node certificate operator driver security node private key signed private key node stored way hard obtain andor decipher certificate rotation easily doable design pod access kubernetes api directly ease human operator intervention running operator regarding certificate management restricted minimum ideally human operator care cluster impact certificate rotation provoke downtime cluster certificate rotation preferably doable without wellwritten client experiencing issue certificate validation considered operator retrieves csrs pod issue certificate secret volume mount operator cluster certificate authority cluster manages able issue certificate based certificate signing request csr pod provide manages one certificate associated private key per cluster operator manages cluster different namespaces different issuing certificate reconciliation loop operator decide issue signed certificate given pod make sense issue new certificate certificate pod created existing certificate expired existing certificate invalid corrupted existing certificate match current wish rotate certificate certificate created secret apiserver mounted pod secret volume mount pod elasticsearch able provided certificate file secret updated elasticsearch updated file disk automatically pretty great feature unfortunately software dont work way require restart pick new certificate kibana example require restart private key private key cluster important secret whole mechanism must well hidden accessible operator whereas certificate sensitive private key generated operator start first cluster reconciliation kept inmemory lifecycle operator operator restarts generate new private key issue new certificate cluster existing tcp connection node impacted might provoke downtime cluster new certificate propagated private key stored secret apiserver created operator exist yet persisted reuse operator restarts similar private key wrapped another layer encryption apiserver access kek key encryptionkey must handled separately private key stored external service vault requested provided operator startup preferable setup additional system secure lead downtime herd effect operator restarts regenerate certificate secure consider apiserver storage secure enough pod private key pod must private key several considered operator generates private key pod store apiserver secret mount pod secret volume major drawback pod private key stored single place apiserver operator generate csr issue certificate private key pod responsible generate private key csr startup init container csr retrieved operator issue certificate private key never leaf elasticsearch pod shared init container elasticsearch pod chosen one complex implement secure retrieving pod csrs considering elasticsearch pod created private key csr startup operator must able retrieve csr order issue certificate csr secret information public long private key stay private pod several considered involving init container pod init container store csr apiserver operator pick similar done bootstrap kubernetes node already builtin certificatesigningrequest resource available advantage builtin mechanism operator watch csr resource order issue new certificate drawback pod must able reach apiserver service account appropriate permission far required considering custom plugin could run elasticsearch process allowing request apiserver might represent security issue init container request operator api operator send csr disadvantage similar implicitly authorize pod reach operator even though restricted single endpoint additional possible flow could lead security issue init container run http server serve generated csr operator request csr api advantage pod reach service disadvantage additional complexity design implementation chosen one detail actual workflow check certinitializer readme pod certificate rotation possible reuse previous csr issue new certificate order must way retrieve pod csrs retrieved first time store csr apiserver secret certificate retrieved apiserver request pod csr requires endpoint available sidecar container init container chosen simpler implement pod private key rotation might easily able rotate pod certificate reusing csr different one generated private key however pod private key might get compromised consider keep sidecar container running pod handle private key rotation notified operator rotate private key make create new private key create csr new private key wait new certificate issued temporary place replace old private key certificate new private key certificate sidecar could notified operator either http request special file mounted secret volume done regular basis sidecar could responsible rotating private key even notification operator operator still know new csr request dont rotate private key pod pod private key compromised replace pod new one new private key csr certificate created requires extra mechanism operator safely evacuate replace pod new one could take time compared safely migrate data chosen simpler implement way safely replaceevacuate pod reason example node going hdd failure cert rotation operator able rotate certificate cluster multiple reason expire soon private key compromised regular basis security reason rotating cert node certificate signed impacted new certificate issued node operator access node csrs reissue valid certificate csr private key rotation operator able rotate private key cluster multiple reason private key compromised regular basis security reason similar cert rotation section new certificate issued node case make sense rotate certificate private key avoiding downtime rotation cert rotated node certificate reissued impact connection longrunning node connection maintained past handshake new connection likely fail thing get stabilized incurring potential downtime handle combined cert rotating create combined old new update certificate secret mounted node contain combined instead node accept connection certificate signed new old issue certificate node new node new certificate update certificate secret mounted node contain new crosssigned rotating create new intermediate crosssign old old private key available step biggest advantage compared safe new pod created certificate issued new pod cluster might still old dont new yet bit complex implement though rely service mesh implementation service mesh handle authentication automatically sidecar container mounted pod istio envoy linkerd currently mandatory elasticsearch enable encryption hence cannot easily delegate entirely additional service moreover sound wrong force user particular service mesh includes security problem let user provide private key certificate instead operator manage issue certificate signed could simply propagate existing signed certificate user operator would mount secret containing pod user would store certificate private key secret kubernetes reference secret elasticsearch cluster spec benefit allows user provide certificate signed wellknown public lot simpler implement operator drawback much setup required user outcome decided manage certificate operator major drawback additional complexity operator initsidecar container also reaching elasticsearch cluster service cluster requires cert available service complex handle especially considering certificate rotation could mitigated adding extra ingres proxy layer front elasticsearch would certificate potentially signed public wellknown forwarding request cluster second handshake even though choosing default could also handled configuration userprovided certificate link certinitializer readme describing interaction operator certinitializer init container coordination kibana