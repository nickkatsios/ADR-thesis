choice library interface govuk one login order implement govuk one login oidc login service ideally select wellsupported opensource library provide main implementation detail oidc authorisation flow tricky thing get right cryptographically secure implementation complicated split frontendapi architecture due fact library make assumption full control access php http semantics tooling access cooky session raw http header value etc library facileitphpopenidclient provides solid well tested implementation hard part problem space set optionally usable middleware adapt otherwise ignore shall facileitphpopenidclient oidc library choice sequence diagram roughly intended flow library allows mermaid sequencediagram participant one login actor user autonumber user servicefront click login button servicefront serviceapi pas user locale serviceapi serviceapi create oidc redirect url note right serviceapi see facileopenidclientmiddlewareauthredirectmiddlewarebrfor guidance usage ofbrfacileopenidclientserviceauthorisationservice serviceapi servicefront redirecturi authsessioninterface servicefront servicefront store authsessioninterface session servicefront user redirect redirecturi user one login follow redirect alt create one login one login account creation one login one login login account else login one login one login login account end one login user redirect callbackuri user servicefront follow callbackuri servicefront servicefront fetch authsessioninterface servicefront servicefront process query parameter break error servicefront user login failure page see one login doc end servicefront serviceapi code state authsessioninterface serviceapi serviceapi process oidc authorisation break error serviceapi servicefront authentication failure exception servicefront user login failure page end note right serviceapi see facileopenidclientmiddlewarecallbackmiddlewarebrfor guidance usage ofbrfacileopenidclientserviceauthorisationservice serviceapi serviceapi load user email database alt user found serviceapi serviceapi create new user sub end alt new one login user merged previously note right serviceapi user record contains sub serviceapi servicefront userinterface servicefront servicefront store userinterface session servicefront user dashboard else merge note right serviceapi user record contain sub serviceapi servicefront userinterface sub servicefront servicefront store unmerged userinterface session servicefront user merge workflow start end consequence well tied chosen library update lack thereof though somewhat mitigated sensible usage interface additionally project mit licensed major issue solved simple fork codebase