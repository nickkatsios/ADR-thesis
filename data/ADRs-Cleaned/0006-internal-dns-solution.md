internal dns solution order run webapps within fully private secure application service environment needed come dns solution web application put service discoverable available consumption internal service internal part description fundamental within defines scope proposal also assuming web application dns name dynamically generated convention meanind dns record updated dinamically although dns offering like bind unbound dnsmasq allow provide name resolution service problem felt none provided good enough update name record dynamically box solution particular challenge decided start leveraging consul dns interface allows application make service discovery without hightouch integration consul particular case proposing dns service lookup directed internal domain forwarded currentnew dns server bind dnsmasq consul service example host dns server directly via name lookup like rhubarbfrontendserviceinternaldomain query automatically translates lookup provide rhubarbfrontend service located ase following drawing give high level overview proposed solution approach give number advantage including simplification dns server configuration single config entry forward query internaldomain consul service reusing existing dns infrastructure support bind dnsmasq unbound etc importantly allow update dns record simple api call demonstrated consider example setup dnsmasq server running demonstration purpose consul server running node consul listening tcp port app registration tcp port dns query forwarded dnsmasq configure dnsmasq forward lookup query domain internal consul code dsanabriadnsserver cat etcdnsmasqdconsul serverinternal dsanabriadnsserver new service want register dns system achieved simple api call shown following snippet code dsanabriadnsserver host mojwaftestdevserviceinternal host mojwaftestdevserviceinternalipnpedwkecbmcjrnarbzxinternalcloudappnet found refused dsanabriadnsserver cat servicejson mojwaftestdev name mojwaftestdev tag address port dsanabriadnsserver curl request put data servicejson httplocalhostvagentserviceregister dsanabriadnsserver host mojwaftestdevserviceinternal mojwaftestdevserviceinternal address dsanabriadnsserver another advantage embracing consul lead start adopting best naming practice following specific method service lookup consul service query support two lookup method standard strict rfc case recommending standard service lookup method format standard service lookup code tagserviceservicedatacenterdomain tag datacenter part optional see however service part static cant changed first seen limitation service named provisioning time leveraging azure webapp custom domain implement naming pattern driven good industry practice webapp based service easily follow convention since operator good control setting azure source control management scm exception rule mainly little control naming convention azure force service namescminternal domain order comply industry best practice azure convention register scm service consul update tag service registered following cli session illustrates accomplished code dsanabriadnsserver host mojwaftestdevscmserviceinternal host mojwaftestdevscmserviceinternalipnpedwkecbmcjrnarbzxinternalcloudappnet found refused dsanabriadnsserver cat scmjson scm name scm tag mojwaftestdev address port dsanabriadnsserver curl request put data scmjson httplocalhostvagentserviceregister dsanabriadnsserver host mojwaftestdevscmserviceinternal mojwaftestdevscmserviceinternal address dsanabriadnsserver consequence recommend implement dns forward solution described dnsmasq consul service lightweight flexible robust providing capability dynamically updating name record via api call improving automation considerably dnsmasq avoiding complexity maintaining comprehensive dns offering like bind purpose forwarding dns query dnsmasq shipped installed default centos forwading dns query consul requires config change config line previous example failover mode service achieved deploying pair load balance via azure example implementing consul hand bring complexity term infrastructure management recommend deploy consul cluster minimum node bootstrap server regular server mitigate potential data loss event node failure definitely mean overheard term infrastructure management believe reduced following current infrastructure code practice additionally monitoring system updated healtchecks particular new piece infrastructure