adr celestianode state interaction march testnet author renaynay changelog initial draft update interface coreaccess implementation detail currently celestianode lack way user submit transaction celestiacore well access state public state others celestia light full node run stateservice stateservice responsible managing rpc endpoint provided stateaccessor stateaccessor interface interacting celestiacore order retrieve accountrelated information well submit transaction stateservice stateservice expose several higherlevel rpc endpoint user access method provided stateaccessor type stateservice struct accessor stateaccessor stateaccessor stateaccessor defined two method listed may expanded future include method related account transaction later iteration type stateaccessor interface balance retrieves celestia coin balance node accountsigner balancectx contextcontext balance error balanceforaddress retrieves celestia coin balance given address given typesaccaddress cosmossdk balanceforaddressctx contextcontext addr typesaccaddress balance error submittx submits given transactionmessage celestia network block included block submittxctx contextcontext txresponse error stateaccessor separate implementation hood first outlined adr core rpc connection celestiacore endpoint handed node upon initialisation required iteration discovery bridge node node able provide state nicetohave iteration local eventually full node able provide state network therefore execute respond query without relaying query celestiacore scoped implemented later iteration verification balance order check balance returned via accountbalance query correct necessary also request merkle proof celestiaapp verify latest head apphash order stateaccessor would access headergetters head method order get latest known header node check apphash instead performing regular grpc query celestiaapps bank module would perform abci request query via rpc prefixedaccountkey appendbanktypescreateaccountbalancesprefixaddrbytes byteappbonddenom abcireq abcirequestquery path fmtsprintfstoreskey banktypesstorekey request balance block previous current head apphash committed head calculated applying previous block transaction list current block meaning head apphash actually result previous block transaction height headheight data prefixedaccountkey set value true order get proof response verify head apphash prove true result err carpccliabciquerywithoptionsctx abcireqpath abcireqdata rpcclientabciqueryoptions err nil return nil err result request contain balance queried address proof verify returned balance current head apphash proof returned type cryptoproofops really functional converted useful wrapper merkleproof provided ibcgo commitmenttypes pkg typesconvertproofs return typesmerkleproof wrap chain commitment proof verify membership returned balance tree given root apphash head convert proof digestible format merkleproof err proofutilsconvertproofsresultresponsegetproofops err nil return nil err root proofutilsnewmerklerootheadapphash verifymembership expects path stringstore key module actual key corresponding requested value path proofutilsnewmerklepathbanktypesstorekey stringprefixedaccountkey err merkleproofverifymembershipproofutilsgetsdkspecs root path resultresponsevalue err nil return nil err availability stateservice sync syncer header package provides one public method finished indicates whether syncer finished syncing introducing availability stateservice would require extending public api syncer additional method networkhead order able fetch current state network syncer would passed implementation stateservice upon construction relied order access network head even syncer still syncing network head still verified even sync core implementation stateaccessor coreaccess coreaccess direct rpc connection implementation stateaccessor maintain grpc connection celestiacore node hood upon node initialisation node receive endpoint trusted celestiacore node constructor coreaccess create new instance coreaccess given celestiacore endpoint dialed upon start type coreaccess struct signer apptypeskeyringsigner enccfg cosmoscmdencodingconfig coreendpoint string coreconn grpcclientconn func coreaccessor balanceforaddressctx contextcontext addr string balance error querycli banktypesnewqueryclientcacoreconn balreq banktypesquerybalancerequest address addr denom appdisplaydenom balresp err queryclibalancectx balreq err nil return nil err return balrespbalance nil func coreaccessor submittxctx contextcontext txresponse error txresp err apptypesbroadcasttxctx cacoreconn sdktxbroadcastmodebroadcastmodesync err nil return nil err return txresptxresponse nil implementation stateaccessor ppaccess necessary detail ppaccess implemented adr still conform stateaccessor interface instead provided core endpoint connect via rpc ppaccess perform service discovery stateproviding node network perform state query via libpp stream detail implementation described separate dedicated adr type ppaccess struct discovery communication stateproviding node host hosthost managing key keybase keyringkeyring keyringoptions keyringoption stateprovider bridge node run stateprovider serverside ppaccessor stateprovider responsible relaying staterelated query trusted celestiacore node stateprovider initialised celestiacore rpc connection listen inbound staterelated query peer relay received payload celestiacore