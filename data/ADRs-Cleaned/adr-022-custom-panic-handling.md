adr custom baseapp panic handling changelog apr initial draft sep superseded adr superseded adr current implementation baseapp allow developer write custom error handler panic recovery runtx method think method flexible give cosmos sdk user customizations without rewrite whole baseapp also there one special case sdkerroroutofgas error handling case might handled standard way middleware alongside others propose middlewaresolution could help developer implement following case add external logging let say sending report external service like sentry call panic specific error case also make outofgas case default case one middlewares default case wrap recovery object error log example middleware implementation project sidecar service running alongside blockchain node smart contract virtual machine essential node sidecar connectivity stay stable processing communication break crash node reboot problem solved behaviour make node state machine execution deterministic keeper panic caught runtxs defer handler adjust baseapp code order customize design overview instead hardcoding custom error handling baseapp suggest set middlewares customized externally allow developer many custom error handler want implementation test found implementation detail recovery handler new recoveryhandler type added recoveryobj input argument object returned standard function recover builtin package type recoveryhandler funcrecoveryobj interface error handler type assert method object define object handled nil returned input object cant handled recoveryhandler handler target type nil error returned input object handled middleware chain execution stopped example func exampleerrhandlerrecoveryobj interface error err recoveryobjerror return nil somespecificerroriserr paniccustompanicmsg else return nil example break application execution also might enrich error like outofgas handler recovery middleware also add middleware type decorator function type wrap recoveryhandler return next middleware execution chain handler error type separate actual recovery object handling middleware chain processing type recoverymiddleware funcrecoveryobj interface recoverymiddleware error func newrecoverymiddlewarehandler recoveryhandler next recoverymiddleware recoverymiddleware return funcrecoveryobj interface recoverymiddleware error err handlerrecoveryobj err nil return nil err return next nil function receives recoveryobj object return next recoverymiddleware nil object wasnt handled target type recoveryhandler nil nil error input object handled middlewares chain executed nil nil case invalid behavior panic recovery might properly handled avoided always default rightmost middleware chain always return error outofgas middleware example func newoutofgasrecoverymiddlewaregaswanted uint ctx sdkcontext next recoverymiddleware recoverymiddleware handler funcrecoveryobj interface error err recoveryobjsdkerroroutofgas return nil return errorsmodwrap sdkerrorserroutofgas fmtsprintf gas location gaswanted gasused errdescriptor gaswanted ctxgasmetergasconsumed return newrecoverymiddlewarehandler next default middleware example func newdefaultrecoverymiddleware recoverymiddleware handler funcrecoveryobj interface error return errorsmodwrap sdkerrorserrpanic fmtsprintfrecovered vnstacknv recoveryobj stringdebugstack return newrecoverymiddlewarehandler nil recovery processing basic chain middlewares processing would look like func processrecoveryrecoveryobj interface middleware recoverymiddleware error middleware nil return nil next err middlewarerecoveryobj err nil return err next nil return nil return processrecoveryrecoveryobj next way create middleware chain executed left right rightmost middleware default handler must return error baseapp change default middleware chain must exist baseapp object baseapp modification type baseapp struct runtxrecoverymiddleware recoverymiddleware func newbaseapp appruntxrecoverymiddleware newdefaultrecoverymiddleware func app baseapp runtx defer func recover nil recoverymw newoutofgasrecoverymiddlewaregaswanted ctx appruntxrecoverymiddleware err result processrecoveryr recoverymw nil ginfo sdkgasinfogaswanted gaswanted gasused ctxgasmetergasconsumed developer add custom recoveryhandlers providing addruntxrecoveryhandler baseapp parameter newbaseapp constructor func app baseapp addruntxrecoveryhandlerhandlers recoveryhandler range handler appruntxrecoverymiddleware newrecoverymiddlewareh appruntxrecoverymiddleware method would prepend handler existing chain consequence positive developer cosmos sdk based project add custom panic handler add error custom panic source panic inside custom keeper emit panic passthrough recovery object tendermint core necessary handling developer standard cosmos sdk baseapp implementation rather rewriting project proposed solution doesnt break current standard runtx flow negative introduces change execution model design neutral outofgas error handler becomes one middlewares default panic handler becomes one middlewares reference proposed solution similar solution adr modular antehandler