jetstream based object store metadatavalue author scottf partially implemented tag jetstream client objectstore spec revisiondateauthorinfo scottfinitial design jaremaadd metadata jaremaadd compression document describes design jetstream backed object store adr still considered betaexperimental may subject change overview intend hit basic initial feature set future facing goal indicated current feature list represent object store store large quantity related byte chunk single object retrieve byte single object store metadata regarding object store multiple object single store ability specify chunk size ability delete object ability understand state object store data compression object store nats server possible future feature event notification adddeletelock locking archiving tiered storage searchingindexing tagging versioning revision overriding digest algorithm capturing contenttype mime type per chunk contentencoding gzip read individual chunk basic design object store bucket backed stream multiple object placed bucket object info stored json payload message object info message subject object info subject always rolled per subject object chunk stored payload message chunk message subject naming specification protocol naming convention fully defined adr object store object store name bucket name bucket formulate stream name specified restrictedterm dash underscore object object objectnuid nuid object name individual object name restricted base encoded form nameencoded digest currently sha supported digest please uppercase form rfc specifying digest shaidgpuymgtrgecoqfolrdaxukhfsvzqqpsg modified time modified time never stored putting object link store client populate modtime current utc time returning user getting object getting object link info client populate modtime message time server default setting default setting overridden per object basis setting value note chunk size client may tune appropriate objectstore stream config object store config basis stream configuration map field stream config like type objectstoreconfig struct bucket string stream name template description string stream description metadata mapstringstring stream metadata ttl timeduration stream maxage maxbytes int stream maxbytes storage storagetype stream storatetype replica int stream replica placement placement stream placement compression bool stream compression compression requested configuration set value stream config object store expose internals stream config therefore bool value stream configuration subject template component template stream name objbucket chunk stream subject obucketc meta stream subject obucketm chunk message subject obucketcobjectnuid meta message subject obucketmnameencoded example stream config json name objmystore description description metadata owner infra subject omystorec omystorem maxage maxbytes storage file numreplicas rolluphdrs true allowdirect true discard new placement cluster clstr tag tag tag compression structure objectlink embed link bucket object type objectlink struct bucket name object store bucket stringjsonbucket name link single object empty mean link whole store like directory name string jsonnameomitempty objectmetaoptions type objectmetaoptions struct link objectlink jsonlinkomitempty chunksize uint jsonmaxchunksizeomitempty objectmeta object meta high level information object type objectmeta struct name stringjsonname description stringjsondescriptionomitempty header headerjsonheadersomitempty metadata mapstringstringjsonmetadataomitempty optional opts objectmetaoptions jsonoptionsomitempty objectinfo object info meta plus instance information field objectmeta serialized line direct field objectinfo type objectinfo struct objectmeta bucket string jsonbucket nuid string jsonnuid total object size byte size uint jsonsize modtime timetime jsonmtime total number chunk chunk uint jsonchunks http digestalgorithmdigestvalue digest string jsondigestomitempty deleted bool jsondeletedomitempty objectinfo storage objectinfo stored json payload message meta message subject modtime mtime never written part stored objectinfo message retrieved server message metadata timestamp modtime example objectinfo json json name objectname description objectdesc metadata owner infra header key foo key bar baz link bucket linktobucket name linktoname maxchunksize bucket objectbucket nuid ckuylexzhbyjjawcfih size chunk digest shaabcdefghijklmnopqrstuvwxyz deleted true objectstorestatus object type objectstorestatus interface bucket name bucket bucket string description description supplied creating bucket description string bucketlevel metadata metadata mapstringstring ttl indicates long object kept bucket ttl timeduration storage indicates underlying jetstream storage technology store data storage storagetype replica indicates many storage replica kept data bucket replica int sealed indicates stream sealed cannot modified way sealed bool size combined size data bucket including metadata byte size uint backingstore provides detail underlying storage currently supported value jetstream backingstore string iscompressed indicates data compressed disk iscompressed bool choice iscompressed method name idiomatic language maintainer make similar idiomatic choice functional interface objectstoremanager object store manager creates load deletes object store api objectstore lookup bind existing object store instance objectstorebucket string objectstore createobjectstore create object store createobjectstorecfg objectstoreconfig objectstore deleteobjectstore delete underlying stream named object deleteobjectstorebucket string objectstore storing large object efficiently api required unless noted optionalconvenience put put place content reader new object error put objectmeta contains link addlink addbucketlink putobjectmeta inputstreamreader objectinfo optionalconvenience example putname string inputstreamreader objectinfo putbytesname string data byte objectinfo putstringname string data string objectinfo putfilename string file stringfile reference objectinfo putfilefile stringfile reference objectinfo note convenience method accepting file information consider reference could operating specific path information transferable one solution would actual file name object name discard path information get get retrieve named object object store deleted object treated object dont exist least one language specific variant getname string language specific handling outputstreamwriter getname string outputstreamwriter objectinfo getname string objectresult error optionalconvenience example getbytesname string byte getstringname string string getfilename string file string getinfo getinfo retrieve current information object return info deleted object except optional convenience method getinfoname string objectinfo optionalconvenience example getinfoname string includingdeleted bool objectinfo getinfoname string opts watchopt objectinfo updatemeta updatemeta update metadata object name description header updated object link bucket link allowed updated error update metadata deleted object error rename object name existing object updatemetaname string meta objectmeta delete delete delete named object acceptable noop object already deleted error delete object exist least one variant deletename string void deletename string objectinfo seal seal seal object store modification allowed least one variant seal void seal objectstorestatus watch watch change underlying store receive meta information update watchopts watchopt objectwatcher list list list object store listing object filter object deleted necessary requested provide convenience method optional argument include api user desire list list array objectinfo retrieves runtime backing store bucket objectstorestatus objectstore link link currently discussion whether necessary required api proposed please note version api possible obj objectinfo bucket objectstore could stale meaning state changed since read object deleted info read addlink addlink add link another object object store error link deleted object error link link okay name link name exist okay name link existing deleted object okay name link another link bucket link overwrite error name link existing deleted regular object addlinkname string obj objectinfo objectinfo addbucketlink addbucketlink add link another object store okay name link name exist okay name link existing deleted object okay name link another link bucket link overwrite error name link existing deleted regular object addbucketlinkname string bucket objectstore objectinfo