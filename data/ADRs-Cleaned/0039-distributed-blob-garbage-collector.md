distributed blob garbage collector proposed implemented yet work started topic alternative proposed deduplicated blob bloom filter implemented body header attachment mail stored blob blob store order save space store blob deduplicated hash content attain current blob store read content blob saving generate based hash content way two blob content share thus saved make safe deletion one blob non trivial problem cant delete one blob without ensuring reference deleted example two message share blob delete one message time way tell blob still referenced another message address issue propose implement distributed blob garbage collector built upon previously developed distributed task manager deduplicating blob store keep track reference pointing toward blob reference table also keep track deletion request blob deletion table garbage collector algorithm run fetch deletion table blob considered effectively deleted check reference table still reference reference blob effectively deleted blob store avoid concurrency issue could garbage collect blob time new reference appear reference generation notion added deduplicating blob constructed hash content include reference generation given interval new reference generation emitted since new blob point new generation garbage collection iteration run reference generation avoid concurrency issue switch generation triggered task running distributed task manager task emit event event sourcing system increment reference generation alternative deduplicating blob content simple approach involves storing blob lot time scenario really slow costly albeit case preferred sake simplicity data security consequence change necessitate extract base blob store responsibility store blob delete blob read blob current blob store implementation deduplication generation garbage collector low level blob store order effectively delete blob one consequence work fact deduplication different reference generation two blob content stored twice created two different reference generation writing blob deduplicating blob store specify reference object messageid attachmentid store blob make component harder implement propagate reference since build distributed task scheduler increment reference generation launch periodically garbage collection iteration scheduling done external scheduler cron job kubernetes cronjob call webadmin endpoint launch task periodically algorithm visualisation generation iteration event reference generation emitted gci garbage collection iteration emitted email sent user message blob stored email sent user user message blob stored table generation reference generation garbage collection iteration gci blob blob reference generation reference message blob reference generation deletion empty generation iteration event reference generation emitted gci garbage collection iteration emitted email sent user message blob stored email sent user user message blob stored table generation reference generation garbage collection iteration gci gci blob blob reference generation reference message blob reference generation deletion empty generation iteration event reference generation emitted gci garbage collection iteration emitted email sent user message blob stored email sent user user message blob stored user deletes user deletes table deletion generation reference generation garbage collection iteration gci gci gci blob blob reference generation reference message blob reference generation deletion empty table deletion generation reference generation garbage collection iteration gci gci gci blob blob reference generation reference message blob reference generation deletion blob reference generation garbage collection iteration gci gci gci gci gci running algorithm fetch deletion gci deletion find distinct referencegenerationid deletion generation generation filter deletion keep entry extract blobids concernedblobs fetch reference concernedblobs build bloomfilter foundedreferences filter concernedblobs keep present foundedreferences blobstodelete remove blobstodelete blob deletion filter deletion keep entry extract blobids concernedblobs fetch reference concernedblobs build bloomfilter foundedreferences filter concernedblobs keep present foundedreferences blobstodelete remove blobstodelete blob deletion table garbage collection generation reference generation garbage collection iteration gci gci gci blob blob reference generation reference message blob generation deletion blob reference generation garbage collection iteration gci generation event reference generation emitted gci garbage collection iteration emitted user deletes gcg table deletion generation reference generation garbage collection iteration gci gci gci gci blob blob reference generation reference message blob reference generation deletion blob reference generation garbage collection iteration gci table deletion generation reference generation garbage collection iteration gci gci gci gci blob blob reference generation reference message blob reference generation deletion blob reference generation garbage collection iteration gci gci running algorithm fetch deletion gci deletion find distinct generationid deletion generation generation filter deletion keep entry extract blobids concernedblobs fetch reference concernedblobs build bloomfilter foundedreferences filter concernedblobs keep present foundedreferences blobstodelete remove blobstodelete blob deletion table garbage collection generation reference generation garbage collection iteration gci gci gci gci blob blob reference generation reference message blob reference generation deletion empty