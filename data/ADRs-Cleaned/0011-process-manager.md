process manager keystore update elasticsearch restart rejected implementation removed july keystore updater moved init container adopt pattern kibana apm server move towards statefulset way rolling restarts longer process manager perform elasticsearch cluster restart zombie reaping problem exists another process started container example kubectl exec probably handled official image main benefit code architecture simplicity well respecting standard deciders cloudonks team problem statement design proposal outline process manager injected standard elasticsearch container existence process manager driven three able update elasticsearch keystore perform full elasticsearch cluster restart solve pid zombie reaping problem elasticsearch keystore chose provide kubernetes native way user update elasticsearch keystore kubernetes secret keystore updater custom binary watch volume mounted kubernetes secret synchronizes content elasticsearch keystore user update secret update elasticsearch keystore keystore updater must able access elasticsearchkeystore binary request elasticsearch api endpoint run longrunning process problem knowing run keystore updater full elasticsearch cluster restart established able schedule full cluster restart optimize cluster mutation reusing pod detailed design proposal primary case pod reuse switching one license type another network configuration change nontls migration relevant basic reusing pod may still relevant simply restarting elasticsearch process way faster efficient replacing pod especially there configuration change minor configuration change plugin change pid zombie reaping want sure signal properly handled elasticsearch child process correctly reaped elasticsearch process terminates driver save cpu memory resource keystore sidecar container implies allocating cpu memory compared running keystoreupdater process elasticsearch container init process controlling init process identified interesting benefit handle pid zombie reaping problem give better control defines healthy ready process without exposing url make easier perform nominal restarts process without notice full elasticsearch cluster restart reuse pod must possible perform full cluster restart reuse existing pod considered run keystore updater run sidecar container standard elasticsearch image easy serve api report keystore updater request cpu memory cluster compared running keystore updater elasticsearch container run inside process manager injected standard elasticsearch container easy serve api report keystore updater share cpu memory process extremely conservative resource usage run process manager sidecar process namespace sharing easy serve api request cpu memory cluster compared running keystore updater elasticsearch container run shelf process manager standard elasticsearch container process run api keystore updater process perform cluster restart destroy pod recreate depending storage class might able recreate pod volume resides recovery point manual restore snapshot considering volume local node interval pod deleted new pod scheduled reuse volume guarantee pod scheduled node taking resource available node preventing replacing pod scheduled inject process manager standard elasticsearch containerimage would allow restart without recreating pod unless change pod resource environment variable case destroy pod recreate disadvantage fairly intrusive complex copying binary initcontainers overriding command etc liveness probe make kubernetes restart container hard coordinate across cluster scheduling restart somewhat delayed maybe big issue pid zombie reaping problem recreate cluster restore snapshot slow snapshot repository docker exec either user automated pid zombie reaping problem pid zombie reaping problem inject process manager properly handle signal reap orphaned zombie process pid namespace sharing default version kubernetes support controlled dockerdisablesharedpidfalse experimental new way dont know people outcome cover three problem decided inject process manager standard elasticsearch container run keystore updater manage elasticsearch process one container process manager overview custom binary injected standard elasticsearch container init container run keystore updater goroutine inside process manager process expose http api report keystore updater expose http api perform start stop kill process secure http api dedicated handle process termination recreate container avoid issue memory non released restart process container recreated stop scheduled stop endpoint file save current process restart could replace init container serf csr ease certificate rotation positive consequence extra container allocates cpu memory full control perform cluster restart api expose keystore updater control process negative consequence share cpu memory resource elasticsearch container bit intrusive copying binary init container overriding command bit complex signal handling link httpsgithubcomelasticcloudonksissues lightweight process manager issue httpsgithubcomelasticcloudonksissues full cluster restart issue