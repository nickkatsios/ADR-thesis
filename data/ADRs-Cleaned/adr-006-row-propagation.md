adr consensus block gossiping row changelog initial description important detail added mention approach briefly long story relation celestia tendermint consensus block gossiping celestias team discussed multiple idea several adrs made nothing yet finalized adr another attempt bring valuable change block gossiping hopefully successful currently inherit following tendermint codebase relies block part notion part piece entire serialized block part gossiped node consensus committed partsetheader containing merkle root part however part gossiping wasnt designed celestia block celestia come different block representation tendermint lay block table data share row column gossiped instead part keeping one systemwide commitment data approach nah work dont touch approach turn could fully treat tendermint consensus black box keeping two data commitment one consensus partsetheader another world outside consensus daheader pro work others get rid partsheader blockid without changing block propagation see adr change block propagation fixedsized chunk based instead part built currently empirical evidence performs practice send block whole work smaller block block propagationbased sending header txids requesting txmessages missing local mempool node demand con pull two data commitment celestias spec brings ambiguity data integrity verification controversial software design perspective brings dosing vector big block every block would represented two format ram waste resource building verifying additional still treat tendermints consensus black box amendment gossiping mechanism introduce rowset mimic partset rowset helper structure wrap daheader track received row integrity daheader tell user block complete andor recovered mostly helper highlevel concept replace partset rowset within consensus keep daheader proposal remove partsetheader proposal change required implement later point change listed likely implemented cleanup entirely removing partsetheader redundant data commitment removing partset relying daheader instead partsetheader detailed design detailed design section demonstrates design supporting change package package fortunately design affect public api change solely internal type rowset row first essential part implement rowset row fully mimicking semantics partset part decrease number required change implementation semantics presented row represents blob multiple extendeddatasquare share practically half extended row half recomputed type row struct index toptobottom index row extendeddatasquare note row index unnecessary determine index hash daheader however index removal would bring change consensus reactor arguable pro bandwidth usage index int actual share blob data byte newrow creates new row flattened share index func newrowidx int row byte row rowset wrap daheader track added row integrity daheader allows user check whenever rsmtdextendeddatasquare recovered rowset track whole extendeddatasquare original block data addrow getrow method accepts return half row recomputed type rowset interface note rowset defined interface simplicity practice struct one implementation addrow add row set return true nil error case row successfully added logic row check already added verify size corresponds daheader extend erasure coding compute nmt root verify nmt root corresponds daheader root index finally add set mark added addrowrow bool error getrow return row index exist getrowi int row square check enough row added return recomputed extendeddatasquare enough square rsmtdextendeddatasquare error helper method omitted newrowset creates full rowset rsmtdextendeddatasquare gossip others getrow func newrowseteds rsmtdextendeddatasquare rowset newrowsetfromheader creates empty rowset daheader receive verify gossiped row daheader addrow func newrowsetfromheaderdah iplddataavailabilityheader rowset vote vote include commitment data previously relied partsetheader blockid instead relies added daheader protobuf schema updated accordingly proposal proposal extended numoriginaldatashares optimization help validators populate header without counting original data share block received form proposer potentially introduce vulnerability proposer send wrong value leaving populated header validators wrong part optional consensus reactor message affect two message consensus reactor blockpartmessage blockrowmessage instead part carry row defined newvalidblockmessage instead partsetheader carry daheader bitarray rowset instead partset protobuf schema updated accordingly peerroundstate peerroundstate track state known peer round specifically commitment block chunk peer hold change track daheader instead partsetheader along bitarray rowset instead partset blockcatchup reactor help peer catchup sync instead sending random part sends random row blockrowmessage unfortunately requires reactor load whole block store optimization ability load row store could introduced later point state roundstate roundstate keep proposal valid lock block data along entire block part roundstate also keep row rowset later point partset track part removed proposal stage previously state proposal stage waited part assemble entire block instead state wait half row proposer andor peer recompute block data notifies back sent also row minimally required amount information gossiped everything else assemble full block collected chain state proposal proposed consequence positive hardening consensus gossiping erasure coding block exceeding size limit immediately rejected proposal without download entire block control row message size consensus comparing part message last part block always unpredictable size daheader hand allows knowing precisely size row message bandwidth usage required block data gossiped merkle proof part sent wire one systemwide block data commitment schema dont abandon work month taking profit merged others negative invest time week work done change left implementation along peer review neutral row part wire previously part propagated max size kib let take row largest block comparison actual data size case row would xsharesperrowsharesizekib exactly two time smaller part gossiped chunk longer constant size instead size proportional size block data another step back original tendermints codebases