testing event flaky test due timing event initial render nondeterministic firing test event may give wrong result testintegrationwebuibookmarksexamplesjs describelist item added response bookmarkadded notification let interactor page consolemessages null const itemsselector divapplication divbookmarks item beforeasync interactor new webinteractor headless true page await interactorpage consolemessages new consolelistenerpage beforeeachasync await pagegotobaseurlunplugfeature waituntil domcontentloaded afterasync await interactorclose itfor example async await pageonceload async await pageevaluate applicationnotify bookmarkadded title title url httpabcdef source await pagewaitforselectoritemsselector const listids await pageevalitemsselector item itemsmapit itid expectlistidstoeql bookmarkid bookmarkadded notification sent page loaded test fail divapplication divbookmarks item would overwritten trying introducing idea something html page called view monitor load event class uievents constructoropts opts idleperiod opts thisidleperiod optsidleperiod thislastrender thisnow notifyrendering thislastrender thisnow async waituntilidleopts opts timeout opts const starttime new const timedout new starttime optstimeout const delay new promiseres settimeoutres whilefalse thisisidle timedout throw new errortimed optstimeoutms await delay isidle return thisnow thislastrender thisidleperiod return new moduleexports uievents require view add notification like import afterupdate svelte afterupdate windowviewnotifyrendering todo guess add test make sure view type raise attempt tried pageonce supposed callback pad load work start fluke think decided forcing view implement finished notification changing application notify finished consequence becomes easier difficult risk introduced change mitigated